<div class="meta"
description="Adding action relationships with Postgres tables in Hasura"
keywords="hasura, docs, action relationship, remote join">

</div>

# Postgres: Action relationships

<div class="contents" backlinks="none" depth="2" local="">

Table of contents

</div>

## Introduction

Action relationships allow you to join data across tables and actions.
Once you create relationships between types from your database and types
created from actions, you can then "join" them by running GraphQL
queries.

`Actions <actions>` are a way to extend Hasuraâ€™s schema with custom
business logic using custom queries and mutations. The resolvers for
these custom fields are written in REST endpoints. They are especially
useful for setting up serverless functions as resolvers.

## Create an action relationship

### Step 0: Create an action

Create an action either `from scratch <create_actions>` or
`derived from an existing mutation <derive_actions>`.

### Step 1: Define and create the relationship

The following values can be defined for an action relationship:

-   **Relationship type**: Select a type of relationship.
    -   **Object relationship**: For one-to-one relationships.
    -   **Array relationship**: For one-to-many relationships.
-   **Relationship name**: Create a name for the relationship.
-   **Reference schema**: Select a reference schema from your database.
-   **Reference table**: Select a table from your database.
-   **From**: Select a field returned in the action response.
-   **To**: Select a column from the reference table to join the field
    to.

In this example, we're creating a relationship for the `createUser`
action.

<div class="rst-class">

api_tabs

</div>

<div class="tabs">

<div class="tab">

Console

-   Head to the `Actions -> [action-name] -> Relationships` tab.
-   Click `Add a relationship`.

<div class="thumbnail" alt="Opening the action relationship section"
width="600px">

/img/graphql/core/schema/add-action-relationship.png

</div>

-   In the section opened by the above step, fill out the following
    fields and hit `Save`.

<div class="thumbnail" alt="Defining the relationship" width="700px">

/img/graphql/core/schema/define-action-relationship.png

</div>

</div>

<div class="tab">

CLI

You can add an action relationship by adding it to the respective custom
type in the `actions.yaml` file inside the `metadata` directory:

```yaml
- custom_types
  - objects
    - name: UserOutput
      relationships:
      - remote_table:
          schema: public
          name: users
        name: user
        type: object
        field_mapping:
          id: id
```

Apply the metadata by running:

```bash
hasura metadata apply
```

</div>

<div class="tab">

API

You can create an action relationship when defining custom types via the
`metadata_set_custom_types` metadata API:

```http
POST /v1/metadata HTTP/1.1
Content-Type: application/json
X-Hasura-Role: admin

{
  "type": "set_custom_types",
  "args": {
    "scalars": [],
    "enums": [],
    "input_objects": [],
    "objects": [
      {
        "name": "UserOutput",
        "fields": [
          {
            "name": "id",
            "type": "Int!"
          }
        ],
        "relationships": [
          {
            "name": "user",
            "type": "object",
            "remote_table": "users",
            "field_mapping": {
              "id": "id"
            }
          }
        ]
      }
    ]
  }
}
```

</div>

</div>

In this example, we're creating a relationship called `user`, from the
`id` field returned in the action response, to the `id` column of the
`users` table.

### Step 2: Explore with GraphiQL

In the GraphiQL tab, test out your action relationship.

<div class="graphiql" view_only="" query="mutation {
  createUser(name: &quot;Hodor&quot;) {
    id
    user {
      name
      auth0_id
    }
  }
}
:response:
{
  &quot;data&quot;: {
    &quot;createUser&quot;: {
      &quot;id&quot;: &quot;7ffd68ba-535e-4c72-9051-17cd4e8ed594&quot;,
      &quot;user&quot;: {
        &quot;name&quot;: &quot;Hodor&quot;,
        &quot;auth0_id&quot;: &quot;hodor|hodor&quot;
      }
    }
  }
}">

</div>

If your table has an existing
`remote relationship <pg_remote_schema_relationships>`, you can also
query the fields from the remote schema.

<div class="graphiql" view_only="" query="mutation {
  createUser(name: &quot;Hodor&quot;) {
    id
    user {
      name
      auth0_id
      auth0_profile {
        email
        nickname
        last_login
      }          
    }
  }
}
:response:
{
  &quot;data&quot;: {
    &quot;createUser&quot;: {
      &quot;id&quot;: &quot;7ffd68ba-535e-4c72-9051-17cd4e8ed594&quot;,
      &quot;user&quot;: {
        &quot;name&quot;: &quot;Hodor&quot;,
        &quot;auth0_id&quot;: &quot;hodor|hodor&quot;,
        &quot;auth0_profile&quot;: {
          &quot;email&quot;: &quot;hodor@hodor.com&quot;,
          &quot;nickname&quot;: &quot;Hodor&quot;,
          &quot;last_login&quot;: &quot;2016-05-22T01:35:48.863Z&quot;
        }
      }
    }
  }
}">

</div>

In the `Remote schema relationships <pg_remote_schema_relationships>`
section, we joined our `users` table with a remote
[Auth0](https://auth0.com/) schema. Here, we're able to get the Auth0
profile data of the user returned from our action.
