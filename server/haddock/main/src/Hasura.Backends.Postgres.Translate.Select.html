<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Postgres Translate Select</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- This module is a translation layer between IR and postgres-specific select queries.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- There are three main types of selects (as distinguished from the IR):</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">--     * &quot;simple&quot; selects</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">--     * aggregate selects</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">--     * connection selects (used for relay)</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Most exports from this module showcase this distinction. The &quot;interesting&quot; parts</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- of the call tree of these functions is similar:</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">--     * 'selectQuerySQL' -&gt; 'mkSQLSelect' -&gt; 'processAnnSimpleSelect' -&gt; 'processSelectParams'/'processAnnFields'</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">--     * 'selectAggregateQuerySQL' -&gt; 'mkAggregateSelect' -&gt; 'processAnnAggregateSelect' -&gt; 'processSelectParams'/'processAnnFields'</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">--     * 'connetionSelectQuerySQL' -&gt; 'mkConnectionSelect' -&gt; 'processConnectionSelection' -&gt; 'processSelectParams'</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Random thoughts that might help when diving deeper in this module:</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">--     * Extractors are a pair of an SQL expression and an alias; they get</span><span>
</span><span id="line-26"></span><span class="hs-comment">--         translated like &quot;[SELECT ...] &lt;expr&gt; as &lt;alias&gt;&quot;</span><span>
</span><span id="line-27"></span><span class="hs-comment">--     * a 'SelectSource' consists of a prefix, a source, a boolean conditional</span><span>
</span><span id="line-28"></span><span class="hs-comment">--         expression, and info on whether sorting or slicing is done</span><span>
</span><span id="line-29"></span><span class="hs-comment">--         (needed to handle the LIMIT optimisation)</span><span>
</span><span id="line-30"></span><span class="hs-comment">--     * For details on creating the selection tree for relationships via</span><span>
</span><span id="line-31"></span><span class="hs-comment">--       @MonadWriter JoinTree@, see 'withWriteJoinTree'</span><span>
</span><span id="line-32"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Select</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectQuerySQL"><span class="hs-identifier">selectQuerySQL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectAggregateQuerySQL"><span class="hs-identifier">selectAggregateQuerySQL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionSelectQuerySQL"><span class="hs-identifier">connectionSelectQuerySQL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowJsonResp"><span class="hs-identifier">asSingleRowJsonResp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSQLSelect"><span class="hs-identifier">mkSQLSelect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateSelect"><span class="hs-identifier">mkAggregateSelect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkConnectionSelect"><span class="hs-identifier">mkConnectionSelect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier">PostgresAnnotatedFieldJSON</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(^?)</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer.Strict</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.PG.Query</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Q</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.DML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.IdentifierUniqueness.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.IdentifierUniqueness</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.BoolExp.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.BoolExp</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Column.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Column</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier">toJSONableExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Types</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Common.html"><span class="hs-identifier">Hasura.GraphQL.Schema.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.Schema.Common.html#currentNodeIdVersion"><span class="hs-identifier">currentNodeIdVersion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Schema.Common.html#nodeIdVersionInt"><span class="hs-identifier">nodeIdVersionInt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DML.Internal.html"><span class="hs-identifier">Hasura.RQL.DML.Internal</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html"><span class="hs-identifier">Hasura.RQL.IR.OrderBy</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html"><span class="hs-identifier">Hasura.RQL.IR.Select</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.html"><span class="hs-identifier">Hasura.RQL.Types</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.Types.html"><span class="hs-identifier">Hasura.SQL.Types</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Translates IR to Postgres queries for simple SELECTs (select queries that</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- are not aggregations, including subscriptions).</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- See 'mkSQLSelect' for the Postgres AST.</span><span>
</span><span id="line-71"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectQuerySQL"><span class="hs-identifier hs-type">selectQuerySQL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399522"><span class="annot"><a href="#local-6989586621688399522"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399522"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399522"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#JsonAggSelect"><span class="hs-identifier hs-type">JsonAggSelect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSimpleSelect"><span class="hs-identifier hs-type">AnnSimpleSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399522"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.Query</span></span><span>
</span><span id="line-77"></span><span id="selectQuerySQL"><span class="annot"><span class="annottext">selectQuerySQL :: JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Query
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectQuerySQL"><span class="hs-identifier hs-var hs-var">selectQuerySQL</span></a></span></span><span> </span><span id="local-6989586621688399521"><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688399521"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span></span><span> </span><span id="local-6989586621688399520"><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
</span><a href="#local-6989586621688399520"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><span class="hs-identifier hs-var">Q.fromBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query) -&gt; Builder -&gt; Query
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Builder) -&gt; Select -&gt; Builder
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSQLSelect"><span class="hs-identifier hs-var">mkSQLSelect</span></a></span><span> </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688399521"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span><span> </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
</span><a href="#local-6989586621688399520"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | Translates IR to Postgres queries for aggregated SELECTs.</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- See 'mkAggregateSelect' for the Postgres AST.</span><span>
</span><span id="line-83"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectAggregateQuerySQL"><span class="hs-identifier hs-type">selectAggregateQuerySQL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399517"><span class="annot"><a href="#local-6989586621688399517"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399517"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399517"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnAggregateSelect"><span class="hs-identifier hs-type">AnnAggregateSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399517"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.Query</span></span><span>
</span><span id="line-88"></span><span id="selectAggregateQuerySQL"><span class="annot"><span class="annottext">selectAggregateQuerySQL :: AnnAggregateSelect ('Postgres pgKind) -&gt; Query
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectAggregateQuerySQL"><span class="hs-identifier hs-var hs-var">selectAggregateQuerySQL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><span class="hs-identifier hs-var">Q.fromBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query)
-&gt; (AnnAggregateSelectG ('Postgres pgKind) Void SQLExp -&gt; Builder)
-&gt; AnnAggregateSelectG ('Postgres pgKind) Void SQLExp
-&gt; Query
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Builder)
-&gt; (AnnAggregateSelectG ('Postgres pgKind) Void SQLExp -&gt; Select)
-&gt; AnnAggregateSelectG ('Postgres pgKind) Void SQLExp
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AnnAggregateSelectG ('Postgres pgKind) Void SQLExp -&gt; Select
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
AnnAggregateSelect ('Postgres pgKind) -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateSelect"><span class="hs-identifier hs-var">mkAggregateSelect</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Translates IR to Postgres queries for &quot;connection&quot; queries (used for Relay).</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- See 'mkConnectionSelect' for the Postgres AST.</span><span>
</span><span id="line-94"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionSelectQuerySQL"><span class="hs-identifier hs-type">connectionSelectQuerySQL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399515"><span class="annot"><a href="#local-6989586621688399515"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399515"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399515"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSelect"><span class="hs-identifier hs-type">ConnectionSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399515"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.Query</span></span><span>
</span><span id="line-101"></span><span id="connectionSelectQuerySQL"><span class="annot"><span class="annottext">connectionSelectQuerySQL :: ConnectionSelect ('Postgres pgKind) Void SQLExp -&gt; Query
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionSelectQuerySQL"><span class="hs-identifier hs-var hs-var">connectionSelectQuerySQL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Builder -&gt; Query
</span><span class="hs-identifier hs-var">Q.fromBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Query)
-&gt; (ConnectionSelect ('Postgres pgKind) Void SQLExp -&gt; Builder)
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; Query
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SelectWithG Select -&gt; Builder
forall a. ToSQL a =&gt; a -&gt; Builder
</span><a href="Hasura.SQL.Types.html#toSQL"><span class="hs-identifier hs-var">toSQL</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectWithG Select -&gt; Builder)
-&gt; (ConnectionSelect ('Postgres pgKind) Void SQLExp
    -&gt; SelectWithG Select)
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; Builder
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; SelectWithG Select
forall (pgKind :: PostgresKind).
(Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkConnectionSelect"><span class="hs-identifier hs-var">mkConnectionSelect</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Helper function with no relation to anything else in the module.</span><span>
</span><span id="line-105"></span><span class="hs-comment">--</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- This function is generally used on the result of 'selectQuerySQL',</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- 'selectAggregateQuerySQL' or 'connectionSelectSQL' to run said query and get</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- back the resulting JSON.</span><span>
</span><span id="line-109"></span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- TODO: Perhaps this helper could find a new home.</span><span>
</span><span id="line-111"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowJsonResp"><span class="hs-identifier hs-type">asSingleRowJsonResp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.Query</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Q.PrepArg</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Q.TxE</span></span><span> </span><span class="annot"><a href="Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-115"></span><span id="asSingleRowJsonResp"><span class="annot"><span class="annottext">asSingleRowJsonResp :: Query -&gt; [PrepArg] -&gt; TxE QErr EncJSON
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowJsonResp"><span class="hs-identifier hs-var hs-var">asSingleRowJsonResp</span></a></span></span><span> </span><span id="local-6989586621688399514"><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621688399514"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span id="local-6989586621688399513"><span class="annot"><span class="annottext">[PrepArg]
</span><a href="#local-6989586621688399513"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; EncJSON
</span><a href="Hasura.EncJSON.html#encJFromBS"><span class="hs-identifier hs-var">encJFromBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; EncJSON)
-&gt; (SingleRow (Identity ByteString) -&gt; ByteString)
-&gt; SingleRow (Identity ByteString)
-&gt; EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity ByteString -&gt; ByteString
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity ByteString -&gt; ByteString)
-&gt; (SingleRow (Identity ByteString) -&gt; Identity ByteString)
-&gt; SingleRow (Identity ByteString)
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity ByteString) -&gt; Identity ByteString
forall a. SingleRow a -&gt; a
</span><span class="hs-identifier hs-var hs-var">Q.getRow</span></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">(SingleRow (Identity ByteString) -&gt; EncJSON)
-&gt; TxET QErr IO (SingleRow (Identity ByteString))
-&gt; TxE QErr EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query
-&gt; [PrepArg]
-&gt; Bool
-&gt; TxET QErr IO (SingleRow (Identity ByteString))
forall (m :: * -&gt; *) a e.
(MonadIO m, FromRes a) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; [PrepArg] -&gt; Bool -&gt; TxET e m a
</span><span class="hs-identifier hs-var">Q.rawQE</span></span><span> </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.RQL.DML.Internal.html#dmlTxErrorHandler"><span class="hs-identifier hs-var">dmlTxErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621688399514"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">[PrepArg]
</span><a href="#local-6989586621688399513"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | Converts a function name to an 'Identifier'.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- If the schema name is public, it will just use its name, otherwise it will</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- prefix it by the schema name.</span><span>
</span><span id="line-123"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#functionToIdentifier"><span class="hs-identifier hs-type">functionToIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedFunction"><span class="hs-identifier hs-type">QualifiedFunction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-124"></span><span id="functionToIdentifier"><span class="annot"><span class="annottext">functionToIdentifier :: QualifiedFunction -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#functionToIdentifier"><span class="hs-identifier hs-var hs-var">functionToIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Identifier)
-&gt; (QualifiedFunction -&gt; Text) -&gt; QualifiedFunction -&gt; Identifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QualifiedFunction -&gt; Text
forall a. ToTxt a =&gt; QualifiedObject a -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#qualifiedObjectToText"><span class="hs-identifier hs-var">qualifiedObjectToText</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="local-6989586621688399668"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToFromItem"><span class="hs-identifier hs-type">selectFromToFromItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectFrom"><span class="hs-identifier hs-type">SelectFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399668"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span></span><span>
</span><span id="line-127"></span><span id="selectFromToFromItem"><span class="annot"><span class="annottext">selectFromToFromItem :: Identifier -&gt; SelectFrom ('Postgres pgKind) -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToFromItem"><span class="hs-identifier hs-var hs-var">selectFromToFromItem</span></a></span></span><span> </span><span id="local-6989586621688399502"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399502"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromTable"><span class="hs-identifier hs-type">FromTable</span></a></span><span> </span><span id="local-6989586621688399500"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688399500"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688399500"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromIdentifier"><span class="hs-identifier hs-type">FromIdentifier</span></a></span><span> </span><span id="local-6989586621688399497"><span class="annot"><span class="annottext">FIIdentifier
</span><a href="#local-6989586621688399497"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; FromItem) -&gt; Identifier -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FIIdentifier -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FIIdentifier
</span><a href="#local-6989586621688399497"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromFunction"><span class="hs-identifier hs-type">FromFunction</span></a></span><span> </span><span id="local-6989586621688399493"><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
</span><a href="#local-6989586621688399493"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span id="local-6989586621688399492"><span class="annot"><span class="annottext">FunctionArgsExpTableRow (SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688399492"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621688399491"><span class="annot"><span class="annottext">Maybe [(Column ('Postgres pgKind), ScalarType ('Postgres pgKind))]
</span><a href="#local-6989586621688399491"><span class="hs-identifier hs-var">defListM</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">FunctionExp -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIFunc"><span class="hs-identifier hs-var">S.FIFunc</span></a></span><span> </span><span class="annot"><span class="annottext">(FunctionExp -&gt; FromItem) -&gt; FunctionExp -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">QualifiedFunction
-&gt; FunctionArgs -&gt; Maybe FunctionAlias -&gt; FunctionExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionExp"><span class="hs-identifier hs-var">S.FunctionExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688399493"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; FunctionArgsExpTableRow SQLExp -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#fromTableRowArgs"><span class="hs-identifier hs-var">fromTableRowArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399502"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpTableRow (SQLExpression ('Postgres pgKind))
FunctionArgsExpTableRow SQLExp
</span><a href="#local-6989586621688399492"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe FunctionAlias -&gt; FunctionExp)
-&gt; Maybe FunctionAlias -&gt; FunctionExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">FunctionAlias -&gt; Maybe FunctionAlias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FunctionAlias -&gt; Maybe FunctionAlias)
-&gt; FunctionAlias -&gt; Maybe FunctionAlias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Maybe [(PGCol, PGScalarType)] -&gt; FunctionAlias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkFunctionAlias"><span class="hs-identifier hs-var">S.mkFunctionAlias</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedFunction -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#functionToIdentifier"><span class="hs-identifier hs-var">functionToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688399493"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [(Column ('Postgres pgKind), ScalarType ('Postgres pgKind))]
Maybe [(PGCol, PGScalarType)]
</span><a href="#local-6989586621688399491"><span class="hs-identifier hs-var">defListM</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- You should be able to retrieve this information</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- from the FromItem generated with selectFromToFromItem</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- however given from S.FromItem is modelled, it is not</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- possible currently.</span><span>
</span><span id="line-139"></span><span class="hs-comment">--</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- More precisely, 'selectFromToFromItem' is injective but not surjective, so</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- any S.FromItem -&gt; S.Qual function would have to be partial.</span><span>
</span><span id="line-142"></span><span id="local-6989586621688399664"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToQual"><span class="hs-identifier hs-type">selectFromToQual</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectFrom"><span class="hs-identifier hs-type">SelectFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399664"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Qual"><span class="hs-identifier hs-type">S.Qual</span></a></span></span><span>
</span><span id="line-143"></span><span id="selectFromToQual"><span class="annot"><span class="annottext">selectFromToQual :: SelectFrom ('Postgres pgKind) -&gt; Qual
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToQual"><span class="hs-identifier hs-var hs-var">selectFromToQual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromTable"><span class="hs-identifier hs-type">FromTable</span></a></span><span> </span><span id="local-6989586621688399485"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688399485"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688399485"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromIdentifier"><span class="hs-identifier hs-type">FromIdentifier</span></a></span><span> </span><span id="local-6989586621688399483"><span class="annot"><span class="annottext">FIIdentifier
</span><a href="#local-6989586621688399483"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FIIdentifier -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FIIdentifier
</span><a href="#local-6989586621688399483"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FromFunction"><span class="hs-identifier hs-type">FromFunction</span></a></span><span> </span><span id="local-6989586621688399481"><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
</span><a href="#local-6989586621688399481"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpTableRow (SQLExpression ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe [(Column ('Postgres pgKind), ScalarType ('Postgres pgKind))]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedFunction -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#functionToIdentifier"><span class="hs-identifier hs-var">functionToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688399481"><span class="hs-identifier hs-var">qf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span id="local-6989586621688399701"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldToExp"><span class="hs-identifier hs-type">aggregateFieldToExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AggregateFields"><span class="hs-identifier hs-type">AggregateFields</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399701"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span></span><span>
</span><span id="line-149"></span><span id="aggregateFieldToExp"><span class="annot"><span class="annottext">aggregateFieldToExp :: AggregateFields ('Postgres pgKind) -&gt; StringifyNumbers -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldToExp"><span class="hs-identifier hs-var hs-var">aggregateFieldToExp</span></a></span></span><span> </span><span id="local-6989586621688399479"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399479"><span class="hs-identifier hs-var">aggFlds</span></a></span></span><span> </span><span id="local-6989586621688399478"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688399478"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399477"><span class="hs-identifier hs-var">jsonRow</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621688399477"><span class="annot"><span class="annottext">jsonRow :: SQLExp
</span><a href="#local-6989586621688399477"><span class="hs-identifier hs-var hs-var">jsonRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, AggregateField ('Postgres pgKind)) -&gt; [SQLExp])
-&gt; AggregateFields ('Postgres pgKind) -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, AggregateField ('Postgres pgKind)) -&gt; [SQLExp]
</span><a href="#local-6989586621688399474"><span class="hs-identifier hs-var">aggToFlds</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399479"><span class="hs-identifier hs-var">aggFlds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621688399473"><span class="annot"><span class="annottext">withAls :: Text -&gt; SQLExp -&gt; [SQLExp]
</span><a href="#local-6989586621688399473"><span class="hs-identifier hs-var hs-var">withAls</span></a></span></span><span> </span><span id="local-6989586621688399472"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399472"><span class="hs-identifier hs-var">fldName</span></a></span></span><span> </span><span id="local-6989586621688399471"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399471"><span class="hs-identifier hs-var">sqlExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399472"><span class="hs-identifier hs-var">fldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399471"><span class="hs-identifier hs-var">sqlExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621688399474"><span class="annot"><span class="annottext">aggToFlds :: (FieldName, AggregateField ('Postgres pgKind)) -&gt; [SQLExp]
</span><a href="#local-6989586621688399474"><span class="hs-identifier hs-var hs-var">aggToFlds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688399468"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399468"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399467"><span class="annot"><span class="annottext">AggregateField ('Postgres pgKind)
</span><a href="#local-6989586621688399467"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp -&gt; [SQLExp]
</span><a href="#local-6989586621688399473"><span class="hs-identifier hs-var">withAls</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399468"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; [SQLExp]) -&gt; SQLExp -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AggregateField ('Postgres pgKind)
</span><a href="#local-6989586621688399467"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFCount"><span class="hs-identifier hs-type">AFCount</span></a></span><span> </span><span id="local-6989586621688399465"><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
</span><a href="#local-6989586621688399465"><span class="hs-identifier hs-var">cty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CountType -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SECount"><span class="hs-identifier hs-var">S.SECount</span></a></span><span> </span><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
CountType
</span><a href="#local-6989586621688399465"><span class="hs-identifier hs-var">cty</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFOp"><span class="hs-identifier hs-type">AFOp</span></a></span><span> </span><span id="local-6989586621688399462"><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind)
</span><a href="#local-6989586621688399462"><span class="hs-identifier hs-var">aggOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688399461"><span class="hs-identifier hs-var">aggOpToObj</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind)
</span><a href="#local-6989586621688399462"><span class="hs-identifier hs-var">aggOp</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFExp"><span class="hs-identifier hs-type">AFExp</span></a></span><span> </span><span id="local-6989586621688399459"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399459"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399459"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621688399461"><span class="annot"><span class="annottext">aggOpToObj :: AggregateOp ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688399461"><span class="hs-identifier hs-var hs-var">aggOpToObj</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AggregateOp"><span class="hs-identifier hs-type">AggregateOp</span></a></span><span> </span><span id="local-6989586621688399457"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399457"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621688399456"><span class="annot"><span class="annottext">ColumnFields ('Postgres pgKind)
</span><a href="#local-6989586621688399456"><span class="hs-identifier hs-var">flds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, ColFld ('Postgres pgKind)) -&gt; [SQLExp])
-&gt; ColumnFields ('Postgres pgKind) -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; (FieldName, ColFld ('Postgres pgKind)) -&gt; [SQLExp]
</span><a href="#local-6989586621688399455"><span class="hs-identifier hs-var">colFldsToExtr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399457"><span class="hs-identifier hs-var">opText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ColumnFields ('Postgres pgKind)
</span><a href="#local-6989586621688399456"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621688399455"><span class="annot"><span class="annottext">colFldsToExtr :: Text -&gt; (FieldName, ColFld ('Postgres pgKind)) -&gt; [SQLExp]
</span><a href="#local-6989586621688399455"><span class="hs-identifier hs-var hs-var">colFldsToExtr</span></a></span></span><span> </span><span id="local-6989586621688399454"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399454"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688399453"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399453"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFCol"><span class="hs-identifier hs-type">CFCol</span></a></span><span> </span><span id="local-6989586621688399451"><span class="annot"><span class="annottext">Column ('Postgres pgKind)
</span><a href="#local-6989586621688399451"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span id="local-6989586621688399450"><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688399450"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399453"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
forall (pgKind :: PostgresKind).
StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier hs-var">toJSONableExp</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688399478"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688399450"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399454"><span class="hs-identifier hs-var">opText</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688399451"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="#local-6989586621688399455"><span class="hs-identifier hs-var">colFldsToExtr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688399447"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399447"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFExp"><span class="hs-identifier hs-type">CFExp</span></a></span><span> </span><span id="local-6989586621688399445"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399445"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399447"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399445"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowExtr"><span class="hs-identifier hs-type">asSingleRowExtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-170"></span><span id="asSingleRowExtr"><span class="annot"><span class="annottext">asSingleRowExtr :: Alias -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowExtr"><span class="hs-identifier hs-var hs-var">asSingleRowExtr</span></a></span></span><span> </span><span id="local-6989586621688399443"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399443"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;coalesce&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399442"><span class="hs-identifier hs-var">jsonAgg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;null&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621688399442"><span class="annot"><span class="annottext">jsonAgg :: SQLExp
</span><a href="#local-6989586621688399442"><span class="hs-identifier hs-var hs-var">jsonAgg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">SQLOp -&gt; [SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEOpApp"><span class="hs-identifier hs-var">S.SEOpApp</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLOp"><span class="hs-identifier hs-var">S.SQLOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399443"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEUnsafe"><span class="hs-identifier hs-var">S.SEUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonAggExtr"><span class="hs-identifier hs-type">withJsonAggExtr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PermissionLimitSubQuery"><span class="hs-identifier hs-type">PermissionLimitSubQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-type">S.OrderByExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-182"></span><span id="withJsonAggExtr"><span class="annot"><span class="annottext">withJsonAggExtr :: PermissionLimitSubQuery -&gt; Maybe OrderByExp -&gt; Alias -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonAggExtr"><span class="hs-identifier hs-var hs-var">withJsonAggExtr</span></a></span></span><span> </span><span id="local-6989586621688399437"><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399437"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span></span><span> </span><span id="local-6989586621688399436"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399436"><span class="hs-identifier hs-var">ordBy</span></a></span></span><span> </span><span id="local-6989586621688399435"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399435"><span class="hs-identifier hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-comment">-- if select has aggregations then use subquery to apply permission limit</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399437"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQRequired"><span class="hs-identifier hs-type">PLSQRequired</span></a></span><span> </span><span id="local-6989586621688399433"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399433"><span class="hs-identifier hs-var">permLimit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="#local-6989586621688399432"><span class="hs-identifier hs-var">withPermLimit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399433"><span class="hs-identifier hs-var">permLimit</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399430"><span class="hs-identifier hs-var">simpleJsonAgg</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621688399430"><span class="annot"><span class="annottext">simpleJsonAgg :: SQLExp
</span><a href="#local-6989586621688399430"><span class="hs-identifier hs-var hs-var">simpleJsonAgg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="#local-6989586621688399429"><span class="hs-identifier hs-var">mkSimpleJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399428"><span class="hs-identifier hs-var">rowIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399436"><span class="hs-identifier hs-var">ordBy</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621688399428"><span class="annot"><span class="annottext">rowIdenExp :: SQLExp
</span><a href="#local-6989586621688399428"><span class="hs-identifier hs-var hs-var">rowIdenExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#getAlias"><span class="hs-identifier hs-var hs-var">S.getAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399435"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621688399426"><span class="annot"><span class="annottext">subSelAls :: Identifier
</span><a href="#local-6989586621688399426"><span class="hs-identifier hs-var hs-var">subSelAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;sub_query&quot;</span></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621688399425"><span class="annot"><span class="annottext">unnestTable :: Identifier
</span><a href="#local-6989586621688399425"><span class="hs-identifier hs-var hs-var">unnestTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unnest_table&quot;</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621688399429"><span class="annot"><span class="annottext">mkSimpleJsonAgg :: SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="#local-6989586621688399429"><span class="hs-identifier hs-var hs-var">mkSimpleJsonAgg</span></a></span></span><span> </span><span id="local-6989586621688399424"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399424"><span class="hs-identifier hs-var">rowExp</span></a></span></span><span> </span><span id="local-6989586621688399423"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399423"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399422"><span class="annot"><span class="annottext">jsonAggExp :: SQLExp
</span><a href="#local-6989586621688399422"><span class="hs-identifier hs-var hs-var">jsonAggExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399424"><span class="hs-identifier hs-var">rowExp</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399423"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-195"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;coalesce&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399422"><span class="hs-identifier hs-var">jsonAggExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621688399432"><span class="annot"><span class="annottext">withPermLimit :: Int -&gt; SQLExp
</span><a href="#local-6989586621688399432"><span class="hs-identifier hs-var hs-var">withPermLimit</span></a></span></span><span> </span><span id="local-6989586621688399421"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399421"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399420"><span class="annot"><span class="annottext">subSelect :: Select
</span><a href="#local-6989586621688399420"><span class="hs-identifier hs-var hs-var">subSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Select
</span><a href="#local-6989586621688399419"><span class="hs-identifier hs-var">mkSubSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399421"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-199"></span><span>          </span><span id="local-6989586621688399418"><span class="annot"><span class="annottext">rowIdentifier :: SQLExp
</span><a href="#local-6989586621688399418"><span class="hs-identifier hs-var hs-var">rowIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399426"><span class="hs-identifier hs-var">subSelAls</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399435"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-200"></span><span>          </span><span id="local-6989586621688399416"><span class="annot"><span class="annottext">extr :: Extractor
</span><a href="#local-6989586621688399416"><span class="hs-identifier hs-var hs-var">extr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="#local-6989586621688399429"><span class="hs-identifier hs-var">mkSimpleJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399418"><span class="hs-identifier hs-var">rowIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399414"><span class="hs-identifier hs-var">newOrderBy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-201"></span><span>          </span><span id="local-6989586621688399413"><span class="annot"><span class="annottext">fromExp :: FromExp
</span><a href="#local-6989586621688399413"><span class="hs-identifier hs-var hs-var">fromExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="annot"><span class="annottext">([FromItem] -&gt; FromExp) -&gt; [FromItem] -&gt; FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-203"></span><span>              </span><span class="annot"><span class="annottext">FromItem -&gt; [FromItem]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(FromItem -&gt; [FromItem]) -&gt; FromItem -&gt; [FromItem]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-204"></span><span>                </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688399420"><span class="hs-identifier hs-var">subSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; FromItem) -&gt; Alias -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399426"><span class="hs-identifier hs-var">subSelAls</span></a></span><span>
</span><span id="line-205"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; SQLExp) -&gt; Select -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-206"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-207"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extractor -&gt; [Extractor]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399416"><span class="hs-identifier hs-var">extr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FromExp
</span><a href="#local-6989586621688399413"><span class="hs-identifier hs-var">fromExp</span></a></span><span>
</span><span id="line-209"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621688399419"><span class="annot"><span class="annottext">mkSubSelect :: Int -&gt; Select
</span><a href="#local-6989586621688399419"><span class="hs-identifier hs-var hs-var">mkSubSelect</span></a></span></span><span> </span><span id="local-6989586621688399405"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399405"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399404"><span class="annot"><span class="annottext">jsonRowExtr :: Extractor
</span><a href="#local-6989586621688399404"><span class="hs-identifier hs-var hs-var">jsonRowExtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>            </span><span class="annot"><span class="annottext">(SQLExp -&gt; Maybe Alias -&gt; Extractor)
-&gt; Maybe Alias -&gt; SQLExp -&gt; Extractor
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399435"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; Extractor) -&gt; SQLExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-214"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; Alias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399425"><span class="hs-identifier hs-var">unnestTable</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399435"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-215"></span><span>          </span><span id="local-6989586621688399402"><span class="annot"><span class="annottext">obExtrs :: [Extractor]
</span><a href="#local-6989586621688399402"><span class="hs-identifier hs-var hs-var">obExtrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Identifier -&gt; Extractor) -&gt; [Identifier] -&gt; [Extractor])
-&gt; [Identifier] -&gt; (Identifier -&gt; Extractor) -&gt; [Extractor]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Extractor) -&gt; [Identifier] -&gt; [Extractor]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621688399401"><span class="hs-identifier hs-var">newOBAliases</span></a></span><span> </span><span class="annot"><span class="annottext">((Identifier -&gt; Extractor) -&gt; [Extractor])
-&gt; (Identifier -&gt; Extractor) -&gt; [Extractor]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688399400"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399400"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>            </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399425"><span class="hs-identifier hs-var">unnestTable</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399400"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399400"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-217"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399404"><span class="hs-identifier hs-var">jsonRowExtr</span></a></span><span> </span><span class="annot"><span class="annottext">Extractor -&gt; [Extractor] -&gt; [Extractor]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688399402"><span class="hs-identifier hs-var">obExtrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>              </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="annot"><span class="annottext">([FromItem] -&gt; FromExp) -&gt; [FromItem] -&gt; FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromItem -&gt; [FromItem]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688399399"><span class="hs-identifier hs-var">unnestFromItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>              </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LimitExp -&gt; Maybe LimitExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LimitExp -&gt; Maybe LimitExp) -&gt; LimitExp -&gt; Maybe LimitExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; SQLExp -&gt; LimitExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399405"><span class="hs-identifier hs-var">limit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>              </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399414"><span class="hs-identifier hs-var">newOrderBy</span></a></span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621688399399"><span class="annot"><span class="annottext">unnestFromItem :: FromItem
</span><a href="#local-6989586621688399399"><span class="hs-identifier hs-var hs-var">unnestFromItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399394"><span class="annot"><span class="annottext">arrayAggItems :: [SQLExp]
</span><a href="#local-6989586621688399394"><span class="hs-identifier hs-var hs-var">arrayAggItems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SQLExp -&gt; SQLExp) -&gt; [SQLExp] -&gt; [SQLExp])
-&gt; [SQLExp] -&gt; (SQLExp -&gt; SQLExp) -&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; [SQLExp] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399428"><span class="hs-identifier hs-var">rowIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp] -&gt; [SQLExp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399393"><span class="hs-identifier hs-var">obCols</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((SQLExp -&gt; SQLExp) -&gt; [SQLExp]) -&gt; (SQLExp -&gt; SQLExp) -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621688399392"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399392"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;array_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399392"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-227"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; Alias -&gt; [SQLExp] -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIUnnest"><span class="hs-identifier hs-var">S.FIUnnest</span></a></span><span> </span><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399394"><span class="hs-identifier hs-var">arrayAggItems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399425"><span class="hs-identifier hs-var">unnestTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; FromItem) -&gt; [SQLExp] -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-228"></span><span>            </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399428"><span class="hs-identifier hs-var">rowIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp] -&gt; [SQLExp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; [Identifier] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621688399401"><span class="hs-identifier hs-var">newOBAliases</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621688399414"><span class="annot"><span class="annottext">newOrderBy :: Maybe OrderByExp
</span><a href="#local-6989586621688399414"><span class="hs-identifier hs-var hs-var">newOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; Maybe (NonEmpty OrderByItem) -&gt; Maybe OrderByExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItem] -&gt; Maybe (NonEmpty OrderByItem)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">NE.nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItem]
</span><a href="#local-6989586621688399388"><span class="hs-identifier hs-var">newOBItems</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399388"><span class="annot"><span class="annottext">[OrderByItem]
</span><a href="#local-6989586621688399388"><span class="hs-identifier hs-var">newOBItems</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399393"><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399393"><span class="hs-identifier hs-var">obCols</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399401"><span class="annot"><span class="annottext">[Identifier]
</span><a href="#local-6989586621688399401"><span class="hs-identifier hs-var">newOBAliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([OrderByItem], [SQLExp], [Identifier])
-&gt; (OrderByExp -&gt; ([OrderByItem], [SQLExp], [Identifier]))
-&gt; Maybe OrderByExp
-&gt; ([OrderByItem], [SQLExp], [Identifier])
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; ([OrderByItem], [SQLExp], [Identifier])
</span><a href="#local-6989586621688399386"><span class="hs-identifier hs-var">transformOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399436"><span class="hs-identifier hs-var">ordBy</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621688399386"><span class="annot"><span class="annottext">transformOrderBy :: OrderByExp -&gt; ([OrderByItem], [SQLExp], [Identifier])
</span><a href="#local-6989586621688399386"><span class="hs-identifier hs-var hs-var">transformOrderBy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-type">S.OrderByExp</span></a></span><span> </span><span id="local-6989586621688399385"><span class="annot"><span class="annottext">NonEmpty OrderByItem
</span><a href="#local-6989586621688399385"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(OrderByItem, SQLExp, Identifier)]
-&gt; ([OrderByItem], [SQLExp], [Identifier])
forall a b c. [(a, b, c)] -&gt; ([a], [b], [c])
</span><span class="hs-identifier hs-var">unzip3</span></span><span> </span><span class="annot"><span class="annottext">([(OrderByItem, SQLExp, Identifier)]
 -&gt; ([OrderByItem], [SQLExp], [Identifier]))
-&gt; [(OrderByItem, SQLExp, Identifier)]
-&gt; ([OrderByItem], [SQLExp], [Identifier])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">(((OrderByItem, Int) -&gt; (OrderByItem, SQLExp, Identifier))
 -&gt; [(OrderByItem, Int)] -&gt; [(OrderByItem, SQLExp, Identifier)])
-&gt; [(OrderByItem, Int)]
-&gt; ((OrderByItem, Int) -&gt; (OrderByItem, SQLExp, Identifier))
-&gt; [(OrderByItem, SQLExp, Identifier)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((OrderByItem, Int) -&gt; (OrderByItem, SQLExp, Identifier))
-&gt; [(OrderByItem, Int)] -&gt; [(OrderByItem, SQLExp, Identifier)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OrderByItem] -&gt; [Int] -&gt; [(OrderByItem, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; [OrderByItem]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem
</span><a href="#local-6989586621688399385"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((OrderByItem, Int) -&gt; (OrderByItem, SQLExp, Identifier))
 -&gt; [(OrderByItem, SQLExp, Identifier)])
-&gt; ((OrderByItem, Int) -&gt; (OrderByItem, SQLExp, Identifier))
-&gt; [(OrderByItem, SQLExp, Identifier)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688399382"><span class="annot"><span class="annottext">OrderByItem
</span><a href="#local-6989586621688399382"><span class="hs-identifier hs-var">obItem</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399381"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399381"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399380"><span class="annot"><span class="annottext">iden :: Identifier
</span><a href="#local-6989586621688399380"><span class="hs-identifier hs-var hs-var">iden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Identifier) -&gt; Text -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ob_col_&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399381"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-236"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">OrderByItem
</span><a href="#local-6989586621688399382"><span class="hs-identifier hs-var">obItem</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">oColumn :: SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#oColumn"><span class="hs-identifier hs-var">S.oColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399380"><span class="hs-identifier hs-var">iden</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>              </span><span class="annot"><span class="annottext">OrderByItem -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#oColumn"><span class="hs-identifier hs-var hs-var">S.oColumn</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItem
</span><a href="#local-6989586621688399382"><span class="hs-identifier hs-var">obItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>              </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399380"><span class="hs-identifier hs-var">iden</span></a></span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#asJsonAggExtr"><span class="hs-identifier hs-type">asJsonAggExtr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#JsonAggSelect"><span class="hs-identifier hs-type">JsonAggSelect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PermissionLimitSubQuery"><span class="hs-identifier hs-type">PermissionLimitSubQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-type">S.OrderByExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span>
</span><span id="line-243"></span><span id="asJsonAggExtr"><span class="annot"><span class="annottext">asJsonAggExtr :: JsonAggSelect
-&gt; Alias
-&gt; PermissionLimitSubQuery
-&gt; Maybe OrderByExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asJsonAggExtr"><span class="hs-identifier hs-var hs-var">asJsonAggExtr</span></a></span></span><span> </span><span id="local-6989586621688399376"><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688399376"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span></span><span> </span><span id="local-6989586621688399375"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399375"><span class="hs-identifier hs-var">als</span></a></span></span><span> </span><span id="local-6989586621688399374"><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399374"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span></span><span> </span><span id="local-6989586621688399373"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399373"><span class="hs-identifier hs-var">ordByExpM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">(SQLExp -&gt; Maybe Alias -&gt; Extractor)
-&gt; Maybe Alias -&gt; SQLExp -&gt; Extractor
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399375"><span class="hs-identifier hs-var">als</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; Extractor) -&gt; SQLExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688399376"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="Hasura.RQL.Types.Common.html#JASMultipleRows"><span class="hs-identifier hs-var">JASMultipleRows</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery -&gt; Maybe OrderByExp -&gt; Alias -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonAggExtr"><span class="hs-identifier hs-var">withJsonAggExtr</span></a></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399374"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688399373"><span class="hs-identifier hs-var">ordByExpM</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399375"><span class="hs-identifier hs-var">als</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="Hasura.RQL.Types.Common.html#JASSingleObject"><span class="hs-identifier hs-var">JASSingleObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asSingleRowExtr"><span class="hs-identifier hs-var">asSingleRowExtr</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399375"><span class="hs-identifier hs-var">als</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- array relationships are not grouped, so have to be prefixed by</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- parent's alias</span><span>
</span><span id="line-250"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkUniqArrayRelationAlias"><span class="hs-identifier hs-type">mkUniqArrayRelationAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-251"></span><span id="mkUniqArrayRelationAlias"><span class="annot"><span class="annottext">mkUniqArrayRelationAlias :: FieldName -&gt; [FieldName] -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkUniqArrayRelationAlias"><span class="hs-identifier hs-var hs-var">mkUniqArrayRelationAlias</span></a></span></span><span> </span><span id="local-6989586621688399369"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399369"><span class="hs-identifier hs-var">parAls</span></a></span></span><span> </span><span id="local-6989586621688399368"><span class="annot"><span class="annottext">[FieldName]
</span><a href="#local-6989586621688399368"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399367"><span class="annot"><span class="annottext">sortedFields :: [FieldName]
</span><a href="#local-6989586621688399367"><span class="hs-identifier hs-var hs-var">sortedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldName] -&gt; [FieldName]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">[FieldName]
</span><a href="#local-6989586621688399368"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-253"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Identifier) -&gt; Text -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399369"><span class="hs-identifier hs-var">parAls</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldName -&gt; Text) -&gt; [FieldName] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldName]
</span><a href="#local-6989586621688399367"><span class="hs-identifier hs-var">sortedFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationTableAlias"><span class="hs-identifier hs-type">mkArrayRelationTableAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-258"></span><span id="mkArrayRelationTableAlias"><span class="annot"><span class="annottext">mkArrayRelationTableAlias :: Identifier -&gt; FieldName -&gt; [FieldName] -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationTableAlias"><span class="hs-identifier hs-var hs-var">mkArrayRelationTableAlias</span></a></span></span><span> </span><span id="local-6989586621688399362"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399362"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399361"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399361"><span class="hs-identifier hs-var">parAls</span></a></span></span><span> </span><span id="local-6989586621688399360"><span class="annot"><span class="annottext">[FieldName]
</span><a href="#local-6989586621688399360"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399362"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.ar.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399359"><span class="hs-identifier hs-var">uniqArrRelAls</span></a></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621688399359"><span class="annot"><span class="annottext">uniqArrRelAls :: Identifier
</span><a href="#local-6989586621688399359"><span class="hs-identifier hs-var hs-var">uniqArrRelAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; [FieldName] -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkUniqArrayRelationAlias"><span class="hs-identifier hs-var">mkUniqArrayRelationAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399361"><span class="hs-identifier hs-var">parAls</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldName]
</span><a href="#local-6989586621688399360"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-type">mkObjectRelationTableAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#RelName"><span class="hs-identifier hs-type">RelName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-264"></span><span id="mkObjectRelationTableAlias"><span class="annot"><span class="annottext">mkObjectRelationTableAlias :: Identifier -&gt; RelName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-var hs-var">mkObjectRelationTableAlias</span></a></span></span><span> </span><span id="local-6989586621688399357"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399357"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399356"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688399356"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399357"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.or.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688399356"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-type">mkComputedFieldTableAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-268"></span><span id="mkComputedFieldTableAlias"><span class="annot"><span class="annottext">mkComputedFieldTableAlias :: Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var hs-var">mkComputedFieldTableAlias</span></a></span></span><span> </span><span id="local-6989586621688399354"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399354"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399353"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399353"><span class="hs-identifier hs-var">fldAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399354"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.cf.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399353"><span class="hs-identifier hs-var">fldAls</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-type">mkBaseTableAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-272"></span><span id="mkBaseTableAlias"><span class="annot"><span class="annottext">mkBaseTableAlias :: Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var hs-var">mkBaseTableAlias</span></a></span></span><span> </span><span id="local-6989586621688399351"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399351"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399351"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.base&quot;</span></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-type">mkBaseTableColumnAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-276"></span><span id="mkBaseTableColumnAlias"><span class="annot"><span class="annottext">mkBaseTableColumnAlias :: Identifier -&gt; PGCol -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-var hs-var">mkBaseTableColumnAlias</span></a></span></span><span> </span><span id="local-6989586621688399349"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399349"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399348"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688399348"><span class="hs-identifier hs-var">pgColumn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399349"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.pg.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688399348"><span class="hs-identifier hs-var">pgColumn</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span id="local-6989586621688399826"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-type">mkOrderByFieldName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Text.Extended.html#ToTxt"><span class="hs-identifier hs-type">ToTxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399826"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688399826"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span></span><span>
</span><span id="line-280"></span><span id="mkOrderByFieldName"><span class="annot"><span class="annottext">mkOrderByFieldName :: a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var hs-var">mkOrderByFieldName</span></a></span></span><span> </span><span id="local-6989586621688399346"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399346"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FieldName) -&gt; Text -&gt; FieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399346"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;order_by&quot;</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span id="local-6989586621688399833"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-type">mkAggregateOrderByAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedAggregateOrderBy"><span class="hs-identifier hs-type">AnnotatedAggregateOrderBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399833"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span></span><span>
</span><span id="line-284"></span><span id="mkAggregateOrderByAlias"><span class="annot"><span class="annottext">mkAggregateOrderByAlias :: AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var hs-var">mkAggregateOrderByAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; (Text -&gt; Identifier) -&gt; Text -&gt; Alias
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Alias)
-&gt; (AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Text)
-&gt; AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; Alias
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="Hasura.RQL.IR.Select.html#AAOCount"><span class="hs-identifier hs-var">AAOCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AAOOp"><span class="hs-identifier hs-type">AAOOp</span></a></span><span> </span><span id="local-6989586621688399341"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399341"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621688399340"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399340"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399341"><span class="hs-identifier hs-var">opText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399340"><span class="hs-identifier hs-var">col</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-type">mkArrayRelationSourcePrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-295"></span><span id="mkArrayRelationSourcePrefix"><span class="annot"><span class="annottext">mkArrayRelationSourcePrefix :: Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; FieldName
-&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-var hs-var">mkArrayRelationSourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688399336"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399336"><span class="hs-identifier hs-var">parentSourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688399335"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399335"><span class="hs-identifier hs-var">parentFieldName</span></a></span></span><span> </span><span id="local-6989586621688399334"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399334"><span class="hs-identifier hs-var">similarFieldsMap</span></a></span></span><span> </span><span id="local-6989586621688399333"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399333"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; [FieldName] -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationTableAlias"><span class="hs-identifier hs-var">mkArrayRelationTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399336"><span class="hs-identifier hs-var">parentSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399335"><span class="hs-identifier hs-var">parentFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldName] -&gt; Identifier) -&gt; [FieldName] -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">[FieldName]
-&gt; FieldName -&gt; HashMap FieldName [FieldName] -&gt; [FieldName]
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.lookupDefault</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399333"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399333"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399334"><span class="hs-identifier hs-var">similarFieldsMap</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationAlias"><span class="hs-identifier hs-type">mkArrayRelationAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span>
</span><span id="line-304"></span><span id="mkArrayRelationAlias"><span class="annot"><span class="annottext">mkArrayRelationAlias :: FieldName -&gt; HashMap FieldName [FieldName] -&gt; FieldName -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationAlias"><span class="hs-identifier hs-var hs-var">mkArrayRelationAlias</span></a></span></span><span> </span><span id="local-6989586621688399330"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399330"><span class="hs-identifier hs-var">parentFieldName</span></a></span></span><span> </span><span id="local-6989586621688399329"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399329"><span class="hs-identifier hs-var">similarFieldsMap</span></a></span></span><span> </span><span id="local-6989586621688399328"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399328"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">FieldName -&gt; [FieldName] -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkUniqArrayRelationAlias"><span class="hs-identifier hs-var">mkUniqArrayRelationAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399330"><span class="hs-identifier hs-var">parentFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldName] -&gt; Identifier) -&gt; [FieldName] -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-307"></span><span>      </span><span class="annot"><span class="annottext">[FieldName]
-&gt; FieldName -&gt; HashMap FieldName [FieldName] -&gt; [FieldName]
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.lookupDefault</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399328"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399328"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399329"><span class="hs-identifier hs-var">similarFieldsMap</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#fromTableRowArgs"><span class="hs-identifier hs-type">fromTableRowArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FunctionArgsExpTableRow"><span class="hs-identifier hs-type">FunctionArgsExpTableRow</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionArgs"><span class="hs-identifier hs-type">S.FunctionArgs</span></a></span><span>
</span><span id="line-311"></span><span id="fromTableRowArgs"><span class="annot"><span class="annottext">fromTableRowArgs :: Identifier -&gt; FunctionArgsExpTableRow SQLExp -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#fromTableRowArgs"><span class="hs-identifier hs-var hs-var">fromTableRowArgs</span></a></span></span><span> </span><span id="local-6989586621688399327"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399327"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpG SQLExp -&gt; FunctionArgs
</span><a href="#local-6989586621688399326"><span class="hs-identifier hs-var">toFunctionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(FunctionArgsExpG SQLExp -&gt; FunctionArgs)
-&gt; (FunctionArgsExpTableRow SQLExp -&gt; FunctionArgsExpG SQLExp)
-&gt; FunctionArgsExpTableRow SQLExp
-&gt; FunctionArgs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ArgumentExp SQLExp -&gt; SQLExp)
-&gt; FunctionArgsExpTableRow SQLExp -&gt; FunctionArgsExpG SQLExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ArgumentExp SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688399325"><span class="hs-identifier hs-var">toSQLExp</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621688399326"><span class="annot"><span class="annottext">toFunctionArgs :: FunctionArgsExpG SQLExp -&gt; FunctionArgs
</span><a href="#local-6989586621688399326"><span class="hs-identifier hs-var hs-var">toFunctionArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#FunctionArgsExp"><span class="hs-identifier hs-type">FunctionArgsExp</span></a></span><span> </span><span id="local-6989586621688399323"><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399323"><span class="hs-identifier hs-var">positional</span></a></span></span><span> </span><span id="local-6989586621688399322"><span class="annot"><span class="annottext">HashMap Text SQLExp
</span><a href="#local-6989586621688399322"><span class="hs-identifier hs-var">named</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; HashMap Text SQLExp -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionArgs"><span class="hs-identifier hs-var">S.FunctionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399323"><span class="hs-identifier hs-var">positional</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text SQLExp
</span><a href="#local-6989586621688399322"><span class="hs-identifier hs-var">named</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621688399325"><span class="annot"><span class="annottext">toSQLExp :: ArgumentExp SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688399325"><span class="hs-identifier hs-var hs-var">toSQLExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>      </span><span class="annot"><span class="annottext">SQLExp -&gt; (Text -&gt; SQLExp) -&gt; ArgumentExp SQLExp -&gt; SQLExp
forall a. a -&gt; (Text -&gt; a) -&gt; ArgumentExp a -&gt; a
</span><a href="Hasura.RQL.IR.Select.html#onArgumentExp"><span class="hs-identifier hs-var">onArgumentExp</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SERowIdentifier"><span class="hs-identifier hs-var">S.SERowIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399318"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399318"><span class="hs-identifier hs-var">alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; (Text -&gt; Identifier) -&gt; Text -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621688399318"><span class="annot"><span class="annottext">alias :: Identifier
</span><a href="#local-6989586621688399318"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399327"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- uses row_to_json to build a json object</span><span>
</span><span id="line-322"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withRowToJSON"><span class="hs-identifier hs-type">withRowToJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-323"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span id="withRowToJSON"><span class="annot"><span class="annottext">withRowToJSON :: FieldName -&gt; [Extractor] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withRowToJSON"><span class="hs-identifier hs-var hs-var">withRowToJSON</span></a></span></span><span> </span><span id="local-6989586621688399316"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399316"><span class="hs-identifier hs-var">parAls</span></a></span></span><span> </span><span id="local-6989586621688399315"><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688399315"><span class="hs-identifier hs-var">extrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName -&gt; Alias
forall a. IsIdentifier a =&gt; a -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#toAlias"><span class="hs-identifier hs-var">S.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399316"><span class="hs-identifier hs-var">parAls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399313"><span class="hs-identifier hs-var">jsonRow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621688399313"><span class="annot"><span class="annottext">jsonRow :: SQLExp
</span><a href="#local-6989586621688399313"><span class="hs-identifier hs-var hs-var">jsonRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyRowToJson"><span class="hs-identifier hs-var">S.applyRowToJson</span></a></span><span> </span><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688399315"><span class="hs-identifier hs-var">extrs</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- uses json_build_object to build a json object</span><span>
</span><span id="line-330"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonBuildObj"><span class="hs-identifier hs-type">withJsonBuildObj</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span id="withJsonBuildObj"><span class="annot"><span class="annottext">withJsonBuildObj :: FieldName -&gt; [SQLExp] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonBuildObj"><span class="hs-identifier hs-var hs-var">withJsonBuildObj</span></a></span></span><span> </span><span id="local-6989586621688399310"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399310"><span class="hs-identifier hs-var">parAls</span></a></span></span><span> </span><span id="local-6989586621688399309"><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399309"><span class="hs-identifier hs-var">exps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName -&gt; Alias
forall a. IsIdentifier a =&gt; a -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#toAlias"><span class="hs-identifier hs-var">S.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399310"><span class="hs-identifier hs-var">parAls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399308"><span class="hs-identifier hs-var">jsonRow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621688399308"><span class="annot"><span class="annottext">jsonRow :: SQLExp
</span><a href="#local-6989586621688399308"><span class="hs-identifier hs-var hs-var">jsonRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">[SQLExp]
</span><a href="#local-6989586621688399309"><span class="hs-identifier hs-var">exps</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">-- | Forces aggregation</span><span>
</span><span id="line-338"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-type">withForceAggregation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#TypeAnn"><span class="hs-identifier hs-type">S.TypeAnn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-339"></span><span id="withForceAggregation"><span class="annot"><span class="annottext">withForceAggregation :: TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var hs-var">withForceAggregation</span></a></span></span><span> </span><span id="local-6989586621688399306"><span class="annot"><span class="annottext">TypeAnn
</span><a href="#local-6989586621688399306"><span class="hs-identifier hs-var">tyAnn</span></a></span></span><span> </span><span id="local-6989586621688399305"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399305"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-comment">-- bool_or to force aggregation</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;coalesce&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399305"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; TypeAnn -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SETyAnn"><span class="hs-identifier hs-var">S.SETyAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEUnsafe"><span class="hs-identifier hs-var">S.SEUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;bool_or('true')&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="#local-6989586621688399306"><span class="hs-identifier hs-var">tyAnn</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-type">mkAggregateOrderByExtractorAndFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399649"><span class="annot"><a href="#local-6989586621688399649"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399649"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedAggregateOrderBy"><span class="hs-identifier hs-type">AnnotatedAggregateOrderBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399649"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AggregateFields"><span class="hs-identifier hs-type">AggregateFields</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399649"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span id="mkAggregateOrderByExtractorAndFields"><span class="annot"><span class="annottext">mkAggregateOrderByExtractorAndFields :: AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-var hs-var">mkAggregateOrderByExtractorAndFields</span></a></span></span><span> </span><span id="local-6989586621688399302"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399302"><span class="hs-identifier hs-var">annAggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399302"><span class="hs-identifier hs-var">annAggOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="Hasura.RQL.IR.Select.html#AAOCount"><span class="hs-identifier hs-var">AAOCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#countStar"><span class="hs-identifier hs-var">S.countStar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
</span><a href="#local-6989586621688399300"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CountType ('Postgres pgKind) -&gt; AggregateField ('Postgres pgKind)
forall (b :: BackendType). CountType b -&gt; AggregateField b
</span><a href="Hasura.RQL.IR.Select.html#AFCount"><span class="hs-identifier hs-var">AFCount</span></a></span><span> </span><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
CountType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#CTStar"><span class="hs-identifier hs-var">S.CTStar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AAOOp"><span class="hs-identifier hs-type">AAOOp</span></a></span><span> </span><span id="local-6989586621688399298"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399298"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621688399297"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399297"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399296"><span class="annot"><span class="annottext">pgColumn :: Column ('Postgres pgKind)
</span><a href="#local-6989586621688399296"><span class="hs-identifier hs-var hs-var">pgColumn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399297"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-356"></span><span>          </span><span id="local-6989586621688399295"><span class="annot"><span class="annottext">pgType :: ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688399295"><span class="hs-identifier hs-var hs-var">pgType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; ColumnType ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; ColumnType b
</span><a href="Hasura.RQL.Types.Column.html#ciType"><span class="hs-identifier hs-var hs-var">ciType</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399297"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399298"><span class="hs-identifier hs-var">opText</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688399296"><span class="hs-identifier hs-var">pgColumn</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Alias
</span><a href="#local-6989586621688399300"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-358"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399298"><span class="hs-identifier hs-var">opText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-359"></span><span>                </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind) -&gt; AggregateField ('Postgres pgKind)
forall (b :: BackendType). AggregateOp b -&gt; AggregateField b
</span><a href="Hasura.RQL.IR.Select.html#AFOp"><span class="hs-identifier hs-var">AFOp</span></a></span><span> </span><span class="annot"><span class="annottext">(AggregateOp ('Postgres pgKind)
 -&gt; AggregateField ('Postgres pgKind))
-&gt; AggregateOp ('Postgres pgKind)
-&gt; AggregateField ('Postgres pgKind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-360"></span><span>                  </span><span class="annot"><span class="annottext">Text
-&gt; ColumnFields ('Postgres pgKind)
-&gt; AggregateOp ('Postgres pgKind)
forall (b :: BackendType). Text -&gt; ColumnFields b -&gt; AggregateOp b
</span><a href="Hasura.RQL.IR.Select.html#AggregateOp"><span class="hs-identifier hs-var">AggregateOp</span></a></span><span>
</span><span id="line-361"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399298"><span class="hs-identifier hs-var">opText</span></a></span><span>
</span><span id="line-362"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind) -&gt; FieldName
forall (b :: BackendType). Backend b =&gt; Column b -&gt; FieldName
</span><a href="Hasura.RQL.Types.Column.html#fromCol"><span class="hs-identifier hs-var">fromCol</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399649"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
</span><a href="#local-6989586621688399296"><span class="hs-identifier hs-var">pgColumn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-363"></span><span>                        </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
-&gt; ColumnType ('Postgres pgKind) -&gt; ColFld ('Postgres pgKind)
forall (b :: BackendType). Column b -&gt; ColumnType b -&gt; ColFld b
</span><a href="Hasura.RQL.IR.Select.html#CFCol"><span class="hs-identifier hs-var">CFCol</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
</span><a href="#local-6989586621688399296"><span class="hs-identifier hs-var">pgColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688399295"><span class="hs-identifier hs-var">pgType</span></a></span><span>
</span><span id="line-364"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-366"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621688399300"><span class="annot"><span class="annottext">alias :: Maybe Alias
</span><a href="#local-6989586621688399300"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399302"><span class="hs-identifier hs-var">annAggOrderBy</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- | Generate alias for order by extractors</span><span>
</span><span id="line-373"></span><span id="local-6989586621688399824"><span id="local-6989586621688399825"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-type">mkAnnOrderByAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399825"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399824"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span></span></span><span>
</span><span id="line-375"></span><span id="mkAnnOrderByAlias"><span class="annot"><span class="annottext">mkAnnOrderByAlias :: Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var hs-var">mkAnnOrderByAlias</span></a></span></span><span> </span><span id="local-6989586621688399290"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399289"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399289"><span class="hs-identifier hs-var">parAls</span></a></span></span><span> </span><span id="local-6989586621688399288"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399288"><span class="hs-identifier hs-var">similarFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621688399286"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399286"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399285"><span class="annot"><span class="annottext">pgColumn :: Column ('Postgres pgKind)
</span><a href="#local-6989586621688399285"><span class="hs-identifier hs-var hs-var">pgColumn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399286"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span id="local-6989586621688399284"><span class="annot"><span class="annottext">obColAls :: Identifier
</span><a href="#local-6989586621688399284"><span class="hs-identifier hs-var hs-var">obColAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-var">mkBaseTableColumnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688399285"><span class="hs-identifier hs-var">pgColumn</span></a></span><span>
</span><span id="line-379"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399284"><span class="hs-identifier hs-var">obColAls</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-comment">-- &quot;pfx.or.relname&quot;.&quot;pfx.ob.or.relname.rest&quot; AS &quot;pfx.ob.or.relname.rest&quot;</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCObjectRelation"><span class="hs-identifier hs-type">AOCObjectRelation</span></a></span><span> </span><span id="local-6989586621688399282"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399282"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399281"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) v
</span><a href="#local-6989586621688399281"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399280"><span class="annot"><span class="annottext">rn :: RelName
</span><a href="#local-6989586621688399280"><span class="hs-identifier hs-var hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind) -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399282"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-383"></span><span>        </span><span id="local-6989586621688399278"><span class="annot"><span class="annottext">relPfx :: Identifier
</span><a href="#local-6989586621688399278"><span class="hs-identifier hs-var hs-var">relPfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; RelName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-var">mkObjectRelationTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688399280"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span id="local-6989586621688399277"><span class="annot"><span class="annottext">ordByFldName :: FieldName
</span><a href="#local-6989586621688399277"><span class="hs-identifier hs-var hs-var">ordByFldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688399280"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-385"></span><span>        </span><span id="local-6989586621688399276"><span class="annot"><span class="annottext">nesAls :: Alias
</span><a href="#local-6989586621688399276"><span class="hs-identifier hs-var hs-var">nesAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
forall (pgKind :: PostgresKind) v.
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var">mkAnnOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399278"><span class="hs-identifier hs-var">relPfx</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399277"><span class="hs-identifier hs-var">ordByFldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) v
</span><a href="#local-6989586621688399281"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-386"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399276"><span class="hs-identifier hs-var">nesAls</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621688399274"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399274"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399273"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399273"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399272"><span class="annot"><span class="annottext">rn :: RelName
</span><a href="#local-6989586621688399272"><span class="hs-identifier hs-var hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind) -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688399274"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span id="local-6989586621688399271"><span class="annot"><span class="annottext">arrPfx :: Identifier
</span><a href="#local-6989586621688399271"><span class="hs-identifier hs-var hs-var">arrPfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>          </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; FieldName
-&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-var">mkArrayRelationSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399289"><span class="hs-identifier hs-var">parAls</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399288"><span class="hs-identifier hs-var">similarFields</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldName -&gt; Identifier) -&gt; FieldName -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-391"></span><span>            </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688399272"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span id="local-6989586621688399270"><span class="annot"><span class="annottext">obAls :: Identifier
</span><a href="#local-6989586621688399270"><span class="hs-identifier hs-var hs-var">obAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399271"><span class="hs-identifier hs-var">arrPfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399273"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399270"><span class="hs-identifier hs-var">obAls</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCComputedField"><span class="hs-identifier hs-type">AOCComputedField</span></a></span><span> </span><span id="local-6989586621688399268"><span class="annot"><span class="annottext">ComputedFieldOrderBy ('Postgres pgKind) v
</span><a href="#local-6989586621688399268"><span class="hs-identifier hs-var">cfOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399267"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621688399267"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; FieldName
</span><a href="Hasura.RQL.Types.ComputedField.html#fromComputedField"><span class="hs-identifier hs-var">fromComputedField</span></a></span><span> </span><span class="annot"><span class="annottext">(ComputedFieldName -&gt; FieldName) -&gt; ComputedFieldName -&gt; FieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy ('Postgres pgKind) v -&gt; ComputedFieldName
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldName
</span><a href="Hasura.RQL.IR.Select.html#_cfobName"><span class="hs-identifier hs-var hs-var">_cfobName</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy ('Postgres pgKind) v
</span><a href="#local-6989586621688399268"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span>
</span><span id="line-396"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy ('Postgres pgKind) v
-&gt; ComputedFieldOrderByElement ('Postgres pgKind) v
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
</span><a href="Hasura.RQL.IR.Select.html#_cfobOrderByElement"><span class="hs-identifier hs-var hs-var">_cfobOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy ('Postgres pgKind) v
</span><a href="#local-6989586621688399268"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-397"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBEScalar"><span class="hs-identifier hs-type">CFOBEScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var">mkComputedFieldTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399267"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-398"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBETableAggregation"><span class="hs-identifier hs-type">CFOBETableAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399261"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399261"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399260"><span class="annot"><span class="annottext">cfPfx :: Identifier
</span><a href="#local-6989586621688399260"><span class="hs-identifier hs-var hs-var">cfPfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var">mkComputedFieldTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399290"><span class="hs-identifier hs-var">pfx</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399267"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-400"></span><span>                </span><span id="local-6989586621688399259"><span class="annot"><span class="annottext">obAls :: Identifier
</span><a href="#local-6989586621688399259"><span class="hs-identifier hs-var hs-var">obAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399260"><span class="hs-identifier hs-var">cfPfx</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; Identifier
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688399261"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399259"><span class="hs-identifier hs-var">obAls</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtBase"><span class="hs-identifier hs-type">applyDistinctOnAtBase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctExpr"><span class="hs-identifier hs-type">S.DistinctExpr</span></a></span><span>
</span><span id="line-405"></span><span id="applyDistinctOnAtBase"><span class="annot"><span class="annottext">applyDistinctOnAtBase :: NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var hs-var">applyDistinctOnAtBase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="annottext">[SQLExp] -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctOn"><span class="hs-identifier hs-var">S.DistinctOn</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; DistinctExpr)
-&gt; (NonEmpty PGCol -&gt; [SQLExp]) -&gt; NonEmpty PGCol -&gt; DistinctExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; [PGCol] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; (PGCol -&gt; Identifier) -&gt; PGCol -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PGCol] -&gt; [SQLExp])
-&gt; (NonEmpty PGCol -&gt; [PGCol]) -&gt; NonEmpty PGCol -&gt; [SQLExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; [PGCol]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtNode"><span class="hs-identifier hs-type">applyDistinctOnAtNode</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctExpr"><span class="hs-identifier hs-type">S.DistinctExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- additional column extractors</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="applyDistinctOnAtNode"><span class="annot"><span class="annottext">applyDistinctOnAtNode :: Identifier -&gt; NonEmpty PGCol -&gt; (DistinctExpr, [(Alias, SQLExp)])
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtNode"><span class="hs-identifier hs-var hs-var">applyDistinctOnAtNode</span></a></span></span><span> </span><span id="local-6989586621688399255"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399255"><span class="hs-identifier hs-var">pfx</span></a></span></span><span> </span><span id="local-6989586621688399254"><span class="annot"><span class="annottext">NonEmpty PGCol
</span><a href="#local-6989586621688399254"><span class="hs-identifier hs-var">neCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistinctExpr
</span><a href="#local-6989586621688399253"><span class="hs-identifier hs-var">distOnExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399252"><span class="hs-identifier hs-var">colExtrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621688399251"><span class="annot"><span class="annottext">cols :: [PGCol]
</span><a href="#local-6989586621688399251"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; [PGCol]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol
</span><a href="#local-6989586621688399254"><span class="hs-identifier hs-var">neCols</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621688399253"><span class="annot"><span class="annottext">distOnExp :: DistinctExpr
</span><a href="#local-6989586621688399253"><span class="hs-identifier hs-var hs-var">distOnExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DistinctOn"><span class="hs-identifier hs-var">S.DistinctOn</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; DistinctExpr) -&gt; [SQLExp] -&gt; DistinctExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; [PGCol] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; (PGCol -&gt; Identifier) -&gt; PGCol -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Identifier) -&gt; (PGCol -&gt; Alias) -&gt; PGCol -&gt; Identifier
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Alias
</span><a href="#local-6989586621688399250"><span class="hs-identifier hs-var">mkQColAls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621688399251"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621688399249"><span class="annot"><span class="annottext">mkQCol :: PGCol -&gt; SQLExp
</span><a href="#local-6989586621688399249"><span class="hs-identifier hs-var hs-var">mkQCol</span></a></span></span><span> </span><span id="local-6989586621688399248"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688399248"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399255"><span class="hs-identifier hs-var">pfx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688399248"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621688399250"><span class="annot"><span class="annottext">mkQColAls :: PGCol -&gt; Alias
</span><a href="#local-6989586621688399250"><span class="hs-identifier hs-var hs-var">mkQColAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; (PGCol -&gt; Identifier) -&gt; PGCol -&gt; Alias
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-var">mkBaseTableColumnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399255"><span class="hs-identifier hs-var">pfx</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621688399252"><span class="annot"><span class="annottext">colExtrs :: [(Alias, SQLExp)]
</span><a href="#local-6989586621688399252"><span class="hs-identifier hs-var hs-var">colExtrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PGCol -&gt; (Alias, SQLExp)) -&gt; [PGCol] -&gt; [(Alias, SQLExp)])
-&gt; [PGCol] -&gt; (PGCol -&gt; (Alias, SQLExp)) -&gt; [(Alias, SQLExp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; (Alias, SQLExp)) -&gt; [PGCol] -&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621688399251"><span class="hs-identifier hs-var">cols</span></a></span><span> </span><span class="annot"><span class="annottext">((PGCol -&gt; (Alias, SQLExp)) -&gt; [(Alias, SQLExp)])
-&gt; (PGCol -&gt; (Alias, SQLExp)) -&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Alias
</span><a href="#local-6989586621688399250"><span class="hs-identifier hs-var">mkQColAls</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Alias) -&gt; (PGCol -&gt; SQLExp) -&gt; PGCol -&gt; (Alias, SQLExp)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; SQLExp
</span><a href="#local-6989586621688399249"><span class="hs-identifier hs-var">mkQCol</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-keyword">type</span><span> </span><span id="SimilarArrayFields"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-var">SimilarArrayFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSimilarArrayFields"><span class="hs-identifier hs-type">mkSimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399712"><span class="annot"><a href="#local-6989586621688399712"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399711"><span class="annot"><a href="#local-6989586621688399711"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399712"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621688399711"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnFieldsG"><span class="hs-identifier hs-type">AnnFieldsG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399712"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621688399711"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItemG"><span class="hs-identifier hs-type">AnnotatedOrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399712"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399711"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span>
</span><span id="line-430"></span><span id="mkSimilarArrayFields"><span class="annot"><span class="annottext">mkSimilarArrayFields :: AnnFieldsG ('Postgres pgKind) Void v
-&gt; Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
-&gt; HashMap FieldName [FieldName]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSimilarArrayFields"><span class="hs-identifier hs-var hs-var">mkSimilarArrayFields</span></a></span></span><span> </span><span id="local-6989586621688399245"><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void v
</span><a href="#local-6989586621688399245"><span class="hs-identifier hs-var">annFields</span></a></span></span><span> </span><span id="local-6989586621688399244"><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
</span><a href="#local-6989586621688399244"><span class="hs-identifier hs-var">maybeOrderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>  </span><span class="annot"><span class="annottext">[(FieldName, [FieldName])] -&gt; HashMap FieldName [FieldName]
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(FieldName, [FieldName])] -&gt; HashMap FieldName [FieldName])
-&gt; [(FieldName, [FieldName])] -&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">((((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
  -&gt; (FieldName, [FieldName]))
 -&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
 -&gt; [(FieldName, [FieldName])])
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; (((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
    -&gt; (FieldName, [FieldName]))
-&gt; [(FieldName, [FieldName])]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
 -&gt; (FieldName, [FieldName]))
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [(FieldName, [FieldName])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399242"><span class="hs-identifier hs-var">allTuples</span></a></span><span> </span><span class="annot"><span class="annottext">((((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
  -&gt; (FieldName, [FieldName]))
 -&gt; [(FieldName, [FieldName])])
-&gt; (((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
    -&gt; (FieldName, [FieldName]))
-&gt; [(FieldName, [FieldName])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-433"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688399241"><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="#local-6989586621688399241"><span class="hs-identifier hs-var">relNameAndArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399240"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399240"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399240"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v) -&gt; [FieldName]
</span><a href="#local-6989586621688399239"><span class="hs-identifier hs-var">getSimilarFields</span></a></span><span> </span><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="#local-6989586621688399241"><span class="hs-identifier hs-var">relNameAndArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621688399239"><span class="annot"><span class="annottext">getSimilarFields :: (RelName, SelectArgsG ('Postgres pgKind) v) -&gt; [FieldName]
</span><a href="#local-6989586621688399239"><span class="hs-identifier hs-var hs-var">getSimilarFields</span></a></span></span><span> </span><span id="local-6989586621688399238"><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="#local-6989586621688399238"><span class="hs-identifier hs-var">relNameAndArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
 -&gt; FieldName)
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [FieldName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
-&gt; FieldName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
 -&gt; [FieldName])
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(((RelName, SelectArgsG ('Postgres pgKind) v), FieldName) -&gt; Bool)
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v)
-&gt; (RelName, SelectArgsG ('Postgres pgKind) v) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="#local-6989586621688399238"><span class="hs-identifier hs-var">relNameAndArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((RelName, SelectArgsG ('Postgres pgKind) v) -&gt; Bool)
-&gt; (((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
    -&gt; (RelName, SelectArgsG ('Postgres pgKind) v))
-&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
-&gt; (RelName, SelectArgsG ('Postgres pgKind) v)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399242"><span class="hs-identifier hs-var">allTuples</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621688399242"><span class="annot"><span class="annottext">allTuples :: [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399242"><span class="hs-identifier hs-var hs-var">allTuples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399237"><span class="hs-identifier hs-var">arrayRelationTuples</span></a></span><span> </span><span class="annot"><span class="annottext">[((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399236"><span class="hs-identifier hs-var">aggOrderByRelationTuples</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621688399237"><span class="annot"><span class="annottext">arrayRelationTuples :: [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399237"><span class="hs-identifier hs-var hs-var">arrayRelationTuples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399235"><span class="annot"><span class="annottext">arrayFields :: [(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
</span><a href="#local-6989586621688399235"><span class="hs-identifier hs-var hs-var">arrayFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldName, AnnFieldG ('Postgres pgKind) Void v)
 -&gt; Maybe (FieldName, ArraySelectG ('Postgres pgKind) Void v))
-&gt; AnnFieldsG ('Postgres pgKind) Void v
-&gt; [(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, AnnFieldG ('Postgres pgKind) Void v)
-&gt; Maybe (FieldName, ArraySelectG ('Postgres pgKind) Void v)
forall a (pgKind :: PostgresKind) r v.
(a, AnnFieldG ('Postgres pgKind) r v)
-&gt; Maybe (a, ArraySelectG ('Postgres pgKind) r v)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#getAnnArr"><span class="hs-identifier hs-var">getAnnArr</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void v
</span><a href="#local-6989586621688399245"><span class="hs-identifier hs-var">annFields</span></a></span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(((FieldName, ArraySelectG ('Postgres pgKind) Void v)
  -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
 -&gt; [(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
 -&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)])
-&gt; [(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
-&gt; ((FieldName, ArraySelectG ('Postgres pgKind) Void v)
    -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, ArraySelectG ('Postgres pgKind) Void v)
 -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
-&gt; [(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[(FieldName, ArraySelectG ('Postgres pgKind) Void v)]
</span><a href="#local-6989586621688399235"><span class="hs-identifier hs-var">arrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, ArraySelectG ('Postgres pgKind) Void v)
  -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
 -&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)])
-&gt; ((FieldName, ArraySelectG ('Postgres pgKind) Void v)
    -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-440"></span><span>            </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688399232"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399232"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399231"><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) Void v
</span><a href="#local-6989586621688399231"><span class="hs-identifier hs-var">relSel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) Void v
-&gt; (RelName, SelectArgsG ('Postgres pgKind) v)
forall (pgKind :: PostgresKind) r v.
ArraySelectG ('Postgres pgKind) r v
-&gt; (RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#getArrayRelNameAndSelectArgs"><span class="hs-identifier hs-var">getArrayRelNameAndSelectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) Void v
</span><a href="#local-6989586621688399231"><span class="hs-identifier hs-var">relSel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399232"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621688399236"><span class="annot"><span class="annottext">aggOrderByRelationTuples :: [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
</span><a href="#local-6989586621688399236"><span class="hs-identifier hs-var hs-var">aggOrderByRelationTuples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399229"><span class="annot"><span class="annottext">mkItem :: (a, b) -&gt; ((a, SelectArgsG backend v), b)
</span><a href="#local-6989586621688399229"><span class="hs-identifier hs-var hs-var">mkItem</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399228"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399228"><span class="hs-identifier hs-var">relName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399227"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688399227"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399228"><span class="hs-identifier hs-var">relName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectArgsG backend v
forall (backend :: BackendType) v. SelectArgsG backend v
</span><a href="Hasura.RQL.IR.Select.html#noSelectArgs"><span class="hs-identifier hs-var">noSelectArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-445"></span><span>              </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688399227"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-446"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((RelName, FieldName)
 -&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName))
-&gt; [(RelName, FieldName)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(RelName, FieldName)
-&gt; ((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)
forall a b (backend :: BackendType) v.
(a, b) -&gt; ((a, SelectArgsG backend v), b)
</span><a href="#local-6989586621688399229"><span class="hs-identifier hs-var">mkItem</span></a></span><span> </span><span class="annot"><span class="annottext">([(RelName, FieldName)]
 -&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)])
-&gt; [(RelName, FieldName)]
-&gt; [((RelName, SelectArgsG ('Postgres pgKind) v), FieldName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-448"></span><span>            </span><span class="annot"><span class="annottext">[(RelName, FieldName)]
-&gt; (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v)
    -&gt; [(RelName, FieldName)])
-&gt; Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
-&gt; [(RelName, FieldName)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-449"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-450"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnotatedOrderByItemG ('Postgres pgKind) v
 -&gt; Maybe (RelName, FieldName))
-&gt; [AnnotatedOrderByItemG ('Postgres pgKind) v]
-&gt; [(RelName, FieldName)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Maybe (RelName, FieldName)
forall (b :: BackendType) v.
AnnotatedOrderByElement b v -&gt; Maybe (RelName, FieldName)
</span><a href="#local-6989586621688399225"><span class="hs-identifier hs-var">fetchAggOrderByRels</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) v
 -&gt; Maybe (RelName, FieldName))
-&gt; (AnnotatedOrderByItemG ('Postgres pgKind) v
    -&gt; AnnotatedOrderByElement ('Postgres pgKind) v)
-&gt; AnnotatedOrderByItemG ('Postgres pgKind) v
-&gt; Maybe (RelName, FieldName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByItemG ('Postgres pgKind) v
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([AnnotatedOrderByItemG ('Postgres pgKind) v]
 -&gt; [(RelName, FieldName)])
-&gt; (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v)
    -&gt; [AnnotatedOrderByItemG ('Postgres pgKind) v])
-&gt; NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v)
-&gt; [(RelName, FieldName)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v)
-&gt; [AnnotatedOrderByItemG ('Postgres pgKind) v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>              </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
</span><a href="#local-6989586621688399244"><span class="hs-identifier hs-var">maybeOrderBys</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621688399225"><span class="annot"><span class="annottext">fetchAggOrderByRels :: AnnotatedOrderByElement b v -&gt; Maybe (RelName, FieldName)
</span><a href="#local-6989586621688399225"><span class="hs-identifier hs-var hs-var">fetchAggOrderByRels</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621688399223"><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688399223"><span class="hs-identifier hs-var">ri</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><span class="annottext">(RelName, FieldName) -&gt; Maybe (RelName, FieldName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688399223"><span class="hs-identifier hs-var">ri</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">(RelName -&gt; FieldName) -&gt; RelName -&gt; FieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688399223"><span class="hs-identifier hs-var">ri</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="#local-6989586621688399225"><span class="hs-identifier hs-var">fetchAggOrderByRels</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (RelName, FieldName)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span id="local-6989586621688399788"><span id="local-6989586621688399789"><span id="local-6989586621688399790"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#getArrayRelNameAndSelectArgs"><span class="hs-identifier hs-type">getArrayRelNameAndSelectArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-458"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ArraySelectG"><span class="hs-identifier hs-type">ArraySelectG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399790"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399789"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399788"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#RelName"><span class="hs-identifier hs-type">RelName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectArgsG"><span class="hs-identifier hs-type">SelectArgsG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399790"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399788"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-460"></span><span id="getArrayRelNameAndSelectArgs"><span class="annot"><span class="annottext">getArrayRelNameAndSelectArgs :: ArraySelectG ('Postgres pgKind) r v
-&gt; (RelName, SelectArgsG ('Postgres pgKind) v)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#getArrayRelNameAndSelectArgs"><span class="hs-identifier hs-var hs-var">getArrayRelNameAndSelectArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASSimple"><span class="hs-identifier hs-type">ASSimple</span></a></span><span> </span><span id="local-6989586621688399221"><span class="annot"><span class="annottext">ArrayRelationSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399221"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrayRelationSelectG ('Postgres pgKind) r v -&gt; RelName
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; RelName
</span><a href="Hasura.RQL.IR.Select.html#_aarRelationshipName"><span class="hs-identifier hs-var hs-var">_aarRelationshipName</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayRelationSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399221"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnSelectG ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; SelectArgsG b v
</span><a href="Hasura.RQL.IR.Select.html#_asnArgs"><span class="hs-identifier hs-var hs-var">_asnArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnSelectG ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) r) v
 -&gt; SelectArgsG ('Postgres pgKind) v)
-&gt; AnnSelectG ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayRelationSelectG ('Postgres pgKind) r v
-&gt; AnnSelectG ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) r) v
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; a
</span><a href="Hasura.RQL.IR.Select.html#_aarAnnSelect"><span class="hs-identifier hs-var hs-var">_aarAnnSelect</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayRelationSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399221"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASAggregate"><span class="hs-identifier hs-type">ASAggregate</span></a></span><span> </span><span id="local-6989586621688399216"><span class="annot"><span class="annottext">ArrayAggregateSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399216"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrayAggregateSelectG ('Postgres pgKind) r v -&gt; RelName
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; RelName
</span><a href="Hasura.RQL.IR.Select.html#_aarRelationshipName"><span class="hs-identifier hs-var hs-var">_aarRelationshipName</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayAggregateSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399216"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (TableAggregateFieldG ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; SelectArgsG b v
</span><a href="Hasura.RQL.IR.Select.html#_asnArgs"><span class="hs-identifier hs-var hs-var">_asnArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnSelectG
   ('Postgres pgKind) (TableAggregateFieldG ('Postgres pgKind) r) v
 -&gt; SelectArgsG ('Postgres pgKind) v)
-&gt; AnnSelectG
     ('Postgres pgKind) (TableAggregateFieldG ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayAggregateSelectG ('Postgres pgKind) r v
-&gt; AnnSelectG
     ('Postgres pgKind) (TableAggregateFieldG ('Postgres pgKind) r) v
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; a
</span><a href="Hasura.RQL.IR.Select.html#_aarAnnSelect"><span class="hs-identifier hs-var hs-var">_aarAnnSelect</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayAggregateSelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399216"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASConnection"><span class="hs-identifier hs-type">ASConnection</span></a></span><span> </span><span id="local-6989586621688399214"><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v
</span><a href="#local-6989586621688399214"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v -&gt; RelName
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; RelName
</span><a href="Hasura.RQL.IR.Select.html#_aarRelationshipName"><span class="hs-identifier hs-var hs-var">_aarRelationshipName</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v
</span><a href="#local-6989586621688399214"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; SelectArgsG b v
</span><a href="Hasura.RQL.IR.Select.html#_asnArgs"><span class="hs-identifier hs-var hs-var">_asnArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnSelectG
   ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v
 -&gt; SelectArgsG ('Postgres pgKind) v)
-&gt; AnnSelectG
     ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v
-&gt; SelectArgsG ('Postgres pgKind) v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) r v
-&gt; AnnSelectG
     ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v
forall (b :: BackendType) r v.
ConnectionSelect b r v -&gt; AnnSelectG b (ConnectionField b r) v
</span><a href="Hasura.RQL.IR.Select.html#_csSelect"><span class="hs-identifier hs-var hs-var">_csSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(ConnectionSelect ('Postgres pgKind) r v
 -&gt; AnnSelectG
      ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v)
-&gt; ConnectionSelect ('Postgres pgKind) r v
-&gt; AnnSelectG
     ('Postgres pgKind) (ConnectionField ('Postgres pgKind) r) v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v
-&gt; ConnectionSelect ('Postgres pgKind) r v
forall (b :: BackendType) a. AnnRelationSelectG b a -&gt; a
</span><a href="Hasura.RQL.IR.Select.html#_aarAnnSelect"><span class="hs-identifier hs-var hs-var">_aarAnnSelect</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v
</span><a href="#local-6989586621688399214"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span id="local-6989586621688399791"><span id="local-6989586621688399792"><span id="local-6989586621688399793"><span id="local-6989586621688399794"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#getAnnArr"><span class="hs-identifier hs-type">getAnnArr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688399794"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnFieldG"><span class="hs-identifier hs-type">AnnFieldG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399793"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399792"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399791"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688399794"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ArraySelectG"><span class="hs-identifier hs-type">ArraySelectG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399793"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688399792"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399791"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-468"></span><span id="getAnnArr"><span class="annot"><span class="annottext">getAnnArr :: (a, AnnFieldG ('Postgres pgKind) r v)
-&gt; Maybe (a, ArraySelectG ('Postgres pgKind) r v)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#getAnnArr"><span class="hs-identifier hs-var hs-var">getAnnArr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399212"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399212"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399211"><span class="annot"><span class="annottext">AnnFieldG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399211"><span class="hs-identifier hs-var">annFld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AnnFieldG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399211"><span class="hs-identifier hs-var">annFld</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFArrayRelation"><span class="hs-identifier hs-type">AFArrayRelation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASConnection"><span class="hs-identifier hs-type">ASConnection</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSelect ('Postgres pgKind) r v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (a, ArraySelectG ('Postgres pgKind) r v)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-470"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFArrayRelation"><span class="hs-identifier hs-type">AFArrayRelation</span></a></span><span> </span><span id="local-6989586621688399209"><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399209"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, ArraySelectG ('Postgres pgKind) r v)
-&gt; Maybe (a, ArraySelectG ('Postgres pgKind) r v)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399212"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) r v
</span><a href="#local-6989586621688399209"><span class="hs-identifier hs-var">ar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="annottext">AnnFieldG ('Postgres pgKind) r v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (a, ArraySelectG ('Postgres pgKind) r v)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">-- | This is the lowest level function which deals with @MonadWriter JoinTree@, whose</span><span>
</span><span id="line-474"></span><span class="hs-comment">-- purpose is to essentially create the selection tree across relationships.</span><span>
</span><span id="line-475"></span><span class="hs-comment">--</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- Each type of relationship uses a different kind of update function; see</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- 'withWriteObjectRelation', 'withWriteArrayRelation', 'withWriteArrayConnection',</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- and 'withWriteComputedFieldTableSet'.</span><span>
</span><span id="line-479"></span><span class="hs-comment">--</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- See the definition of 'JoinTree' for details before diving further</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- (particularly its components and Monoid instance).</span><span>
</span><span id="line-482"></span><span id="local-6989586621688399741"><span id="local-6989586621688399742"><span id="local-6989586621688399743"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-type">withWriteJoinTree</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399743"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688399742"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="#local-6989586621688399743"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688399741"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621688399742"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="#local-6989586621688399743"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399741"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-487"></span><span id="withWriteJoinTree"><span class="annot"><span class="annottext">withWriteJoinTree :: (JoinTree -&gt; b -&gt; JoinTree) -&gt; m (a, b) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-var hs-var">withWriteJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399207"><span class="annot"><span class="annottext">JoinTree -&gt; b -&gt; JoinTree
</span><a href="#local-6989586621688399207"><span class="hs-identifier hs-var">joinTreeUpdater</span></a></span></span><span> </span><span id="local-6989586621688399206"><span class="annot"><span class="annottext">m (a, b)
</span><a href="#local-6989586621688399206"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-488"></span><span>  </span><span class="annot"><span class="annottext">m (a, JoinTree -&gt; JoinTree) -&gt; m a
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m (a, w -&gt; w) -&gt; m a
</span><span class="hs-identifier hs-var">pass</span></span><span> </span><span class="annot"><span class="annottext">(m (a, JoinTree -&gt; JoinTree) -&gt; m a)
-&gt; m (a, JoinTree -&gt; JoinTree) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399204"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399204"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399203"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688399203"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (a, b)
</span><a href="#local-6989586621688399206"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399202"><span class="annot"><span class="annottext">fromJoinTree :: JoinTree -&gt; JoinTree
</span><a href="#local-6989586621688399202"><span class="hs-identifier hs-var hs-var">fromJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399201"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399201"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>          </span><span class="annot"><span class="annottext">JoinTree -&gt; b -&gt; JoinTree
</span><a href="#local-6989586621688399207"><span class="hs-identifier hs-var">joinTreeUpdater</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399201"><span class="hs-identifier hs-var">joinTree</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621688399203"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><span class="annottext">(a, JoinTree -&gt; JoinTree) -&gt; m (a, JoinTree -&gt; JoinTree)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399204"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JoinTree -&gt; JoinTree
</span><a href="#local-6989586621688399202"><span class="hs-identifier hs-var">fromJoinTree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span id="local-6989586621688399653"><span id="local-6989586621688399654"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteObjectRelation"><span class="hs-identifier hs-type">withWriteObjectRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399654"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><a href="#local-6989586621688399654"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-type">ObjectRelationSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-498"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><a href="#local-6989586621688399653"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><a href="#local-6989586621688399654"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399653"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-502"></span><span id="withWriteObjectRelation"><span class="annot"><span class="annottext">withWriteObjectRelation :: m (ObjectRelationSource, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteObjectRelation"><span class="hs-identifier hs-var hs-var">withWriteObjectRelation</span></a></span></span><span> </span><span id="local-6989586621688399199"><span class="annot"><span class="annottext">m (ObjectRelationSource, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399199"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-503"></span><span>  </span><span class="annot"><span class="annottext">(JoinTree
 -&gt; (ObjectRelationSource, HashMap Alias SQLExp) -&gt; JoinTree)
-&gt; m (a, (ObjectRelationSource, HashMap Alias SQLExp)) -&gt; m a
forall (m :: * -&gt; *) b a.
MonadWriter JoinTree m =&gt;
(JoinTree -&gt; b -&gt; JoinTree) -&gt; m (a, b) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-var">withWriteJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
-&gt; (ObjectRelationSource, HashMap Alias SQLExp) -&gt; JoinTree
</span><a href="#local-6989586621688399198"><span class="hs-identifier hs-var">updateJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">(m (a, (ObjectRelationSource, HashMap Alias SQLExp)) -&gt; m a)
-&gt; m (a, (ObjectRelationSource, HashMap Alias SQLExp)) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399197"><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688399197"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399196"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399196"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399195"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399195"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ObjectRelationSource, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399199"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">(a, (ObjectRelationSource, HashMap Alias SQLExp))
-&gt; m (a, (ObjectRelationSource, HashMap Alias SQLExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399195"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688399197"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399196"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621688399198"><span class="annot"><span class="annottext">updateJoinTree :: JoinTree
-&gt; (ObjectRelationSource, HashMap Alias SQLExp) -&gt; JoinTree
</span><a href="#local-6989586621688399198"><span class="hs-identifier hs-var hs-var">updateJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399194"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399194"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399193"><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688399193"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399192"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399192"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399191"><span class="annot"><span class="annottext">selectNode :: SelectNode
</span><a href="#local-6989586621688399191"><span class="hs-identifier hs-var hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399192"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399194"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-509"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">JoinTree
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_jtObjectRelations :: HashMap ObjectRelationSource SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_jtObjectRelations"><span class="hs-identifier hs-var">_jtObjectRelations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
-&gt; SelectNode -&gt; HashMap ObjectRelationSource SelectNode
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688399193"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688399191"><span class="hs-identifier hs-var">selectNode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span id="local-6989586621688399682"><span id="local-6989586621688399683"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayRelation"><span class="hs-identifier hs-type">withWriteArrayRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399683"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><a href="#local-6989586621688399683"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-type">ArrayRelationSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-515"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-516"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>      </span><span class="annot"><a href="#local-6989586621688399682"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-519"></span><span>  </span><span class="annot"><a href="#local-6989586621688399683"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399682"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-520"></span><span id="withWriteArrayRelation"><span class="annot"><span class="annottext">withWriteArrayRelation :: m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayRelation"><span class="hs-identifier hs-var hs-var">withWriteArrayRelation</span></a></span></span><span> </span><span id="local-6989586621688399186"><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399186"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">(JoinTree
 -&gt; (ArrayRelationSource, Extractor, HashMap Alias SQLExp)
 -&gt; JoinTree)
-&gt; m (a, (ArrayRelationSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall (m :: * -&gt; *) b a.
MonadWriter JoinTree m =&gt;
(JoinTree -&gt; b -&gt; JoinTree) -&gt; m (a, b) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-var">withWriteJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
-&gt; (ArrayRelationSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399185"><span class="hs-identifier hs-var">updateJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">(m (a, (ArrayRelationSource, Extractor, HashMap Alias SQLExp))
 -&gt; m a)
-&gt; m (a, (ArrayRelationSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399184"><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688399184"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399183"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399183"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399182"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399182"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399181"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399181"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399186"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">(a, (ArrayRelationSource, Extractor, HashMap Alias SQLExp))
-&gt; m (a, (ArrayRelationSource, Extractor, HashMap Alias SQLExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399181"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688399184"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399183"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399182"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-525"></span><span>    </span><span id="local-6989586621688399185"><span class="annot"><span class="annottext">updateJoinTree :: JoinTree
-&gt; (ArrayRelationSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399185"><span class="hs-identifier hs-var hs-var">updateJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399180"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399180"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399179"><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688399179"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399178"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399178"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399177"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399177"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399176"><span class="annot"><span class="annottext">arraySelectNode :: MultiRowSelectNode
</span><a href="#local-6989586621688399176"><span class="hs-identifier hs-var hs-var">arraySelectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-527"></span><span>            </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399178"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(SelectNode -&gt; MultiRowSelectNode)
-&gt; SelectNode -&gt; MultiRowSelectNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-528"></span><span>              </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399177"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399180"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-529"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">JoinTree
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_jtArrayRelations :: HashMap ArrayRelationSource MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_jtArrayRelations"><span class="hs-identifier hs-var">_jtArrayRelations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayRelationSource
-&gt; MultiRowSelectNode
-&gt; HashMap ArrayRelationSource MultiRowSelectNode
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688399179"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688399176"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span id="local-6989586621688399676"><span id="local-6989586621688399677"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayConnection"><span class="hs-identifier hs-type">withWriteArrayConnection</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399677"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><a href="#local-6989586621688399677"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-type">ArrayConnectionSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-537"></span><span>      </span><span class="annot"><a href="#local-6989586621688399676"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>  </span><span class="annot"><a href="#local-6989586621688399677"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399676"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-540"></span><span id="withWriteArrayConnection"><span class="annot"><span class="annottext">withWriteArrayConnection :: m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayConnection"><span class="hs-identifier hs-var hs-var">withWriteArrayConnection</span></a></span></span><span> </span><span id="local-6989586621688399172"><span class="annot"><span class="annottext">m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399172"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="annottext">(JoinTree
 -&gt; (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
 -&gt; JoinTree)
-&gt; m (a, (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall (m :: * -&gt; *) b a.
MonadWriter JoinTree m =&gt;
(JoinTree -&gt; b -&gt; JoinTree) -&gt; m (a, b) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-var">withWriteJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
-&gt; (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399171"><span class="hs-identifier hs-var">updateJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">(m (a, (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
 -&gt; m a)
-&gt; m (a, (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399170"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399170"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399169"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399169"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399168"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399168"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399167"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399167"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399172"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-543"></span><span>    </span><span class="annot"><span class="annottext">(a, (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
-&gt; m (a, (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399167"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399170"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399169"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399168"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-545"></span><span>    </span><span id="local-6989586621688399171"><span class="annot"><span class="annottext">updateJoinTree :: JoinTree
-&gt; (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399171"><span class="hs-identifier hs-var hs-var">updateJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399166"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399166"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399165"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399165"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399164"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399164"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399163"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399163"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399162"><span class="annot"><span class="annottext">arraySelectNode :: MultiRowSelectNode
</span><a href="#local-6989586621688399162"><span class="hs-identifier hs-var hs-var">arraySelectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>            </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399164"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(SelectNode -&gt; MultiRowSelectNode)
-&gt; SelectNode -&gt; MultiRowSelectNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-548"></span><span>              </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399163"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399166"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-549"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">JoinTree
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_jtArrayConnections :: HashMap ArrayConnectionSource MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_jtArrayConnections"><span class="hs-identifier hs-var">_jtArrayConnections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
-&gt; MultiRowSelectNode
-&gt; HashMap ArrayConnectionSource MultiRowSelectNode
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399165"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688399162"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span id="local-6989586621688399646"><span id="local-6989586621688399647"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteComputedFieldTableSet"><span class="hs-identifier hs-type">withWriteComputedFieldTableSet</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399647"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-553"></span><span>  </span><span class="annot"><a href="#local-6989586621688399647"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-type">ComputedFieldTableSetSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-555"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-556"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-557"></span><span>      </span><span class="annot"><a href="#local-6989586621688399646"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><a href="#local-6989586621688399647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399646"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-560"></span><span id="withWriteComputedFieldTableSet"><span class="annot"><span class="annottext">withWriteComputedFieldTableSet :: m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteComputedFieldTableSet"><span class="hs-identifier hs-var hs-var">withWriteComputedFieldTableSet</span></a></span></span><span> </span><span id="local-6989586621688399159"><span class="annot"><span class="annottext">m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399159"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><span class="annottext">(JoinTree
 -&gt; (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp)
 -&gt; JoinTree)
-&gt; m (a,
      (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall (m :: * -&gt; *) b a.
MonadWriter JoinTree m =&gt;
(JoinTree -&gt; b -&gt; JoinTree) -&gt; m (a, b) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteJoinTree"><span class="hs-identifier hs-var">withWriteJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
-&gt; (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399158"><span class="hs-identifier hs-var">updateJoinTree</span></a></span><span> </span><span class="annot"><span class="annottext">(m (a,
    (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp))
 -&gt; m a)
-&gt; m (a,
      (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp))
-&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399157"><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688399157"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399156"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399156"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399155"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399155"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399154"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399154"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp, a)
</span><a href="#local-6989586621688399159"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><span class="annottext">(a, (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp))
-&gt; m (a,
      (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688399154"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688399157"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399156"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399155"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-565"></span><span>    </span><span id="local-6989586621688399158"><span class="annot"><span class="annottext">updateJoinTree :: JoinTree
-&gt; (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp)
-&gt; JoinTree
</span><a href="#local-6989586621688399158"><span class="hs-identifier hs-var hs-var">updateJoinTree</span></a></span></span><span> </span><span id="local-6989586621688399153"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399153"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399152"><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688399152"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399151"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399151"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399150"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399150"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399149"><span class="annot"><span class="annottext">selectNode :: MultiRowSelectNode
</span><a href="#local-6989586621688399149"><span class="hs-identifier hs-var hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399151"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(SelectNode -&gt; MultiRowSelectNode)
-&gt; SelectNode -&gt; MultiRowSelectNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399150"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688399153"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">JoinTree
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_jtComputedFieldTableSets :: HashMap ComputedFieldTableSetSource MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_jtComputedFieldTableSets"><span class="hs-identifier hs-var">_jtComputedFieldTableSets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
-&gt; MultiRowSelectNode
-&gt; HashMap ComputedFieldTableSetSource MultiRowSelectNode
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688399152"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688399149"><span class="hs-identifier hs-var">selectNode</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnSimpleSelect"><span class="hs-identifier hs-type">processAnnSimpleSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399680"><span class="annot"><a href="#local-6989586621688399680"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399681"><span class="annot"><a href="#local-6989586621688399681"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399680"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399680"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-576"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-type">SourcePrefixes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PermissionLimitSubQuery"><span class="hs-identifier hs-type">PermissionLimitSubQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-579"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSimpleSelect"><span class="hs-identifier hs-type">AnnSimpleSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399680"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><a href="#local-6989586621688399681"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-582"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span id="processAnnSimpleSelect"><span class="annot"><span class="annottext">processAnnSimpleSelect :: SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnSimpleSelect"><span class="hs-identifier hs-var hs-var">processAnnSimpleSelect</span></a></span></span><span> </span><span id="local-6989586621688399146"><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399146"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span></span><span> </span><span id="local-6989586621688399145"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399145"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688399144"><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399144"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span></span><span> </span><span id="local-6989586621688399143"><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
</span><a href="#local-6989586621688399143"><span class="hs-identifier hs-var">annSimpleSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688399142"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399142"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399141"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399141"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SQLExp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind)) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processSelectParams"><span class="hs-identifier hs-var">processSelectParams</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399146"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-588"></span><span>      </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399145"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-589"></span><span>      </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399139"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399138"><span class="hs-identifier hs-var">tableFrom</span></a></span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399144"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span>
</span><span id="line-592"></span><span>      </span><span class="annot"><span class="annottext">TablePerm ('Postgres pgKind)
TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399137"><span class="hs-identifier hs-var">tablePermissions</span></a></span><span>
</span><span id="line-593"></span><span>      </span><span class="annot"><span class="annottext">SelectArgs ('Postgres pgKind)
SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399136"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621688399135"><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688399135"><span class="hs-identifier hs-var">annFieldsExtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-var">processAnnFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399146"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399145"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399139"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
Fields (AnnFieldG ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688399132"><span class="hs-identifier hs-var">annSelFields</span></a></span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399131"><span class="annot"><span class="annottext">allExtractors :: HashMap Alias SQLExp
</span><a href="#local-6989586621688399131"><span class="hs-identifier hs-var hs-var">allExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; HashMap Alias SQLExp)
-&gt; [(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688399135"><span class="hs-identifier hs-var">annFieldsExtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias, SQLExp) -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399141"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span><span>
</span><span id="line-596"></span><span>  </span><span class="annot"><span class="annottext">(SelectSource, HashMap Alias SQLExp)
-&gt; m (SelectSource, HashMap Alias SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399142"><span class="hs-identifier hs-var">selectSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399131"><span class="hs-identifier hs-var">allExtractors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSelectG"><span class="hs-identifier hs-type">AnnSelectG</span></a></span><span> </span><span id="local-6989586621688399132"><span class="annot"><span class="annottext">Fields (AnnFieldG ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688399132"><span class="hs-identifier hs-var">annSelFields</span></a></span></span><span> </span><span id="local-6989586621688399138"><span class="annot"><span class="annottext">SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399138"><span class="hs-identifier hs-var">tableFrom</span></a></span></span><span> </span><span id="local-6989586621688399137"><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399137"><span class="hs-identifier hs-var">tablePermissions</span></a></span></span><span> </span><span id="local-6989586621688399136"><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399136"><span class="hs-identifier hs-var">tableArgs</span></a></span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688399143"><span class="hs-identifier hs-var">annSimpleSel</span></a></span><span>
</span><span id="line-599"></span><span>    </span><span id="local-6989586621688399139"><span class="annot"><span class="annottext">similarArrayFields :: HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399139"><span class="hs-identifier hs-var hs-var">similarArrayFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">Fields (AnnFieldG ('Postgres pgKind) Void SQLExp)
-&gt; Maybe
     (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
-&gt; HashMap FieldName [FieldName]
forall (pgKind :: PostgresKind) v.
(Backend ('Postgres pgKind), Eq v) =&gt;
AnnFieldsG ('Postgres pgKind) Void v
-&gt; Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
-&gt; HashMap FieldName [FieldName]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSimilarArrayFields"><span class="hs-identifier hs-var">mkSimilarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">Fields (AnnFieldG ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688399132"><span class="hs-identifier hs-var">annSelFields</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
 -&gt; HashMap FieldName [FieldName])
-&gt; Maybe
     (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
-&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
-&gt; Maybe
     (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
forall (b :: BackendType) v.
SelectArgsG b v -&gt; Maybe (NonEmpty (AnnotatedOrderByItemG b v))
</span><a href="Hasura.RQL.IR.Select.html#_saOrderBy"><span class="hs-identifier hs-var hs-var">_saOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399136"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnAggregateSelect"><span class="hs-identifier hs-type">processAnnAggregateSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399678"><span class="annot"><a href="#local-6989586621688399678"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399679"><span class="annot"><a href="#local-6989586621688399679"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399679"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399679"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399678"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399678"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-609"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-type">SourcePrefixes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnAggregateSelect"><span class="hs-identifier hs-type">AnnAggregateSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399678"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><a href="#local-6989586621688399679"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-614"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span id="processAnnAggregateSelect"><span class="annot"><span class="annottext">processAnnAggregateSelect :: SourcePrefixes
-&gt; FieldName
-&gt; AnnAggregateSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp, Extractor)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnAggregateSelect"><span class="hs-identifier hs-var hs-var">processAnnAggregateSelect</span></a></span></span><span> </span><span id="local-6989586621688399127"><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399127"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span></span><span> </span><span id="local-6989586621688399126"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399126"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688399125"><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
</span><a href="#local-6989586621688399125"><span class="hs-identifier hs-var">annAggSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688399124"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399124"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399123"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399123"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SQLExp
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind)) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processSelectParams"><span class="hs-identifier hs-var">processSelectParams</span></a></span><span>
</span><span id="line-620"></span><span>      </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399127"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399126"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-622"></span><span>      </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399122"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span>
</span><span id="line-623"></span><span>      </span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399121"><span class="hs-identifier hs-var">tableFrom</span></a></span><span>
</span><span id="line-624"></span><span>      </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399120"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><span class="annottext">TablePerm ('Postgres pgKind)
TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399119"><span class="hs-identifier hs-var">tablePermissions</span></a></span><span>
</span><span id="line-626"></span><span>      </span><span class="annot"><span class="annottext">SelectArgs ('Postgres pgKind)
SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399118"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399117"><span class="annot"><span class="annottext">thisSourcePrefix :: Identifier
</span><a href="#local-6989586621688399117"><span class="hs-identifier hs-var hs-var">thisSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399127"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span id="local-6989586621688399116"><span class="annot"><span class="annottext">[(FieldName, ([(Alias, SQLExp)], SQLExp))]
</span><a href="#local-6989586621688399116"><span class="hs-identifier hs-var">processedFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
-&gt; ((FieldName,
     TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
    -&gt; m (FieldName, ([(Alias, SQLExp)], SQLExp)))
-&gt; m [(FieldName, ([(Alias, SQLExp)], SQLExp))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688399114"><span class="hs-identifier hs-var">aggSelFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
  -&gt; m (FieldName, ([(Alias, SQLExp)], SQLExp)))
 -&gt; m [(FieldName, ([(Alias, SQLExp)], SQLExp))])
-&gt; ((FieldName,
     TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
    -&gt; m (FieldName, ([(Alias, SQLExp)], SQLExp)))
-&gt; m [(FieldName, ([(Alias, SQLExp)], SQLExp))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688399113"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399113"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399112"><span class="annot"><span class="annottext">TableAggregateFieldG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399112"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-629"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399113"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>      </span><span class="annot"><span class="annottext">(([(Alias, SQLExp)], SQLExp)
 -&gt; (FieldName, ([(Alias, SQLExp)], SQLExp)))
-&gt; m ([(Alias, SQLExp)], SQLExp)
-&gt; m (FieldName, ([(Alias, SQLExp)], SQLExp))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TableAggregateFieldG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399112"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-631"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFAgg"><span class="hs-identifier hs-type">TAFAgg</span></a></span><span> </span><span id="local-6989586621688399110"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399110"><span class="hs-identifier hs-var">aggFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-632"></span><span>          </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SQLExp) -&gt; m ([(Alias, SQLExp)], SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-633"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
forall (pgKind :: PostgresKind).
Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399117"><span class="hs-identifier hs-var">thisSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399110"><span class="hs-identifier hs-var">aggFields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-634"></span><span>              </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind) -&gt; StringifyNumbers -&gt; SQLExp
forall (pgKind :: PostgresKind).
AggregateFields ('Postgres pgKind) -&gt; StringifyNumbers -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldToExp"><span class="hs-identifier hs-var">aggregateFieldToExp</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399110"><span class="hs-identifier hs-var">aggFields</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688399108"><span class="hs-identifier hs-var">strfyNum</span></a></span><span>
</span><span id="line-635"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFNodes"><span class="hs-identifier hs-type">TAFNodes</span></a></span><span> </span><span class="annot"><span class="annottext">XNodesAgg ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399106"><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399106"><span class="hs-identifier hs-var">annFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>          </span><span id="local-6989586621688399105"><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688399105"><span class="hs-identifier hs-var">annFieldExtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-var">processAnnFields</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399117"><span class="hs-identifier hs-var">thisSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399113"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399122"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399106"><span class="hs-identifier hs-var">annFields</span></a></span><span>
</span><span id="line-638"></span><span>          </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SQLExp) -&gt; m ([(Alias, SQLExp)], SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-639"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688399105"><span class="hs-identifier hs-var">annFieldExtr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-640"></span><span>              </span><span class="annot"><span class="annottext">PermissionLimitSubQuery -&gt; Maybe OrderByExp -&gt; Alias -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonAggExtr"><span class="hs-identifier hs-var">withJsonAggExtr</span></a></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399120"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSource -&gt; Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#orderByForJsonAgg"><span class="hs-identifier hs-var">orderByForJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399124"><span class="hs-identifier hs-var">selectSource</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; SQLExp) -&gt; Alias -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-641"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399113"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-642"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFExp"><span class="hs-identifier hs-type">TAFExp</span></a></span><span> </span><span id="local-6989586621688399102"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399102"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-644"></span><span>          </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SQLExp) -&gt; m ([(Alias, SQLExp)], SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-645"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>              </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399102"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-647"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399100"><span class="annot"><span class="annottext">topLevelExtractor :: Extractor
</span><a href="#local-6989586621688399100"><span class="hs-identifier hs-var hs-var">topLevelExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-650"></span><span>        </span><span class="annot"><span class="annottext">(SQLExp -&gt; Maybe Alias -&gt; Extractor)
-&gt; Maybe Alias -&gt; SQLExp -&gt; Extractor
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399126"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; Extractor) -&gt; SQLExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-651"></span><span>          </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-652"></span><span>            </span><span class="annot"><span class="annottext">(((FieldName, SQLExp) -&gt; [SQLExp])
 -&gt; [(FieldName, SQLExp)] -&gt; [SQLExp])
-&gt; [(FieldName, SQLExp)]
-&gt; ((FieldName, SQLExp) -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, SQLExp) -&gt; [SQLExp])
-&gt; [(FieldName, SQLExp)] -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, ([(Alias, SQLExp)], SQLExp)) -&gt; (FieldName, SQLExp))
-&gt; [(FieldName, ([(Alias, SQLExp)], SQLExp))]
-&gt; [(FieldName, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([(Alias, SQLExp)], SQLExp) -&gt; SQLExp)
-&gt; (FieldName, ([(Alias, SQLExp)], SQLExp)) -&gt; (FieldName, SQLExp)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SQLExp) -&gt; SQLExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldName, ([(Alias, SQLExp)], SQLExp))]
</span><a href="#local-6989586621688399116"><span class="hs-identifier hs-var">processedFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((FieldName, SQLExp) -&gt; [SQLExp]) -&gt; [SQLExp])
-&gt; ((FieldName, SQLExp) -&gt; [SQLExp]) -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-653"></span><span>              </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688399098"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399098"><span class="hs-identifier hs-var">fieldText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399097"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399097"><span class="hs-identifier hs-var">fieldExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688399098"><span class="hs-identifier hs-var">fieldText</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399097"><span class="hs-identifier hs-var">fieldExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-654"></span><span>      </span><span id="local-6989586621688399096"><span class="annot"><span class="annottext">nodeExtractors :: HashMap Alias SQLExp
</span><a href="#local-6989586621688399096"><span class="hs-identifier hs-var hs-var">nodeExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; HashMap Alias SQLExp)
-&gt; [(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-656"></span><span>          </span><span class="annot"><span class="annottext">((FieldName, ([(Alias, SQLExp)], SQLExp)) -&gt; [(Alias, SQLExp)])
-&gt; [(FieldName, ([(Alias, SQLExp)], SQLExp))] -&gt; [(Alias, SQLExp)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SQLExp) -&gt; [(Alias, SQLExp)]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([(Alias, SQLExp)], SQLExp) -&gt; [(Alias, SQLExp)])
-&gt; ((FieldName, ([(Alias, SQLExp)], SQLExp))
    -&gt; ([(Alias, SQLExp)], SQLExp))
-&gt; (FieldName, ([(Alias, SQLExp)], SQLExp))
-&gt; [(Alias, SQLExp)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, ([(Alias, SQLExp)], SQLExp))
-&gt; ([(Alias, SQLExp)], SQLExp)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldName, ([(Alias, SQLExp)], SQLExp))]
</span><a href="#local-6989586621688399116"><span class="hs-identifier hs-var">processedFields</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399123"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">(SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; m (SelectSource, HashMap Alias SQLExp, Extractor)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399124"><span class="hs-identifier hs-var">selectSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399096"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399100"><span class="hs-identifier hs-var">topLevelExtractor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSelectG"><span class="hs-identifier hs-type">AnnSelectG</span></a></span><span> </span><span id="local-6989586621688399114"><span class="annot"><span class="annottext">[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688399114"><span class="hs-identifier hs-var">aggSelFields</span></a></span></span><span> </span><span id="local-6989586621688399121"><span class="annot"><span class="annottext">SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399121"><span class="hs-identifier hs-var">tableFrom</span></a></span></span><span> </span><span id="local-6989586621688399119"><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399119"><span class="hs-identifier hs-var">tablePermissions</span></a></span></span><span> </span><span id="local-6989586621688399118"><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399118"><span class="hs-identifier hs-var">tableArgs</span></a></span></span><span> </span><span id="local-6989586621688399108"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688399108"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
AnnSelectG
  ('Postgres pgKind)
  (TableAggregateFieldG ('Postgres pgKind) Void)
  SQLExp
</span><a href="#local-6989586621688399125"><span class="hs-identifier hs-var">annAggSel</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621688399095"><span class="annot"><span class="annottext">permLimit :: Maybe Int
</span><a href="#local-6989586621688399095"><span class="hs-identifier hs-var hs-var">permLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp -&gt; Maybe Int
forall (b :: BackendType) v. TablePermG b v -&gt; Maybe Int
</span><a href="Hasura.RQL.IR.Select.html#_tpLimit"><span class="hs-identifier hs-var hs-var">_tpLimit</span></a></span><span> </span><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399119"><span class="hs-identifier hs-var">tablePermissions</span></a></span><span>
</span><span id="line-662"></span><span>    </span><span id="local-6989586621688399093"><span class="annot"><span class="annottext">orderBy :: Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399093"><span class="hs-identifier hs-var hs-var">orderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
-&gt; Maybe
     (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
forall (b :: BackendType) v.
SelectArgsG b v -&gt; Maybe (NonEmpty (AnnotatedOrderByItemG b v))
</span><a href="Hasura.RQL.IR.Select.html#_saOrderBy"><span class="hs-identifier hs-var hs-var">_saOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399118"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-663"></span><span>    </span><span id="local-6989586621688399120"><span class="annot"><span class="annottext">permLimitSubQuery :: PermissionLimitSubQuery
</span><a href="#local-6989586621688399120"><span class="hs-identifier hs-var hs-var">permLimitSubQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
-&gt; TableAggregateFields ('Postgres pgKind)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; PermissionLimitSubQuery
forall (pgKind :: PostgresKind).
Maybe Int
-&gt; TableAggregateFields ('Postgres pgKind)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkPermissionLimitSubQuery"><span class="hs-identifier hs-var">mkPermissionLimitSubQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399095"><span class="hs-identifier hs-var">permLimit</span></a></span><span> </span><span class="annot"><span class="annottext">TableAggregateFields ('Postgres pgKind)
[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688399114"><span class="hs-identifier hs-var">aggSelFields</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399093"><span class="hs-identifier hs-var">orderBy</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621688399122"><span class="annot"><span class="annottext">similarArrayFields :: HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399122"><span class="hs-identifier hs-var hs-var">similarArrayFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall k v. (Eq k, Hashable k) =&gt; [HashMap k v] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.unions</span></span><span> </span><span class="annot"><span class="annottext">([HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-665"></span><span>      </span><span class="annot"><span class="annottext">((TableAggregateFieldG ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
 -&gt; [HashMap FieldName [FieldName]])
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
-&gt; (TableAggregateFieldG ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(TableAggregateFieldG ('Postgres pgKind) Void SQLExp
 -&gt; HashMap FieldName [FieldName])
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
 -&gt; TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
-&gt; [(FieldName,
     TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
-&gt; TableAggregateFieldG ('Postgres pgKind) Void SQLExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688399114"><span class="hs-identifier hs-var">aggSelFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TableAggregateFieldG ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [HashMap FieldName [FieldName]])
-&gt; (TableAggregateFieldG ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-666"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFAgg"><span class="hs-identifier hs-type">TAFAgg</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-667"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFNodes"><span class="hs-identifier hs-type">TAFNodes</span></a></span><span> </span><span class="annot"><span class="annottext">XNodesAgg ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399090"><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399090"><span class="hs-identifier hs-var">annFlds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-668"></span><span>          </span><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
-&gt; Maybe
     (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
-&gt; HashMap FieldName [FieldName]
forall (pgKind :: PostgresKind) v.
(Backend ('Postgres pgKind), Eq v) =&gt;
AnnFieldsG ('Postgres pgKind) Void v
-&gt; Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
-&gt; HashMap FieldName [FieldName]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSimilarArrayFields"><span class="hs-identifier hs-var">mkSimilarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399090"><span class="hs-identifier hs-var">annFlds</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399093"><span class="hs-identifier hs-var">orderBy</span></a></span><span>
</span><span id="line-669"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFExp"><span class="hs-identifier hs-type">TAFExp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span id="local-6989586621688399692"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkPermissionLimitSubQuery"><span class="hs-identifier hs-type">mkPermissionLimitSubQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TableAggregateFields"><span class="hs-identifier hs-type">TableAggregateFields</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399692"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItem"><span class="hs-identifier hs-type">AnnotatedOrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399692"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PermissionLimitSubQuery"><span class="hs-identifier hs-type">PermissionLimitSubQuery</span></a></span></span><span>
</span><span id="line-676"></span><span id="mkPermissionLimitSubQuery"><span class="annot"><span class="annottext">mkPermissionLimitSubQuery :: Maybe Int
-&gt; TableAggregateFields ('Postgres pgKind)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkPermissionLimitSubQuery"><span class="hs-identifier hs-var hs-var">mkPermissionLimitSubQuery</span></a></span></span><span> </span><span id="local-6989586621688399089"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399089"><span class="hs-identifier hs-var">permLimit</span></a></span></span><span> </span><span id="local-6989586621688399088"><span class="annot"><span class="annottext">TableAggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688399088"><span class="hs-identifier hs-var">aggFields</span></a></span></span><span> </span><span id="local-6989586621688399087"><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
</span><a href="#local-6989586621688399087"><span class="hs-identifier hs-var">orderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399089"><span class="hs-identifier hs-var">permLimit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span>
</span><span id="line-679"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688399086"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399086"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-680"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621688399085"><span class="hs-identifier hs-var">hasAggregateField</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621688399083"><span class="hs-identifier hs-var">hasAggOrderBy</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQRequired"><span class="hs-identifier hs-var">PLSQRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399086"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621688399085"><span class="annot"><span class="annottext">hasAggregateField :: Bool
</span><a href="#local-6989586621688399085"><span class="hs-identifier hs-var hs-var">hasAggregateField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TableAggregateFieldG ('Postgres pgKind) Void SQLExp -&gt; Bool)
 -&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp] -&gt; Bool)
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
-&gt; (TableAggregateFieldG ('Postgres pgKind) Void SQLExp -&gt; Bool)
-&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(TableAggregateFieldG ('Postgres pgKind) Void SQLExp -&gt; Bool)
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
 -&gt; TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
-&gt; [(FieldName,
     TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
-&gt; [TableAggregateFieldG ('Postgres pgKind) Void SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)
-&gt; TableAggregateFieldG ('Postgres pgKind) Void SQLExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">TableAggregateFields ('Postgres pgKind)
[(FieldName, TableAggregateFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688399088"><span class="hs-identifier hs-var">aggFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TableAggregateFieldG ('Postgres pgKind) Void SQLExp -&gt; Bool)
 -&gt; Bool)
-&gt; (TableAggregateFieldG ('Postgres pgKind) Void SQLExp -&gt; Bool)
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TAFAgg"><span class="hs-identifier hs-type">TAFAgg</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><span class="annottext">TableAggregateFieldG ('Postgres pgKind) Void SQLExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>    </span><span id="local-6989586621688399083"><span class="annot"><span class="annottext">hasAggOrderBy :: Bool
</span><a href="#local-6989586621688399083"><span class="hs-identifier hs-var hs-var">hasAggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
</span><a href="#local-6989586621688399087"><span class="hs-identifier hs-var">orderBys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-690"></span><span>      </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688399081"><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
</span><a href="#local-6989586621688399081"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Bool)
 -&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp] -&gt; Bool)
-&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp]
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Bool)
-&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Bool)
-&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
 -&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)]
-&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
-&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)]
 -&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)]
-&gt; [AnnotatedOrderByElement ('Postgres pgKind) SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp))
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399081"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Bool)
 -&gt; Bool)
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Bool)
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-693"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-694"></span><span>          </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processArrayRelation"><span class="hs-identifier hs-type">processArrayRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399595"><span class="annot"><a href="#local-6989586621688399595"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399596"><span class="annot"><a href="#local-6989586621688399596"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399596"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399596"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-700"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399595"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399595"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-703"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-type">SourcePrefixes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-706"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ArraySelect"><span class="hs-identifier hs-type">ArraySelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399595"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><a href="#local-6989586621688399596"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span id="processArrayRelation"><span class="annot"><span class="annottext">processArrayRelation :: SourcePrefixes
-&gt; FieldName -&gt; Alias -&gt; ArraySelect ('Postgres pgKind) -&gt; m ()
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processArrayRelation"><span class="hs-identifier hs-var hs-var">processArrayRelation</span></a></span></span><span> </span><span id="local-6989586621688399079"><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399079"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span></span><span> </span><span id="local-6989586621688399078"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399078"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688399077"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399077"><span class="hs-identifier hs-var">relAlias</span></a></span></span><span> </span><span id="local-6989586621688399076"><span class="annot"><span class="annottext">ArraySelect ('Postgres pgKind)
</span><a href="#local-6989586621688399076"><span class="hs-identifier hs-var">arrSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ArraySelect ('Postgres pgKind)
</span><a href="#local-6989586621688399076"><span class="hs-identifier hs-var">arrSel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASSimple"><span class="hs-identifier hs-type">ASSimple</span></a></span><span> </span><span id="local-6989586621688399075"><span class="annot"><span class="annottext">ArrayRelationSelectG
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688399075"><span class="hs-identifier hs-var">annArrRel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayRelation"><span class="hs-identifier hs-var">withWriteArrayRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
 -&gt; m ())
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnRelationSelectG"><span class="hs-identifier hs-type">AnnRelationSelectG</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399073"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688399073"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688399072"><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688399072"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayRelationSelectG
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
AnnRelationSelectG
  ('Postgres pgKind)
  (AnnSelectG
     ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp)
</span><a href="#local-6989586621688399075"><span class="hs-identifier hs-var">annArrRel</span></a></span><span>
</span><span id="line-712"></span><span>          </span><span id="local-6989586621688399071"><span class="annot"><span class="annottext">permLimitSubQuery :: PermissionLimitSubQuery
</span><a href="#local-6989586621688399071"><span class="hs-identifier hs-var hs-var">permLimitSubQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-713"></span><span>            </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
-&gt; (Int -&gt; PermissionLimitSubQuery)
-&gt; Maybe Int
-&gt; PermissionLimitSubQuery
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQRequired"><span class="hs-identifier hs-var">PLSQRequired</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; PermissionLimitSubQuery)
-&gt; Maybe Int -&gt; PermissionLimitSubQuery
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp -&gt; Maybe Int
forall (b :: BackendType) v. TablePermG b v -&gt; Maybe Int
</span><a href="Hasura.RQL.IR.Select.html#_tpLimit"><span class="hs-identifier hs-var hs-var">_tpLimit</span></a></span><span> </span><span class="annot"><span class="annottext">(TablePermG ('Postgres pgKind) SQLExp -&gt; Maybe Int)
-&gt; TablePermG ('Postgres pgKind) SQLExp -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
-&gt; TablePermG ('Postgres pgKind) SQLExp
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; TablePermG b v
</span><a href="Hasura.RQL.IR.Select.html#_asnPerm"><span class="hs-identifier hs-var hs-var">_asnPerm</span></a></span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688399072"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688399069"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399069"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399068"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399068"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnSimpleSelect"><span class="hs-identifier hs-var">processAnnSimpleSelect</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399079"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399078"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399071"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688399072"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-716"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399067"><span class="annot"><span class="annottext">topExtr :: Extractor
</span><a href="#local-6989586621688399067"><span class="hs-identifier hs-var hs-var">topExtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-717"></span><span>            </span><span class="annot"><span class="annottext">JsonAggSelect
-&gt; Alias
-&gt; PermissionLimitSubQuery
-&gt; Maybe OrderByExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asJsonAggExtr"><span class="hs-identifier hs-var">asJsonAggExtr</span></a></span><span>
</span><span id="line-718"></span><span>              </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="Hasura.RQL.Types.Common.html#JASMultipleRows"><span class="hs-identifier hs-var">JASMultipleRows</span></a></span><span>
</span><span id="line-719"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName -&gt; Alias
forall a. IsIdentifier a =&gt; a -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#toAlias"><span class="hs-identifier hs-var">S.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399078"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>              </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399071"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span>
</span><span id="line-721"></span><span>              </span><span class="annot"><span class="annottext">(Maybe OrderByExp -&gt; Extractor) -&gt; Maybe OrderByExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#orderByForJsonAgg"><span class="hs-identifier hs-var">orderByForJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399069"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><span class="annottext">(ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; SelectSource -&gt; ArrayRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-var">ArrayRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399077"><span class="hs-identifier hs-var">relAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688399073"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399069"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-724"></span><span>          </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399067"><span class="hs-identifier hs-var">topExtr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-725"></span><span>          </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399068"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-726"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASAggregate"><span class="hs-identifier hs-type">ASAggregate</span></a></span><span> </span><span id="local-6989586621688399065"><span class="annot"><span class="annottext">ArrayAggregateSelectG
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688399065"><span class="hs-identifier hs-var">aggSel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayRelation"><span class="hs-identifier hs-var">withWriteArrayRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
 -&gt; m ())
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnRelationSelectG"><span class="hs-identifier hs-type">AnnRelationSelectG</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399064"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688399064"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688399063"><span class="annot"><span class="annottext">AnnAggregateSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399063"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayAggregateSelectG
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
AnnRelationSelectG
  ('Postgres pgKind)
  (AnnAggregateSelectG ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688399065"><span class="hs-identifier hs-var">aggSel</span></a></span><span>
</span><span id="line-730"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688399062"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399062"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399061"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399061"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399060"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399060"><span class="hs-identifier hs-var">topExtr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-731"></span><span>        </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; AnnAggregateSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp, Extractor)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; AnnAggregateSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp, Extractor)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnAggregateSelect"><span class="hs-identifier hs-var">processAnnAggregateSelect</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399079"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399078"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
AnnAggregateSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399063"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-732"></span><span>      </span><span class="annot"><span class="annottext">(ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; SelectSource -&gt; ArrayRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-var">ArrayRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399077"><span class="hs-identifier hs-var">relAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688399064"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399062"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-734"></span><span>          </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399060"><span class="hs-identifier hs-var">topExtr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-735"></span><span>          </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399061"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-736"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ASConnection"><span class="hs-identifier hs-type">ASConnection</span></a></span><span> </span><span id="local-6989586621688399059"><span class="annot"><span class="annottext">ArrayConnectionSelect
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688399059"><span class="hs-identifier hs-var">connSel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayConnection"><span class="hs-identifier hs-var">withWriteArrayConnection</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, ())
 -&gt; m ())
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-739"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnRelationSelectG"><span class="hs-identifier hs-type">AnnRelationSelectG</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688399058"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688399058"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688399057"><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399057"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSelect
  ('Postgres pgKind) Void (SQLExpression ('Postgres pgKind))
AnnRelationSelectG
  ('Postgres pgKind)
  (ConnectionSelect ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688399059"><span class="hs-identifier hs-var">connSel</span></a></span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688399056"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399056"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399055"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399055"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399054"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399054"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-741"></span><span>        </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; Alias
-&gt; HashMap PGCol PGCol
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; Alias
-&gt; HashMap PGCol PGCol
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processConnectionSelect"><span class="hs-identifier hs-var">processConnectionSelect</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399079"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399078"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688399077"><span class="hs-identifier hs-var">relAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688399058"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688399057"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-742"></span><span>      </span><span class="annot"><span class="annottext">(ArrayConnectionSource, Extractor, HashMap Alias SQLExp, ())
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp, ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688399056"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-744"></span><span>          </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688399055"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-745"></span><span>          </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688399054"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-746"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">{- Note [Optimizing queries using limit/offset]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Refer to the issue https://github.com/hasura/graphql-engine/issues/5745

Before this change, limit/offset/distinct_on is applied at outer selection
node along with order by clause. This greatly reduces query performance if
our base selection table contains many rows and relationships are selected
which joins remote tables. We need to optimize application of limit wrt to
order by input.

If &quot;Order by&quot; is not present:
  Apply limit/offset/distinct on at the base table selection
Else if &quot;Order by&quot; contains only columns:
  Apply limit/offset/distinct_on at the base table selection along with order by
Otherwise:
  Apply limit/offset/distinct_on at the node selection along with order by
-}</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processSelectParams"><span class="hs-identifier hs-type">processSelectParams</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399719"><span class="annot"><a href="#local-6989586621688399719"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399721"><span class="annot"><a href="#local-6989586621688399721"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-770"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399719"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-773"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-type">SourcePrefixes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectFrom"><span class="hs-identifier hs-type">SelectFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399719"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PermissionLimitSubQuery"><span class="hs-identifier hs-type">PermissionLimitSubQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TablePerm"><span class="hs-identifier hs-type">TablePerm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399719"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectArgs"><span class="hs-identifier hs-type">SelectArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399719"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="#local-6989586621688399721"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-782"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-comment">-- Order by cursor</span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span id="processSelectParams"><span class="annot"><span class="annottext">processSelectParams :: SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processSelectParams"><span class="hs-identifier hs-var hs-var">processSelectParams</span></a></span></span><span>
</span><span id="line-786"></span><span>  </span><span id="local-6989586621688399052"><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399052"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span></span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621688399051"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399051"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span>
</span><span id="line-788"></span><span>  </span><span id="local-6989586621688399050"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399050"><span class="hs-identifier hs-var">similarArrFields</span></a></span></span><span>
</span><span id="line-789"></span><span>  </span><span id="local-6989586621688399049"><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
</span><a href="#local-6989586621688399049"><span class="hs-identifier hs-var">selectFrom</span></a></span></span><span>
</span><span id="line-790"></span><span>  </span><span id="local-6989586621688399048"><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399048"><span class="hs-identifier hs-var">permLimitSubQ</span></a></span></span><span>
</span><span id="line-791"></span><span>  </span><span id="local-6989586621688399047"><span class="annot"><span class="annottext">TablePerm ('Postgres pgKind)
</span><a href="#local-6989586621688399047"><span class="hs-identifier hs-var">tablePermissions</span></a></span></span><span>
</span><span id="line-792"></span><span>  </span><span id="local-6989586621688399046"><span class="annot"><span class="annottext">SelectArgs ('Postgres pgKind)
</span><a href="#local-6989586621688399046"><span class="hs-identifier hs-var">tableArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-793"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621688399045"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399045"><span class="hs-identifier hs-var">additionalExtrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399044"><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621688399044"><span class="hs-identifier hs-var">selectSorting</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399043"><span class="annot"><span class="annottext">Maybe SQLExp
</span><a href="#local-6989586621688399043"><span class="hs-identifier hs-var">cursorExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-794"></span><span>      </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; m ([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind)) =&gt;
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; m ([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processOrderByItems"><span class="hs-identifier hs-var">processOrderByItems</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399041"><span class="hs-identifier hs-var">thisSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399051"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399050"><span class="hs-identifier hs-var">similarArrFields</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (Column ('Postgres pgKind)))
Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621688399040"><span class="hs-identifier hs-var">distM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399039"><span class="hs-identifier hs-var">orderByM</span></a></span><span>
</span><span id="line-795"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688399038"><span class="annot"><span class="annottext">fromItem :: FromItem
</span><a href="#local-6989586621688399038"><span class="hs-identifier hs-var hs-var">fromItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SelectFrom ('Postgres pgKind) -&gt; FromItem
forall (pgKind :: PostgresKind).
Identifier -&gt; SelectFrom ('Postgres pgKind) -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToFromItem"><span class="hs-identifier hs-var">selectFromToFromItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfBase"><span class="hs-identifier hs-var hs-var">_pfBase</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399052"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
</span><a href="#local-6989586621688399049"><span class="hs-identifier hs-var">selectFrom</span></a></span><span>
</span><span id="line-796"></span><span>        </span><span id="local-6989586621688399036"><span class="annot"><span class="annottext">finalWhere :: BoolExp
</span><a href="#local-6989586621688399036"><span class="hs-identifier hs-var hs-var">finalWhere</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-797"></span><span>          </span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind) -&gt; Qual
forall (pgKind :: PostgresKind).
SelectFrom ('Postgres pgKind) -&gt; Qual
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToQual"><span class="hs-identifier hs-var">selectFromToQual</span></a></span><span> </span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
</span><a href="#local-6989586621688399049"><span class="hs-identifier hs-var">selectFrom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp)
-&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-798"></span><span>            </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
-&gt; (AnnBoolExp ('Postgres pgKind) SQLExp
    -&gt; AnnBoolExp ('Postgres pgKind) SQLExp)
-&gt; Maybe (AnnBoolExp ('Postgres pgKind) SQLExp)
-&gt; AnnBoolExp ('Postgres pgKind) SQLExp
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399034"><span class="hs-identifier hs-var">permFilter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
-&gt; AnnBoolExp ('Postgres pgKind) SQLExp
-&gt; AnnBoolExp ('Postgres pgKind) SQLExp
forall (backend :: BackendType) a.
AnnBoolExp backend a
-&gt; AnnBoolExp backend a -&gt; AnnBoolExp backend a
</span><a href="Hasura.RQL.IR.BoolExp.html#andAnnBoolExps"><span class="hs-identifier hs-var">andAnnBoolExps</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399034"><span class="hs-identifier hs-var">permFilter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (AnnBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688399032"><span class="hs-identifier hs-var">whereM</span></a></span><span>
</span><span id="line-799"></span><span>        </span><span id="local-6989586621688399031"><span class="annot"><span class="annottext">sortingAndSlicing :: SortingAndSlicing
</span><a href="#local-6989586621688399031"><span class="hs-identifier hs-var hs-var">sortingAndSlicing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectSorting -&gt; SelectSlicing -&gt; SortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SortingAndSlicing"><span class="hs-identifier hs-var">SortingAndSlicing</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621688399044"><span class="hs-identifier hs-var">selectSorting</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688399029"><span class="hs-identifier hs-var">selectSlicing</span></a></span><span>
</span><span id="line-800"></span><span>        </span><span id="local-6989586621688399028"><span class="annot"><span class="annottext">selectSource :: SelectSource
</span><a href="#local-6989586621688399028"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-801"></span><span>          </span><span class="annot"><span class="annottext">Identifier
-&gt; FromItem -&gt; BoolExp -&gt; SortingAndSlicing -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-var">SelectSource</span></a></span><span>
</span><span id="line-802"></span><span>            </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399041"><span class="hs-identifier hs-var">thisSourcePrefix</span></a></span><span>
</span><span id="line-803"></span><span>            </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688399038"><span class="hs-identifier hs-var">fromItem</span></a></span><span>
</span><span id="line-804"></span><span>            </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688399036"><span class="hs-identifier hs-var">finalWhere</span></a></span><span>
</span><span id="line-805"></span><span>            </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="#local-6989586621688399031"><span class="hs-identifier hs-var">sortingAndSlicing</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span class="annot"><span class="annottext">(SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-807"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688399028"><span class="hs-identifier hs-var">selectSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-808"></span><span>        </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399045"><span class="hs-identifier hs-var">additionalExtrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-809"></span><span>        </span><span class="annot"><span class="annottext">Maybe SQLExp
</span><a href="#local-6989586621688399043"><span class="hs-identifier hs-var">cursorExp</span></a></span><span>
</span><span id="line-810"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-812"></span><span>      </span><span id="local-6989586621688399041"><span class="annot"><span class="annottext">thisSourcePrefix :: Identifier
</span><a href="#local-6989586621688399041"><span class="hs-identifier hs-var hs-var">thisSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688399052"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SelectArgs"><span class="hs-identifier hs-type">SelectArgs</span></a></span><span> </span><span id="local-6989586621688399032"><span class="annot"><span class="annottext">Maybe (AnnBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688399032"><span class="hs-identifier hs-var">whereM</span></a></span></span><span> </span><span id="local-6989586621688399039"><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688399039"><span class="hs-identifier hs-var">orderByM</span></a></span></span><span> </span><span id="local-6989586621688399025"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399025"><span class="hs-identifier hs-var">inpLimitM</span></a></span></span><span> </span><span id="local-6989586621688399024"><span class="annot"><span class="annottext">Maybe Int64
</span><a href="#local-6989586621688399024"><span class="hs-identifier hs-var">offsetM</span></a></span></span><span> </span><span id="local-6989586621688399040"><span class="annot"><span class="annottext">Maybe (NonEmpty (Column ('Postgres pgKind)))
</span><a href="#local-6989586621688399040"><span class="hs-identifier hs-var">distM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectArgs ('Postgres pgKind)
SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399046"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#TablePerm"><span class="hs-identifier hs-type">TablePerm</span></a></span><span> </span><span id="local-6989586621688399034"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399034"><span class="hs-identifier hs-var">permFilter</span></a></span></span><span> </span><span id="local-6989586621688399022"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399022"><span class="hs-identifier hs-var">permLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TablePerm ('Postgres pgKind)
TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688399047"><span class="hs-identifier hs-var">tablePermissions</span></a></span><span>
</span><span id="line-815"></span><span>      </span><span id="local-6989586621688399029"><span class="annot"><span class="annottext">selectSlicing :: SelectSlicing
</span><a href="#local-6989586621688399029"><span class="hs-identifier hs-var hs-var">selectSlicing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int64 -&gt; SelectSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSlicing"><span class="hs-identifier hs-var">SelectSlicing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399020"><span class="hs-identifier hs-var">finalLimit</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int64
</span><a href="#local-6989586621688399024"><span class="hs-identifier hs-var">offsetM</span></a></span><span>
</span><span id="line-816"></span><span>      </span><span id="local-6989586621688399020"><span class="annot"><span class="annottext">finalLimit :: Maybe Int
</span><a href="#local-6989586621688399020"><span class="hs-identifier hs-var hs-var">finalLimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-comment">-- if sub query is required, then only use input limit</span><span>
</span><span id="line-818"></span><span>        </span><span class="hs-comment">--    because permission limit is being applied in subquery</span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-comment">-- else compare input and permission limits</span><span>
</span><span id="line-820"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688399048"><span class="hs-identifier hs-var">permLimitSubQ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-821"></span><span>          </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQRequired"><span class="hs-identifier hs-type">PLSQRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399025"><span class="hs-identifier hs-var">inpLimitM</span></a></span><span>
</span><span id="line-822"></span><span>          </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399019"><span class="hs-identifier hs-var">compareLimits</span></a></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span>      </span><span id="local-6989586621688399019"><span class="annot"><span class="annottext">compareLimits :: Maybe Int
</span><a href="#local-6989586621688399019"><span class="hs-identifier hs-var hs-var">compareLimits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399025"><span class="hs-identifier hs-var">inpLimitM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399022"><span class="hs-identifier hs-var">permLimit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-826"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621688399018"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399018"><span class="hs-identifier hs-var">inpLim</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399018"><span class="hs-identifier hs-var">inpLim</span></a></span><span>
</span><span id="line-827"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399017"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399017"><span class="hs-identifier hs-var">permLim</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621688399017"><span class="hs-identifier hs-var">permLim</span></a></span><span>
</span><span id="line-828"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688399016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399016"><span class="hs-identifier hs-var">inp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688399015"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399015"><span class="hs-identifier hs-var">perm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399016"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399015"><span class="hs-identifier hs-var">perm</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399016"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688399015"><span class="hs-identifier hs-var">perm</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processOrderByItems"><span class="hs-identifier hs-type">processOrderByItems</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399669"><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399670"><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-837"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-839"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-840"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItem"><span class="hs-identifier hs-type">AnnotatedOrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-841"></span><span>  </span><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-842"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Order by Extractors</span><span>
</span><span id="line-843"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSorting"><span class="hs-identifier hs-type">SelectSorting</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-844"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-comment">-- The cursor expression</span><span>
</span><span id="line-845"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span id="processOrderByItems"><span class="annot"><span class="annottext">processOrderByItems :: Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
-&gt; m ([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processOrderByItems"><span class="hs-identifier hs-var hs-var">processOrderByItems</span></a></span></span><span> </span><span id="local-6989586621688399013"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399013"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span></span><span> </span><span id="local-6989586621688399012"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399012"><span class="hs-identifier hs-var">fieldAlias'</span></a></span></span><span> </span><span id="local-6989586621688399011"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399011"><span class="hs-identifier hs-var">similarArrayFields</span></a></span></span><span> </span><span id="local-6989586621688399010"><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621688399010"><span class="hs-identifier hs-var">distOnCols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><span class="annottext">Maybe (NonEmpty (AnnotatedOrderByItem ('Postgres pgKind)))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
-&gt; m ([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#NoSorting"><span class="hs-identifier hs-var">NoSorting</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe DistinctExpr -&gt; SelectSorting)
-&gt; Maybe DistinctExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var">applyDistinctOnAtBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; DistinctExpr)
-&gt; Maybe (NonEmpty PGCol) -&gt; Maybe DistinctExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621688399010"><span class="hs-identifier hs-var">distOnCols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SQLExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688399008"><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
</span><a href="#local-6989586621688399008"><span class="hs-identifier hs-var">orderByItems</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621688399007"><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
</span><a href="#local-6989586621688399007"><span class="hs-identifier hs-var">orderByItemExps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp)
-&gt; (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
    -&gt; m (OrderByItemG
            ('Postgres pgKind)
            (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
             (Alias, SQLExp))))
-&gt; m (NonEmpty
        (OrderByItemG
           ('Postgres pgKind)
           (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
            (Alias, SQLExp))))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AnnotatedOrderByItem ('Postgres pgKind))
NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688399008"><span class="hs-identifier hs-var">orderByItems</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement
           ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
         (Alias, SQLExpression ('Postgres pgKind))))
AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp)))
</span><a href="#local-6989586621688399006"><span class="hs-identifier hs-var">processAnnOrderByItem</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399005"><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621688399005"><span class="hs-identifier hs-var">sorting</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688399004"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399004"><span class="hs-identifier hs-var">distinctOnExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (Alias, SQLExpression ('Postgres pgKind))))
-&gt; (SelectSorting, [(Alias, SQLExpression ('Postgres pgKind))])
</span><a href="#local-6989586621688399003"><span class="hs-identifier hs-var">generateSorting</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (Alias, SQLExpression ('Postgres pgKind))))
NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
</span><a href="#local-6989586621688399007"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-851"></span><span>        </span><span id="local-6989586621688399002"><span class="annot"><span class="annottext">orderByExtractors :: [(Alias, SQLExp)]
</span><a href="#local-6989586621688399002"><span class="hs-identifier hs-var hs-var">orderByExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Alias, SQLExp)]] -&gt; [(Alias, SQLExp)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(Alias, SQLExp)]] -&gt; [(Alias, SQLExp)])
-&gt; [[(Alias, SQLExp)]] -&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty [(Alias, SQLExp)] -&gt; [[(Alias, SQLExp)]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty [(Alias, SQLExp)] -&gt; [[(Alias, SQLExp)]])
-&gt; NonEmpty [(Alias, SQLExp)] -&gt; [[(Alias, SQLExp)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (Alias, SQLExp))
 -&gt; (Alias, SQLExp))
-&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (Alias, SQLExp))]
-&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (Alias, SQLExp))
-&gt; (Alias, SQLExp)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))]
 -&gt; [(Alias, SQLExp)])
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp))])
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
-&gt; [(Alias, SQLExp)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
-&gt; [(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (Alias, SQLExp))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
 -&gt; [(Alias, SQLExp)])
-&gt; NonEmpty
     (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp)))
-&gt; NonEmpty [(Alias, SQLExp)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
</span><a href="#local-6989586621688399007"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-852"></span><span>        </span><span id="local-6989586621688399000"><span class="annot"><span class="annottext">cursor :: SQLExp
</span><a href="#local-6989586621688399000"><span class="hs-identifier hs-var hs-var">cursor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
</span><a href="#local-6989586621688398999"><span class="hs-identifier hs-var">mkCursorExp</span></a></span><span> </span><span class="annot"><span class="annottext">([OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement
       ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
     (Alias, SQLExpression ('Postgres pgKind)))]
 -&gt; SQLExp)
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement
         ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
       (Alias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
</span><a href="#local-6989586621688399007"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span>
</span><span id="line-853"></span><span>    </span><span class="annot"><span class="annottext">([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
-&gt; m ([(Alias, SQLExp)], SelectSorting, Maybe SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399002"><span class="hs-identifier hs-var">orderByExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688399004"><span class="hs-identifier hs-var">distinctOnExtractors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621688399005"><span class="hs-identifier hs-var">sorting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe SQLExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688399000"><span class="hs-identifier hs-var">cursor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><a href="#local-6989586621688399006"><span class="hs-identifier hs-type">processAnnOrderByItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-856"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByItem"><span class="hs-identifier hs-type">AnnotatedOrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-857"></span><span>      </span><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>    </span><span id="local-6989586621688399006"><span class="annot"><span class="annottext">processAnnOrderByItem :: AnnotatedOrderByItem ('Postgres pgKind)
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement
           ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
         (Alias, SQLExpression ('Postgres pgKind))))
</span><a href="#local-6989586621688399006"><span class="hs-identifier hs-var hs-var">processAnnOrderByItem</span></a></span></span><span> </span><span id="local-6989586621688398998"><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
</span><a href="#local-6989586621688398998"><span class="hs-identifier hs-var">orderByItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>      </span><span class="annot"><span class="annottext">AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp
    -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (Alias, SQLExp)))
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByItem ('Postgres pgKind)
AnnotatedOrderByItemG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398998"><span class="hs-identifier hs-var">orderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp
  -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (Alias, SQLExp)))
 -&gt; m (OrderByItemG
         ('Postgres pgKind)
         (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (Alias, SQLExp))))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp
    -&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
          (Alias, SQLExp)))
-&gt; m (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688398997"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398997"><span class="hs-identifier hs-var">ordByCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398997"><span class="hs-identifier hs-var">ordByCol</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>          </span><span class="annot"><span class="annottext">((Alias, SQLExp)
 -&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (Alias, SQLExp)))
-&gt; m (Alias, SQLExp)
-&gt; m (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (Alias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688398996"><span class="hs-identifier hs-var">processAnnotatedOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399013"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688399012"><span class="hs-identifier hs-var">fieldAlias'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398997"><span class="hs-identifier hs-var">ordByCol</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>    </span><span class="annot"><a href="#local-6989586621688398996"><span class="hs-identifier hs-type">processAnnotatedOrderByElement</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-864"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688399670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>    </span><span id="local-6989586621688398996"><span class="annot"><span class="annottext">processAnnotatedOrderByElement :: Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (Alias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688398996"><span class="hs-identifier hs-var hs-var">processAnnotatedOrderByElement</span></a></span></span><span> </span><span id="local-6989586621688398995"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688398994"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398994"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688398993"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398993"><span class="hs-identifier hs-var">annObCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-866"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398992"><span class="annot"><span class="annottext">ordByAlias :: Alias
</span><a href="#local-6989586621688398992"><span class="hs-identifier hs-var hs-var">ordByAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; Alias
forall (pgKind :: PostgresKind) v.
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var">mkAnnOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398994"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399011"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398993"><span class="hs-identifier hs-var">annObCol</span></a></span><span>
</span><span id="line-867"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398992"><span class="hs-identifier hs-var">ordByAlias</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; (Alias, SQLExp)) -&gt; m SQLExp -&gt; m (Alias, SQLExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398993"><span class="hs-identifier hs-var">annObCol</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-868"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621688398991"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398991"><span class="hs-identifier hs-var">pgColInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>          </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-870"></span><span>            </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Identifier) -&gt; PGCol -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398991"><span class="hs-identifier hs-var">pgColInfo</span></a></span><span>
</span><span id="line-871"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCObjectRelation"><span class="hs-identifier hs-type">AOCObjectRelation</span></a></span><span> </span><span id="local-6989586621688398990"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398990"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span id="local-6989586621688398989"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398989"><span class="hs-identifier hs-var">relFilter</span></a></span></span><span> </span><span id="local-6989586621688398988"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398988"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp) -&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ObjectRelationSource, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteObjectRelation"><span class="hs-identifier hs-var">withWriteObjectRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
 -&gt; m SQLExp)
-&gt; m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html#RelInfo"><span class="hs-identifier hs-type">RelInfo</span></a></span><span> </span><span id="local-6989586621688398986"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398986"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398985"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688398985"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688398984"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688398984"><span class="hs-identifier hs-var">relTable</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsertOrder
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398990"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-873"></span><span>              </span><span id="local-6989586621688398983"><span class="annot"><span class="annottext">relSourcePrefix :: Identifier
</span><a href="#local-6989586621688398983"><span class="hs-identifier hs-var hs-var">relSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; RelName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-var">mkObjectRelationTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398986"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-874"></span><span>              </span><span id="local-6989586621688398982"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621688398982"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398986"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-875"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621688398981"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398981"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398980"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398980"><span class="hs-identifier hs-var">relOrdByExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-876"></span><span>            </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; m (Alias, SQLExpression ('Postgres pgKind))
</span><a href="#local-6989586621688398996"><span class="hs-identifier hs-var">processAnnotatedOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398983"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398982"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398988"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-877"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398979"><span class="annot"><span class="annottext">selectSource :: ObjectSelectSource
</span><a href="#local-6989586621688398979"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-878"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; FromItem -&gt; BoolExp -&gt; ObjectSelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectSelectSource"><span class="hs-identifier hs-var">ObjectSelectSource</span></a></span><span>
</span><span id="line-879"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398983"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span>
</span><span id="line-880"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398984"><span class="hs-identifier hs-var">relTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398984"><span class="hs-identifier hs-var">relTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398989"><span class="hs-identifier hs-var">relFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>              </span><span id="local-6989586621688398977"><span class="annot"><span class="annottext">relSource :: ObjectRelationSource
</span><a href="#local-6989586621688398977"><span class="hs-identifier hs-var hs-var">relSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName
-&gt; HashMap PGCol PGCol
-&gt; ObjectSelectSource
-&gt; ObjectRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-var">ObjectRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398986"><span class="hs-identifier hs-var">relName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688398985"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621688398979"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-883"></span><span>          </span><span class="annot"><span class="annottext">(ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
-&gt; m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-884"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688398977"><span class="hs-identifier hs-var">relSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-885"></span><span>              </span><span class="annot"><span class="annottext">Alias -&gt; SQLExp -&gt; HashMap Alias SQLExp
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398981"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398980"><span class="hs-identifier hs-var">relOrdByExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-886"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; Alias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398983"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398981"><span class="hs-identifier hs-var">relOrderByAlias</span></a></span><span>
</span><span id="line-887"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621688398975"><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398975"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span id="local-6989586621688398974"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398974"><span class="hs-identifier hs-var">relFilter</span></a></span></span><span> </span><span id="local-6989586621688398973"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398973"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteArrayRelation"><span class="hs-identifier hs-var">withWriteArrayRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, SQLExp)
 -&gt; m SQLExp)
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-889"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Relationships.Local.html#RelInfo"><span class="hs-identifier hs-type">RelInfo</span></a></span><span> </span><span id="local-6989586621688398972"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398972"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398971"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688398971"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688398970"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688398970"><span class="hs-identifier hs-var">relTable</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InsertOrder
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398975"><span class="hs-identifier hs-var">relInfo</span></a></span><span>
</span><span id="line-890"></span><span>              </span><span id="local-6989586621688398969"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621688398969"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398972"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-891"></span><span>              </span><span id="local-6989586621688398968"><span class="annot"><span class="annottext">relSourcePrefix :: Identifier
</span><a href="#local-6989586621688398968"><span class="hs-identifier hs-var hs-var">relSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-892"></span><span>                </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; FieldName
-&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-var">mkArrayRelationSourcePrefix</span></a></span><span>
</span><span id="line-893"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span>
</span><span id="line-894"></span><span>                  </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398994"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-895"></span><span>                  </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399011"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span>
</span><span id="line-896"></span><span>                  </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398969"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-897"></span><span>              </span><span id="local-6989586621688398967"><span class="annot"><span class="annottext">relAlias :: Alias
</span><a href="#local-6989586621688398967"><span class="hs-identifier hs-var hs-var">relAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; HashMap FieldName [FieldName] -&gt; FieldName -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationAlias"><span class="hs-identifier hs-var">mkArrayRelationAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398994"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688399011"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398969"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-898"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621688398966"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398966"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398965"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398965"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-var">mkAggregateOrderByExtractorAndFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398973"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-899"></span><span>              </span><span id="local-6989586621688398964"><span class="annot"><span class="annottext">selectSource :: SelectSource
</span><a href="#local-6989586621688398964"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-900"></span><span>                </span><span class="annot"><span class="annottext">Identifier
-&gt; FromItem -&gt; BoolExp -&gt; SortingAndSlicing -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-var">SelectSource</span></a></span><span>
</span><span id="line-901"></span><span>                  </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398968"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span>
</span><span id="line-902"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398970"><span class="hs-identifier hs-var">relTable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398970"><span class="hs-identifier hs-var">relTable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398974"><span class="hs-identifier hs-var">relFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>                  </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#noSortingAndSlicing"><span class="hs-identifier hs-var">noSortingAndSlicing</span></a></span><span>
</span><span id="line-905"></span><span>              </span><span id="local-6989586621688398962"><span class="annot"><span class="annottext">relSource :: ArrayRelationSource
</span><a href="#local-6989586621688398962"><span class="hs-identifier hs-var hs-var">relSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; SelectSource -&gt; ArrayRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-var">ArrayRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398967"><span class="hs-identifier hs-var">relAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688398971"><span class="hs-identifier hs-var">colMapping</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398964"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-906"></span><span>          </span><span class="annot"><span class="annottext">(ArrayRelationSource, Extractor, HashMap Alias SQLExp, SQLExp)
-&gt; m (ArrayRelationSource, Extractor, HashMap Alias SQLExp, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-907"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688398962"><span class="hs-identifier hs-var">relSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-908"></span><span>              </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398966"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-909"></span><span>              </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; HashMap Alias SQLExp)
-&gt; [(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
forall (pgKind :: PostgresKind).
Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398968"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398965"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-910"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; Alias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398968"><span class="hs-identifier hs-var">relSourcePrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398973"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCComputedField"><span class="hs-identifier hs-type">AOCComputedField</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ComputedFieldOrderBy"><span class="hs-identifier hs-type">ComputedFieldOrderBy</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688398956"><span id="local-6989586621688398957"><span id="local-6989586621688398958"><span id="local-6989586621688398959"><span id="local-6989586621688398960"><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
XComputedField ('Postgres pgKind)
ComputedFieldName
FunctionArgsExpTableRow SQLExp
ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
_cfobFunctionArgsExp :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; FunctionArgsExpTableRow v
_cfobFunction :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; FunctionName b
_cfobXField :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; XComputedField b
_cfobOrderByElement :: ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
_cfobFunctionArgsExp :: FunctionArgsExpTableRow SQLExp
_cfobFunction :: FunctionName ('Postgres pgKind)
_cfobName :: ComputedFieldName
_cfobXField :: XComputedField ('Postgres pgKind)
_cfobOrderByElement :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
_cfobName :: forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldName
</span><a href="Hasura.RQL.IR.Select.html#_cfobFunctionArgsExp"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398956"><span class="hs-identifier hs-var">_cfobOrderByElement</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-914"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBEScalar"><span class="hs-identifier hs-type">CFOBEScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-915"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398952"><span class="annot"><span class="annottext">functionArgs :: FunctionArgs
</span><a href="#local-6989586621688398952"><span class="hs-identifier hs-var hs-var">functionArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FunctionArgsExpTableRow SQLExp -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#fromTableRowArgs"><span class="hs-identifier hs-var">fromTableRowArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpTableRow SQLExp
</span><a href="#local-6989586621688398957"><span class="hs-identifier hs-var">_cfobFunctionArgsExp</span></a></span><span>
</span><span id="line-916"></span><span>                  </span><span id="local-6989586621688398951"><span class="annot"><span class="annottext">functionExp :: FunctionExp
</span><a href="#local-6989586621688398951"><span class="hs-identifier hs-var hs-var">functionExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedFunction
-&gt; FunctionArgs -&gt; Maybe FunctionAlias -&gt; FunctionExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionExp"><span class="hs-identifier hs-var">S.FunctionExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688398958"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgs
</span><a href="#local-6989586621688398952"><span class="hs-identifier hs-var">functionArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FunctionAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-917"></span><span>              </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunctionExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFunction"><span class="hs-identifier hs-var">S.SEFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionExp
</span><a href="#local-6989586621688398951"><span class="hs-identifier hs-var">functionExp</span></a></span><span>
</span><span id="line-918"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBETableAggregation"><span class="hs-identifier hs-type">CFOBETableAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398949"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398949"><span class="hs-identifier hs-var">tableFilter</span></a></span></span><span> </span><span id="local-6989586621688398948"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398948"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
   SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteComputedFieldTableSet"><span class="hs-identifier hs-var">withWriteComputedFieldTableSet</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
    SQLExp)
 -&gt; m SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
      SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-919"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398947"><span class="annot"><span class="annottext">fieldName :: FieldName
</span><a href="#local-6989586621688398947"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; FieldName
forall a. ToTxt a =&gt; a -&gt; FieldName
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkOrderByFieldName"><span class="hs-identifier hs-var">mkOrderByFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621688398959"><span class="hs-identifier hs-var">_cfobName</span></a></span><span>
</span><span id="line-920"></span><span>                  </span><span id="local-6989586621688398946"><span class="annot"><span class="annottext">computedFieldSourcePrefix :: Identifier
</span><a href="#local-6989586621688398946"><span class="hs-identifier hs-var hs-var">computedFieldSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var">mkComputedFieldTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398947"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-921"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621688398945"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398945"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398944"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398944"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
AnnotatedAggregateOrderBy ('Postgres pgKind)
-&gt; (Extractor, AggregateFields ('Postgres pgKind))
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByExtractorAndFields"><span class="hs-identifier hs-var">mkAggregateOrderByExtractorAndFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398948"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-922"></span><span>                  </span><span id="local-6989586621688398943"><span class="annot"><span class="annottext">fromItem :: FromItem
</span><a href="#local-6989586621688398943"><span class="hs-identifier hs-var hs-var">fromItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-923"></span><span>                    </span><span class="annot"><span class="annottext">Identifier -&gt; SelectFrom ('Postgres Any) -&gt; FromItem
forall (pgKind :: PostgresKind).
Identifier -&gt; SelectFrom ('Postgres pgKind) -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#selectFromToFromItem"><span class="hs-identifier hs-var">selectFromToFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398995"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectFrom ('Postgres Any) -&gt; FromItem)
-&gt; SelectFrom ('Postgres Any) -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-924"></span><span>                      </span><span class="annot"><span class="annottext">FunctionName ('Postgres Any)
-&gt; FunctionArgsExpTableRow SQLExp
-&gt; Maybe [(Column ('Postgres Any), ScalarType ('Postgres Any))]
-&gt; SelectFromG ('Postgres Any) SQLExp
forall (b :: BackendType) v.
FunctionName b
-&gt; FunctionArgsExpTableRow v
-&gt; Maybe [(Column b, ScalarType b)]
-&gt; SelectFromG b v
</span><a href="Hasura.RQL.IR.Select.html#FromFunction"><span class="hs-identifier hs-var">FromFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
FunctionName ('Postgres Any)
</span><a href="#local-6989586621688398958"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpTableRow SQLExp
</span><a href="#local-6989586621688398957"><span class="hs-identifier hs-var">_cfobFunctionArgsExp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [(Column ('Postgres Any), ScalarType ('Postgres Any))]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-925"></span><span>                  </span><span id="local-6989586621688398942"><span class="annot"><span class="annottext">functionQual :: Qual
</span><a href="#local-6989586621688398942"><span class="hs-identifier hs-var hs-var">functionQual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedFunction -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#functionToIdentifier"><span class="hs-identifier hs-var">functionToIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688398958"><span class="hs-identifier hs-var">_cfobFunction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-926"></span><span>                  </span><span id="local-6989586621688398941"><span class="annot"><span class="annottext">selectSource :: SelectSource
</span><a href="#local-6989586621688398941"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>                    </span><span class="annot"><span class="annottext">Identifier
-&gt; FromItem -&gt; BoolExp -&gt; SortingAndSlicing -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-var">SelectSource</span></a></span><span>
</span><span id="line-928"></span><span>                      </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398946"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span>
</span><span id="line-929"></span><span>                      </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398943"><span class="hs-identifier hs-var">fromItem</span></a></span><span>
</span><span id="line-930"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">Qual
</span><a href="#local-6989586621688398942"><span class="hs-identifier hs-var">functionQual</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398949"><span class="hs-identifier hs-var">tableFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>                      </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#noSortingAndSlicing"><span class="hs-identifier hs-var">noSortingAndSlicing</span></a></span><span>
</span><span id="line-932"></span><span>                  </span><span id="local-6989586621688398940"><span class="annot"><span class="annottext">source :: ComputedFieldTableSetSource
</span><a href="#local-6989586621688398940"><span class="hs-identifier hs-var hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; SelectSource -&gt; ComputedFieldTableSetSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-var">ComputedFieldTableSetSource</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398947"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398941"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-933"></span><span>              </span><span class="annot"><span class="annottext">(ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
 SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
      SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-934"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688398940"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-935"></span><span>                  </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398945"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-936"></span><span>                  </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; HashMap Alias SQLExp)
-&gt; [(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
forall (pgKind :: PostgresKind).
Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398946"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398944"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-937"></span><span>                  </span><span class="annot"><span class="annottext">Identifier -&gt; Alias -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398946"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
forall (pgKind :: PostgresKind).
AnnotatedAggregateOrderBy ('Postgres pgKind) -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateOrderByAlias"><span class="hs-identifier hs-var">mkAggregateOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy ('Postgres pgKind)
</span><a href="#local-6989586621688398948"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>    </span><span class="annot"><a href="#local-6989586621688399003"><span class="hs-identifier hs-type">generateSorting</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-941"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-942"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSorting"><span class="hs-identifier hs-type">SelectSorting</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-943"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- 'distinct on' column extractors</span><span>
</span><span id="line-944"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>    </span><span id="local-6989586621688399003"><span class="annot"><span class="annottext">generateSorting :: NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (Alias, SQLExpression ('Postgres pgKind))))
-&gt; (SelectSorting, [(Alias, SQLExpression ('Postgres pgKind))])
</span><a href="#local-6989586621688399003"><span class="hs-identifier hs-var hs-var">generateSorting</span></a></span></span><span> </span><span id="local-6989586621688398938"><span class="annot"><span class="annottext">orderByExps :: NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (Alias, SQLExpression ('Postgres pgKind))))
</span><a href="#local-6989586621688398938"><span class="hs-identifier hs-var">orderByExps</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621688398937"><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (Alias, SQLExpression ('Postgres pgKind)))
</span><a href="#local-6989586621688398937"><span class="hs-identifier hs-var">firstOrderBy</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span id="local-6989586621688398935"><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
</span><a href="#local-6989586621688398935"><span class="hs-identifier hs-var">restOrderBys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (Alias, SQLExp))
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (Alias, SQLExp))
 -&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (Alias, SQLExpression ('Postgres pgKind)))
OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
</span><a href="#local-6989586621688398937"><span class="hs-identifier hs-var">firstOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-947"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621688398934"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398934"><span class="hs-identifier hs-var">columnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-948"></span><span>          </span><span class="hs-comment">-- If rest order by expressions are all columns then apply order by clause at base selection.</span><span>
</span><span id="line-949"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
 -&gt; Bool)
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ColumnInfo ('Postgres pgKind)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (ColumnInfo ('Postgres pgKind)) -&gt; Bool)
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (Alias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall (b :: BackendType) v b.
(AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621688398931"><span class="hs-identifier hs-var">getColumnOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (Alias, SQLExp))
 -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (Alias, SQLExp)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
-&gt; (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))]
</span><a href="#local-6989586621688398935"><span class="hs-identifier hs-var">restOrderBys</span></a></span><span>
</span><span id="line-950"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Collect column order by expressions from the rest.</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398930"><span class="annot"><span class="annottext">restColumnOrderBys :: [OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
</span><a href="#local-6989586621688398930"><span class="hs-identifier hs-var hs-var">restColumnOrderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
 -&gt; Maybe
      (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))))
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))]
-&gt; [OrderByItemG
      ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind) (Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; Maybe
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><span class="hs-identifier hs-var">sequenceA</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind) (Maybe (ColumnInfo ('Postgres pgKind)))
 -&gt; Maybe
      (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))))
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; OrderByItemG
         ('Postgres pgKind) (Maybe (ColumnInfo ('Postgres pgKind))))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
-&gt; Maybe
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
 (Alias, SQLExp))
-&gt; Maybe (ColumnInfo ('Postgres pgKind))
forall (b :: BackendType) v b.
(AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621688398931"><span class="hs-identifier hs-var">getColumnOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">((AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
  (Alias, SQLExp))
 -&gt; Maybe (ColumnInfo ('Postgres pgKind)))
-&gt; OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp))
-&gt; OrderByItemG
     ('Postgres pgKind) (Maybe (ColumnInfo ('Postgres pgKind)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))]
</span><a href="#local-6989586621688398935"><span class="hs-identifier hs-var">restOrderBys</span></a></span><span>
</span><span id="line-953"></span><span>                  </span><span id="local-6989586621688398928"><span class="annot"><span class="annottext">firstColumnOrderBy :: OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
</span><a href="#local-6989586621688398928"><span class="hs-identifier hs-var hs-var">firstColumnOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
   (Alias, SQLExpression ('Postgres pgKind)))
OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
</span><a href="#local-6989586621688398937"><span class="hs-identifier hs-var">firstOrderBy</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">obiColumn :: ColumnInfo ('Postgres pgKind)
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var">obiColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398934"><span class="hs-identifier hs-var">columnInfo</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-954"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(Alias, SQLExp)])
</span><a href="#local-6989586621688398927"><span class="hs-identifier hs-var">sortAtNodeAndBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty
   (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
 -&gt; (SelectSorting, [(Alias, SQLExp)]))
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(Alias, SQLExp)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
</span><a href="#local-6989586621688398928"><span class="hs-identifier hs-var">firstColumnOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
-&gt; [OrderByItemG
      ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))]
</span><a href="#local-6989586621688398930"><span class="hs-identifier hs-var">restColumnOrderBys</span></a></span><span>
</span><span id="line-955"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- Else rest order by expressions contain atleast one non-column order by.</span><span>
</span><span id="line-956"></span><span>            </span><span class="hs-comment">-- So, apply order by clause at node selection.</span><span>
</span><span id="line-957"></span><span>              </span><span class="annot"><span class="annottext">(SelectSorting, [(Alias, SQLExpression ('Postgres pgKind))])
(SelectSorting, [(Alias, SQLExp)])
</span><a href="#local-6989586621688398926"><span class="hs-identifier hs-var">sortOnlyAtNode</span></a></span><span>
</span><span id="line-958"></span><span>        </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-959"></span><span>          </span><span class="hs-comment">-- First order by expression is non-column. So, apply order by clause at node selection.</span><span>
</span><span id="line-960"></span><span>          </span><span class="annot"><span class="annottext">(SelectSorting, [(Alias, SQLExpression ('Postgres pgKind))])
(SelectSorting, [(Alias, SQLExp)])
</span><a href="#local-6989586621688398926"><span class="hs-identifier hs-var">sortOnlyAtNode</span></a></span><span>
</span><span id="line-961"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-962"></span><span>        </span><span id="local-6989586621688398931"><span class="annot"><span class="annottext">getColumnOrderBy :: (AnnotatedOrderByElement b v, b) -&gt; Maybe (ColumnInfo b)
</span><a href="#local-6989586621688398931"><span class="hs-identifier hs-var hs-var">getColumnOrderBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
-&gt; Getting
     (First (ColumnInfo b)) (AnnotatedOrderByElement b v) (ColumnInfo b)
-&gt; Maybe (ColumnInfo b)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (ColumnInfo b)) (AnnotatedOrderByElement b v) (ColumnInfo b)
forall (b :: BackendType) v.
Prism' (AnnotatedOrderByElement b v) (ColumnInfo b)
</span><a href="Hasura.RQL.IR.Select.html#_AOCColumn"><span class="hs-identifier hs-var">_AOCColumn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement b v -&gt; Maybe (ColumnInfo b))
-&gt; ((AnnotatedOrderByElement b v, b)
    -&gt; AnnotatedOrderByElement b v)
-&gt; (AnnotatedOrderByElement b v, b)
-&gt; Maybe (ColumnInfo b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement b v, b) -&gt; AnnotatedOrderByElement b v
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621688398924"><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621688398924"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398923"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398923"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398922"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398922"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-965"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398921"><span class="annot"><span class="annottext">toOrderByExp :: OrderByItemG b (a, (a, b)) -&gt; OrderByItem
</span><a href="#local-6989586621688398921"><span class="hs-identifier hs-var hs-var">toOrderByExp</span></a></span></span><span> </span><span id="local-6989586621688398920"><span class="annot"><span class="annottext">OrderByItemG b (a, (a, b))
</span><a href="#local-6989586621688398920"><span class="hs-identifier hs-var">orderByItemExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-966"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span id="local-6989586621688398918"><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
</span><a href="#local-6989586621688398918"><span class="hs-identifier hs-var">obTyM</span></a></span></span><span> </span><span id="local-6989586621688398917"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688398917"><span class="hs-identifier hs-var">expAlias</span></a></span></span><span> </span><span id="local-6989586621688398916"><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
</span><a href="#local-6989586621688398916"><span class="hs-identifier hs-var">obNullsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; a) -&gt; ((a, (a, b)) -&gt; (a, b)) -&gt; (a, (a, b)) -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, (a, b)) -&gt; (a, b)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, (a, b)) -&gt; a)
-&gt; OrderByItemG b (a, (a, b)) -&gt; OrderByItemG b a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG b (a, (a, b))
</span><a href="#local-6989586621688398920"><span class="hs-identifier hs-var">orderByItemExp</span></a></span><span>
</span><span id="line-967"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688398917"><span class="hs-identifier hs-var">expAlias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
Maybe OrderType
</span><a href="#local-6989586621688398918"><span class="hs-identifier hs-var">obTyM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
Maybe NullsOrder
</span><a href="#local-6989586621688398916"><span class="hs-identifier hs-var">obNullsM</span></a></span><span>
</span><span id="line-968"></span><span>              </span><span id="local-6989586621688398914"><span class="annot"><span class="annottext">orderByExp :: OrderByExp
</span><a href="#local-6989586621688398914"><span class="hs-identifier hs-var hs-var">orderByExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
-&gt; OrderByItem
forall a (b :: BackendType) a b.
(IsIdentifier a, BasicOrderType b ~ OrderType,
 NullsOrderType b ~ NullsOrder) =&gt;
OrderByItemG b (a, (a, b)) -&gt; OrderByItem
</span><a href="#local-6989586621688398921"><span class="hs-identifier hs-var">toOrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
 -&gt; OrderByItem)
-&gt; NonEmpty
     (OrderByItemG
        ('Postgres pgKind)
        (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
         (Alias, SQLExp)))
-&gt; NonEmpty OrderByItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement
        ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
      (Alias, SQLExpression ('Postgres pgKind))))
NonEmpty
  (OrderByItemG
     ('Postgres pgKind)
     (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
      (Alias, SQLExp)))
</span><a href="#local-6989586621688398938"><span class="hs-identifier hs-var">orderByExps</span></a></span><span>
</span><span id="line-969"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621688398913"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398913"><span class="hs-identifier hs-var">maybeDistOn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398912"><span class="annot"><span class="annottext">Maybe [(Alias, SQLExp)]
</span><a href="#local-6989586621688398912"><span class="hs-identifier hs-var">distOnExtrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (DistinctExpr, [(Alias, SQLExp)])
-&gt; (Maybe DistinctExpr, Maybe [(Alias, SQLExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; f (a, b) -&gt; (f a, f b)
</span><span class="hs-identifier hs-var">NE.unzip</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (DistinctExpr, [(Alias, SQLExp)])
 -&gt; (Maybe DistinctExpr, Maybe [(Alias, SQLExp)]))
-&gt; Maybe (DistinctExpr, [(Alias, SQLExp)])
-&gt; (Maybe DistinctExpr, Maybe [(Alias, SQLExp)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; NonEmpty PGCol -&gt; (DistinctExpr, [(Alias, SQLExp)])
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtNode"><span class="hs-identifier hs-var">applyDistinctOnAtNode</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688399013"><span class="hs-identifier hs-var">sourcePrefix'</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; (DistinctExpr, [(Alias, SQLExp)]))
-&gt; Maybe (NonEmpty PGCol)
-&gt; Maybe (DistinctExpr, [(Alias, SQLExp)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621688399010"><span class="hs-identifier hs-var">distOnCols</span></a></span><span>
</span><span id="line-970"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621688398914"><span class="hs-identifier hs-var">orderByExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398913"><span class="hs-identifier hs-var">maybeDistOn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; Maybe [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [(Alias, SQLExp)]
</span><a href="#local-6989586621688398912"><span class="hs-identifier hs-var">distOnExtrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span>        </span><span id="local-6989586621688398926"><span class="annot"><span class="annottext">sortOnlyAtNode :: (SelectSorting, [(Alias, SQLExp)])
</span><a href="#local-6989586621688398926"><span class="hs-identifier hs-var hs-var">sortOnlyAtNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-973"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistinctAndOrderByExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#Sorting"><span class="hs-identifier hs-var">Sorting</span></a></span><span> </span><span class="annot"><span class="annottext">(DistinctAndOrderByExpr -&gt; SelectSorting)
-&gt; DistinctAndOrderByExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ASorting"><span class="hs-identifier hs-var">ASorting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621688398924"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398923"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (OrderByExp, Maybe DistinctExpr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398922"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span>        </span><span id="local-6989586621688398927"><span class="annot"><span class="annottext">sortAtNodeAndBase :: NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; (SelectSorting, [(Alias, SQLExp)])
</span><a href="#local-6989586621688398927"><span class="hs-identifier hs-var hs-var">sortAtNodeAndBase</span></a></span></span><span> </span><span id="local-6989586621688398907"><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
</span><a href="#local-6989586621688398907"><span class="hs-identifier hs-var">baseColumnOrderBys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-976"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398906"><span class="annot"><span class="annottext">mkBaseOrderByItem :: OrderByItemG b (ColumnInfo b) -&gt; OrderByItem
</span><a href="#local-6989586621688398906"><span class="hs-identifier hs-var hs-var">mkBaseOrderByItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span id="local-6989586621688398905"><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
</span><a href="#local-6989586621688398905"><span class="hs-identifier hs-var">orderByType</span></a></span></span><span> </span><span id="local-6989586621688398904"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398904"><span class="hs-identifier hs-var">columnInfo</span></a></span></span><span> </span><span id="local-6989586621688398903"><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
</span><a href="#local-6989586621688398903"><span class="hs-identifier hs-var">nullsOrder</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-977"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span>
</span><span id="line-978"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Column b -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Column b -&gt; Identifier) -&gt; Column b -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398904"><span class="hs-identifier hs-var">columnInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (BasicOrderType b)
Maybe OrderType
</span><a href="#local-6989586621688398905"><span class="hs-identifier hs-var">orderByType</span></a></span><span>
</span><span id="line-980"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (NullsOrderType b)
Maybe NullsOrder
</span><a href="#local-6989586621688398903"><span class="hs-identifier hs-var">nullsOrder</span></a></span><span>
</span><span id="line-981"></span><span>              </span><span id="local-6989586621688398902"><span class="annot"><span class="annottext">baseOrderByExp :: OrderByExp
</span><a href="#local-6989586621688398902"><span class="hs-identifier hs-var hs-var">baseOrderByExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
-&gt; OrderByItem
forall (b :: BackendType) (b :: BackendType).
(IsIdentifier (Column b), BasicOrderType b ~ OrderType,
 NullsOrderType b ~ NullsOrder) =&gt;
OrderByItemG b (ColumnInfo b) -&gt; OrderByItem
</span><a href="#local-6989586621688398906"><span class="hs-identifier hs-var">mkBaseOrderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind))
 -&gt; OrderByItem)
-&gt; NonEmpty
     (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
-&gt; NonEmpty OrderByItem
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (OrderByItemG ('Postgres pgKind) (ColumnInfo ('Postgres pgKind)))
</span><a href="#local-6989586621688398907"><span class="hs-identifier hs-var">baseColumnOrderBys</span></a></span><span>
</span><span id="line-982"></span><span>              </span><span id="local-6989586621688398901"><span class="annot"><span class="annottext">baseDistOnExp :: Maybe DistinctExpr
</span><a href="#local-6989586621688398901"><span class="hs-identifier hs-var hs-var">baseDistOnExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty PGCol -&gt; DistinctExpr
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#applyDistinctOnAtBase"><span class="hs-identifier hs-var">applyDistinctOnAtBase</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty PGCol -&gt; DistinctExpr)
-&gt; Maybe (NonEmpty PGCol) -&gt; Maybe DistinctExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty PGCol)
</span><a href="#local-6989586621688399010"><span class="hs-identifier hs-var">distOnCols</span></a></span><span>
</span><span id="line-983"></span><span>              </span><span id="local-6989586621688398900"><span class="annot"><span class="annottext">sorting :: SelectSorting
</span><a href="#local-6989586621688398900"><span class="hs-identifier hs-var hs-var">sorting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistinctAndOrderByExpr -&gt; SelectSorting
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#Sorting"><span class="hs-identifier hs-var">Sorting</span></a></span><span> </span><span class="annot"><span class="annottext">(DistinctAndOrderByExpr -&gt; SelectSorting)
-&gt; DistinctAndOrderByExpr -&gt; SelectSorting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ASorting"><span class="hs-identifier hs-var">ASorting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621688398924"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398923"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr) -&gt; DistinctAndOrderByExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp, Maybe DistinctExpr)
-&gt; Maybe (OrderByExp, Maybe DistinctExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderByExp
</span><a href="#local-6989586621688398902"><span class="hs-identifier hs-var">baseOrderByExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398901"><span class="hs-identifier hs-var">baseDistOnExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSorting
</span><a href="#local-6989586621688398900"><span class="hs-identifier hs-var">sorting</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398922"><span class="hs-identifier hs-var">nodeDistinctOnExtractors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span>    </span><span class="annot"><a href="#local-6989586621688398999"><span class="hs-identifier hs-type">mkCursorExp</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnotatedOrderByElement"><span class="hs-identifier hs-type">AnnotatedOrderByElement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#SQLExpression"><span class="hs-identifier hs-type">SQLExpression</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399669"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-988"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-989"></span><span>    </span><span id="local-6989586621688398999"><span class="annot"><span class="annottext">mkCursorExp :: [OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
-&gt; SQLExp
</span><a href="#local-6989586621688398999"><span class="hs-identifier hs-var hs-var">mkCursorExp</span></a></span></span><span> </span><span id="local-6989586621688398899"><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
</span><a href="#local-6989586621688398899"><span class="hs-identifier hs-var">orderByItemExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-990"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-991"></span><span>        </span><span class="annot"><span class="annottext">((OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (Alias, SQLExp))
  -&gt; [SQLExp])
 -&gt; [OrderByItemG
       ('Postgres pgKind)
       (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
        (Alias, SQLExp))]
 -&gt; [SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))]
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))
 -&gt; [SQLExp])
-&gt; [OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))]
-&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement
      ('Postgres pgKind) (SQLExpression ('Postgres pgKind)),
    (Alias, SQLExpression ('Postgres pgKind)))]
[OrderByItemG
   ('Postgres pgKind)
   (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
    (Alias, SQLExp))]
</span><a href="#local-6989586621688398899"><span class="hs-identifier hs-var">orderByItemExps</span></a></span><span> </span><span class="annot"><span class="annottext">((OrderByItemG
    ('Postgres pgKind)
    (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
     (Alias, SQLExp))
  -&gt; [SQLExp])
 -&gt; [SQLExp])
-&gt; (OrderByItemG
      ('Postgres pgKind)
      (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
       (Alias, SQLExp))
    -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-992"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621688398898"><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
</span><a href="#local-6989586621688398898"><span class="hs-identifier hs-var">orderByItemExp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-993"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (BasicOrderType ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398897"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398897"><span class="hs-identifier hs-var">annObCol</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398896"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398896"><span class="hs-identifier hs-var">valExp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (NullsOrderType ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp,
   (Alias, SQLExp))
</span><a href="#local-6989586621688398898"><span class="hs-identifier hs-var">orderByItemExp</span></a></span><span>
</span><span id="line-994"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; [SQLExp]
forall (b :: BackendType) v.
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621688398895"><span class="hs-identifier hs-var">annObColToJSONField</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398896"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398897"><span class="hs-identifier hs-var">annObCol</span></a></span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-996"></span><span>        </span><span id="local-6989586621688398894"><span class="annot"><span class="annottext">mkAggOrderByValExp :: SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621688398894"><span class="hs-identifier hs-var hs-var">mkAggOrderByValExp</span></a></span></span><span> </span><span id="local-6989586621688398893"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398893"><span class="hs-identifier hs-var">valExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-997"></span><span>          </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="Hasura.RQL.IR.Select.html#AAOCount"><span class="hs-identifier hs-var">AAOCount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;count&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398893"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-998"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AAOOp"><span class="hs-identifier hs-type">AAOOp</span></a></span><span> </span><span id="local-6989586621688398892"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398892"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621688398891"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398891"><span class="hs-identifier hs-var">colInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-999"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398892"><span class="hs-identifier hs-var">opText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1000"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Text) -&gt; PGCol -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398891"><span class="hs-identifier hs-var">colInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398893"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1001"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>        </span><span id="local-6989586621688398895"><span class="annot"><span class="annottext">annObColToJSONField :: SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621688398895"><span class="hs-identifier hs-var hs-var">annObColToJSONField</span></a></span></span><span> </span><span id="local-6989586621688398890"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1004"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCColumn"><span class="hs-identifier hs-type">AOCColumn</span></a></span><span> </span><span id="local-6989586621688398889"><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398889"><span class="hs-identifier hs-var">pgCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Text) -&gt; PGCol -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b -&gt; Column b
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo b
</span><a href="#local-6989586621688398889"><span class="hs-identifier hs-var">pgCol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1005"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCObjectRelation"><span class="hs-identifier hs-type">AOCObjectRelation</span></a></span><span> </span><span id="local-6989586621688398888"><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688398888"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398887"><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
</span><a href="#local-6989586621688398887"><span class="hs-identifier hs-var">obCol</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1006"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#relNameToTxt"><span class="hs-identifier hs-var">relNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(RelName -&gt; Text) -&gt; RelName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688398888"><span class="hs-identifier hs-var">relInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1007"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedOrderByElement b v -&gt; [SQLExp]
</span><a href="#local-6989586621688398895"><span class="hs-identifier hs-var">annObColToJSONField</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement b v
</span><a href="#local-6989586621688398887"><span class="hs-identifier hs-var">obCol</span></a></span><span>
</span><span id="line-1008"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1009"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCArrayAggregation"><span class="hs-identifier hs-type">AOCArrayAggregation</span></a></span><span> </span><span id="local-6989586621688398885"><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688398885"><span class="hs-identifier hs-var">relInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398884"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621688398884"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1010"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RelName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#relNameToTxt"><span class="hs-identifier hs-var">relNameToTxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelInfo b -&gt; RelName
forall (b :: BackendType). RelInfo b -&gt; RelName
</span><a href="Hasura.RQL.Types.Relationships.Local.html#riName"><span class="hs-identifier hs-var hs-var">riName</span></a></span><span> </span><span class="annot"><span class="annottext">RelInfo b
</span><a href="#local-6989586621688398885"><span class="hs-identifier hs-var">relInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_aggregate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1011"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
forall (b :: BackendType).
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621688398894"><span class="hs-identifier hs-var">mkAggOrderByValExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621688398884"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-1012"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1013"></span><span>          </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AOCComputedField"><span class="hs-identifier hs-type">AOCComputedField</span></a></span><span> </span><span id="local-6989586621688398883"><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621688398883"><span class="hs-identifier hs-var">cfOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1014"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398882"><span class="annot"><span class="annottext">fieldNameText :: Text
</span><a href="#local-6989586621688398882"><span class="hs-identifier hs-var hs-var">fieldNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; Text
</span><a href="Hasura.RQL.Types.ComputedField.html#computedFieldNameToText"><span class="hs-identifier hs-var">computedFieldNameToText</span></a></span><span> </span><span class="annot"><span class="annottext">(ComputedFieldName -&gt; Text) -&gt; ComputedFieldName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v -&gt; ComputedFieldName
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldName
</span><a href="Hasura.RQL.IR.Select.html#_cfobName"><span class="hs-identifier hs-var hs-var">_cfobName</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621688398883"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span>
</span><span id="line-1015"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
forall (b :: BackendType) v.
ComputedFieldOrderBy b v -&gt; ComputedFieldOrderByElement b v
</span><a href="Hasura.RQL.IR.Select.html#_cfobOrderByElement"><span class="hs-identifier hs-var hs-var">_cfobOrderByElement</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldOrderBy b v
</span><a href="#local-6989586621688398883"><span class="hs-identifier hs-var">cfOrderBy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1016"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBEScalar"><span class="hs-identifier hs-type">CFOBEScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398882"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1017"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFOBETableAggregation"><span class="hs-identifier hs-type">CFOBETableAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnBoolExp b v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398880"><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621688398880"><span class="hs-identifier hs-var">aggOrderBy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1018"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398882"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_aggregate&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1019"></span><span>                      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
forall (b :: BackendType).
(Column b ~ PGCol) =&gt;
SQLExp -&gt; AnnotatedAggregateOrderBy b -&gt; [SQLExp]
</span><a href="#local-6989586621688398894"><span class="hs-identifier hs-var">mkAggOrderByValExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398890"><span class="hs-identifier hs-var">valExp</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedAggregateOrderBy b
</span><a href="#local-6989586621688398880"><span class="hs-identifier hs-var">aggOrderBy</span></a></span><span>
</span><span id="line-1020"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span id="local-6989586621688399702"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-type">aggregateFieldsToExtractorExps</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1023"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AggregateFields"><span class="hs-identifier hs-type">AggregateFields</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399702"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1024"></span><span id="aggregateFieldsToExtractorExps"><span class="annot"><span class="annottext">aggregateFieldsToExtractorExps :: Identifier
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#aggregateFieldsToExtractorExps"><span class="hs-identifier hs-var hs-var">aggregateFieldsToExtractorExps</span></a></span></span><span> </span><span id="local-6989586621688398879"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398879"><span class="hs-identifier hs-var">sourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688398878"><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398878"><span class="hs-identifier hs-var">aggregateFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1025"></span><span>  </span><span class="annot"><span class="annottext">(((FieldName, AggregateField ('Postgres pgKind))
  -&gt; [(Alias, SQLExp)])
 -&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)])
-&gt; AggregateFields ('Postgres pgKind)
-&gt; ((FieldName, AggregateField ('Postgres pgKind))
    -&gt; [(Alias, SQLExp)])
-&gt; [(Alias, SQLExp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, AggregateField ('Postgres pgKind))
 -&gt; [(Alias, SQLExp)])
-&gt; AggregateFields ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">AggregateFields ('Postgres pgKind)
</span><a href="#local-6989586621688398878"><span class="hs-identifier hs-var">aggregateFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, AggregateField ('Postgres pgKind))
  -&gt; [(Alias, SQLExp)])
 -&gt; [(Alias, SQLExp)])
-&gt; ((FieldName, AggregateField ('Postgres pgKind))
    -&gt; [(Alias, SQLExp)])
-&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398877"><span class="annot"><span class="annottext">AggregateField ('Postgres pgKind)
</span><a href="#local-6989586621688398877"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AggregateField ('Postgres pgKind)
</span><a href="#local-6989586621688398877"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1027"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFCount"><span class="hs-identifier hs-type">AFCount</span></a></span><span> </span><span id="local-6989586621688398876"><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
</span><a href="#local-6989586621688398876"><span class="hs-identifier hs-var">cty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
</span><a href="#local-6989586621688398876"><span class="hs-identifier hs-var">cty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1028"></span><span>        </span><span class="annot"><span class="annottext">CountType ('Postgres pgKind)
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#CTStar"><span class="hs-identifier hs-var">S.CTStar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>        </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#CTSimple"><span class="hs-identifier hs-type">S.CTSimple</span></a></span><span> </span><span id="local-6989586621688398874"><span class="annot"><a href="#local-6989586621688398874"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PGCol] -&gt; [(Alias, SQLExp)]
</span><a href="#local-6989586621688398873"><span class="hs-identifier hs-var">colsToExps</span></a></span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621688398874"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-1030"></span><span>        </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#CTDistinct"><span class="hs-identifier hs-type">S.CTDistinct</span></a></span><span> </span><span id="local-6989586621688398871"><span class="annot"><a href="#local-6989586621688398871"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PGCol] -&gt; [(Alias, SQLExp)]
</span><a href="#local-6989586621688398873"><span class="hs-identifier hs-var">colsToExps</span></a></span><span> </span><span class="annot"><span class="annottext">[PGCol]
</span><a href="#local-6989586621688398871"><span class="hs-identifier hs-var">cols</span></a></span><span>
</span><span id="line-1031"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFOp"><span class="hs-identifier hs-type">AFOp</span></a></span><span> </span><span id="local-6989586621688398870"><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind)
</span><a href="#local-6989586621688398870"><span class="hs-identifier hs-var">aggOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="#local-6989586621688398869"><span class="hs-identifier hs-var">aggOpToExps</span></a></span><span> </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind)
</span><a href="#local-6989586621688398870"><span class="hs-identifier hs-var">aggOp</span></a></span><span>
</span><span id="line-1032"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFExp"><span class="hs-identifier hs-type">AFExp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1034"></span><span>    </span><span id="local-6989586621688398873"><span class="annot"><span class="annottext">colsToExps :: [PGCol] -&gt; [(Alias, SQLExp)]
</span><a href="#local-6989586621688398873"><span class="hs-identifier hs-var hs-var">colsToExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; (Alias, SQLExp)) -&gt; [PGCol] -&gt; [(Alias, SQLExp)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398868"><span class="hs-identifier hs-var">mkColExp</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span>    </span><span id="local-6989586621688398869"><span class="annot"><span class="annottext">aggOpToExps :: AggregateOp ('Postgres pgKind) -&gt; [(Alias, SQLExp)]
</span><a href="#local-6989586621688398869"><span class="hs-identifier hs-var hs-var">aggOpToExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldName, ColFld ('Postgres pgKind)) -&gt; Maybe (Alias, SQLExp))
-&gt; [(FieldName, ColFld ('Postgres pgKind))] -&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, ColFld ('Postgres pgKind)) -&gt; Maybe (Alias, SQLExp)
</span><a href="#local-6989586621688398867"><span class="hs-identifier hs-var">colToMaybeExp</span></a></span><span> </span><span class="annot"><span class="annottext">([(FieldName, ColFld ('Postgres pgKind))] -&gt; [(Alias, SQLExp)])
-&gt; (AggregateOp ('Postgres pgKind)
    -&gt; [(FieldName, ColFld ('Postgres pgKind))])
-&gt; AggregateOp ('Postgres pgKind)
-&gt; [(Alias, SQLExp)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AggregateOp ('Postgres pgKind)
-&gt; [(FieldName, ColFld ('Postgres pgKind))]
forall (b :: BackendType). AggregateOp b -&gt; ColumnFields b
</span><a href="Hasura.RQL.IR.Select.html#_aoFields"><span class="hs-identifier hs-var hs-var">_aoFields</span></a></span><span>
</span><span id="line-1037"></span><span>    </span><span id="local-6989586621688398867"><span class="annot"><span class="annottext">colToMaybeExp :: (FieldName, ColFld ('Postgres pgKind)) -&gt; Maybe (Alias, SQLExp)
</span><a href="#local-6989586621688398867"><span class="hs-identifier hs-var hs-var">colToMaybeExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1038"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFCol"><span class="hs-identifier hs-type">CFCol</span></a></span><span> </span><span id="local-6989586621688398865"><span class="annot"><span class="annottext">Column ('Postgres pgKind)
</span><a href="#local-6989586621688398865"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Alias, SQLExp) -&gt; Maybe (Alias, SQLExp)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((Alias, SQLExp) -&gt; Maybe (Alias, SQLExp))
-&gt; (Alias, SQLExp) -&gt; Maybe (Alias, SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398868"><span class="hs-identifier hs-var">mkColExp</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688398865"><span class="hs-identifier hs-var">col</span></a></span><span>
</span><span id="line-1039"></span><span>      </span><span class="annot"><span class="annottext">(FieldName, ColFld ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Alias, SQLExp)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span>    </span><span id="local-6989586621688398868"><span class="annot"><span class="annottext">mkColExp :: PGCol -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398868"><span class="hs-identifier hs-var hs-var">mkColExp</span></a></span></span><span> </span><span id="local-6989586621688398864"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398864"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1042"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398863"><span class="annot"><span class="annottext">qualCol :: SQLExp
</span><a href="#local-6989586621688398863"><span class="hs-identifier hs-var hs-var">qualCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398879"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398864"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>          </span><span id="local-6989586621688398862"><span class="annot"><span class="annottext">colAls :: Identifier
</span><a href="#local-6989586621688398862"><span class="hs-identifier hs-var hs-var">colAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398864"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1044"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398862"><span class="hs-identifier hs-var">colAls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398863"><span class="hs-identifier hs-var">qualCol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span class="hs-comment">{- Note: [SQL generation for inherited roles]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When a query is executed by an inherited role, each column may contain a predicate
(AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp) along with it. The predicate is then
converted to a BoolExp, which will be used to check if the said column should
be nullified. For example,

Suppose there are two roles, role1 gives access only to the `addr` column with
row filter P1 and role2 gives access to both addr and phone column with row
filter P2. The `OR`ing of the predicates will have already been done while
the schema has been generated. The SQL generated will look like this:

 select
    (case when (P1 or P2) then addr else null end) as addr,
    (case when P2 then phone else null end) as phone
 from employee
 where (P1 or P2)

-}</span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="hs-keyword">class</span><span> </span><span id="PostgresAnnotatedFieldJSON"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-var">PostgresAnnotatedFieldJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688399608"><span class="annot"><a href="#local-6989586621688399608"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.SQL.Backend.html#PostgresKind"><span class="hs-identifier hs-type">PostgresKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1067"></span><span>  </span><span id="annRowToJson"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#annRowToJson"><span class="hs-identifier hs-type">annRowToJson</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1070"></span><span>  </span><span id="local-6989586621688398858"><span class="annot"><span class="annottext">annRowToJson :: FieldName -&gt; [(FieldName, SQLExp)] -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398858"><span class="hs-identifier hs-var hs-var hs-var hs-var">annRowToJson</span></a></span></span><span> </span><span id="local-6989586621688398857"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398857"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688398856"><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398856"><span class="hs-identifier hs-var">fieldExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1071"></span><span>    </span><span class="hs-comment">-- postgres ignores anything beyond 63 chars for an iden</span><span>
</span><span id="line-1072"></span><span>    </span><span class="hs-comment">-- in this case, we'll need to use json_build_object function</span><span>
</span><span id="line-1073"></span><span>    </span><span class="hs-comment">-- json_build_object is slower than row_to_json hence it is only</span><span>
</span><span id="line-1074"></span><span>    </span><span class="hs-comment">-- used when needed</span><span>
</span><span id="line-1075"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">((FieldName, SQLExp) -&gt; Bool) -&gt; [(FieldName, SQLExp)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">63</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; ((FieldName, SQLExp) -&gt; Int) -&gt; (FieldName, SQLExp) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int
</span><span class="hs-identifier hs-var">T.length</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Int)
-&gt; ((FieldName, SQLExp) -&gt; Text) -&gt; (FieldName, SQLExp) -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldName -&gt; Text)
-&gt; ((FieldName, SQLExp) -&gt; FieldName)
-&gt; (FieldName, SQLExp)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, SQLExp) -&gt; FieldName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398856"><span class="hs-identifier hs-var">fieldExps</span></a></span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; [SQLExp] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonBuildObj"><span class="hs-identifier hs-var">withJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398857"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; (Alias, SQLExp)) -&gt; [SQLExp] -&gt; (Alias, SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, SQLExp) -&gt; [SQLExp])
-&gt; [(FieldName, SQLExp)] -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, SQLExp) -&gt; [SQLExp]
</span><a href="#local-6989586621688398853"><span class="hs-identifier hs-var">toJsonBuildObjectExps</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398856"><span class="hs-identifier hs-var">fieldExps</span></a></span><span>
</span><span id="line-1077"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; [Extractor] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withRowToJSON"><span class="hs-identifier hs-var">withRowToJSON</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398857"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">([Extractor] -&gt; (Alias, SQLExp)) -&gt; [Extractor] -&gt; (Alias, SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, SQLExp) -&gt; Extractor)
-&gt; [(FieldName, SQLExp)] -&gt; [Extractor]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, SQLExp) -&gt; Extractor
forall a. IsIdentifier a =&gt; (a, SQLExp) -&gt; Extractor
</span><a href="#local-6989586621688398852"><span class="hs-identifier hs-var">toRowToJsonExtr</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398856"><span class="hs-identifier hs-var">fieldExps</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1079"></span><span>      </span><span id="local-6989586621688398853"><span class="annot"><span class="annottext">toJsonBuildObjectExps :: (FieldName, SQLExp) -&gt; [SQLExp]
</span><a href="#local-6989586621688398853"><span class="hs-identifier hs-var hs-var">toJsonBuildObjectExps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398851"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398851"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398850"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398850"><span class="hs-identifier hs-var">fieldExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1080"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398851"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398850"><span class="hs-identifier hs-var">fieldExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span>      </span><span id="local-6989586621688398852"><span class="annot"><span class="annottext">toRowToJsonExtr :: (a, SQLExp) -&gt; Extractor
</span><a href="#local-6989586621688398852"><span class="hs-identifier hs-var hs-var">toRowToJsonExtr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398849"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688398849"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398848"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398848"><span class="hs-identifier hs-var">fieldExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1083"></span><span>        </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398848"><span class="hs-identifier hs-var">fieldExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Alias
forall a. IsIdentifier a =&gt; a -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#toAlias"><span class="hs-identifier hs-var">S.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688398849"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Citus"><span class="hs-identifier hs-type">Citus</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1086"></span><span>  </span><span id="local-6989586621688398846"><span class="annot"><span class="annottext">annRowToJson :: FieldName -&gt; [(FieldName, SQLExp)] -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398846"><span class="hs-identifier hs-var hs-var hs-var hs-var">annRowToJson</span></a></span></span><span> </span><span id="local-6989586621688398845"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398845"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688398844"><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398844"><span class="hs-identifier hs-var">fieldExps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1087"></span><span>    </span><span class="hs-comment">-- Due to the restrictions Citus imposes on joins between tables of various</span><span>
</span><span id="line-1088"></span><span>    </span><span class="hs-comment">-- distribution types we cannot use row_to_json and have to only rely on</span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-comment">-- json_build_object.</span><span>
</span><span id="line-1090"></span><span>    </span><span class="annot"><span class="annottext">FieldName -&gt; [SQLExp] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withJsonBuildObj"><span class="hs-identifier hs-var">withJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398845"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; (Alias, SQLExp)) -&gt; [SQLExp] -&gt; (Alias, SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, SQLExp) -&gt; [SQLExp])
-&gt; [(FieldName, SQLExp)] -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, SQLExp) -&gt; [SQLExp]
</span><a href="#local-6989586621688398843"><span class="hs-identifier hs-var">toJsonBuildObjectExps</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398844"><span class="hs-identifier hs-var">fieldExps</span></a></span><span>
</span><span id="line-1091"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1092"></span><span>      </span><span id="local-6989586621688398843"><span class="annot"><span class="annottext">toJsonBuildObjectExps :: (FieldName, SQLExp) -&gt; [SQLExp]
</span><a href="#local-6989586621688398843"><span class="hs-identifier hs-var hs-var">toJsonBuildObjectExps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398842"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398842"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398841"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398841"><span class="hs-identifier hs-var">fieldExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398842"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398841"><span class="hs-identifier hs-var">fieldExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-type">processAnnFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1096"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399714"><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399715"><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1097"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1098"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1099"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1102"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1103"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1104"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#SimilarArrayFields"><span class="hs-identifier hs-type">SimilarArrayFields</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1105"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnFields"><span class="hs-identifier hs-type">AnnFields</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1106"></span><span>  </span><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span id="processAnnFields"><span class="annot"><span class="annottext">processAnnFields :: Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-var hs-var">processAnnFields</span></a></span></span><span> </span><span id="local-6989586621688398840"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688398839"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398839"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688398838"><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398838"><span class="hs-identifier hs-var">similarArrFields</span></a></span></span><span> </span><span id="local-6989586621688398837"><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
</span><a href="#local-6989586621688398837"><span class="hs-identifier hs-var">annFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1108"></span><span>  </span><span id="local-6989586621688398836"><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398836"><span class="hs-identifier hs-var">fieldExps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
-&gt; ((FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)
    -&gt; m (FieldName, SQLExp))
-&gt; m [(FieldName, SQLExp)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688398837"><span class="hs-identifier hs-var">annFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)
  -&gt; m (FieldName, SQLExp))
 -&gt; m [(FieldName, SQLExp)])
-&gt; ((FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)
    -&gt; m (FieldName, SQLExp))
-&gt; m [(FieldName, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688398835"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398834"><span class="annot"><span class="annottext">AnnFieldG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398834"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1109"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>      </span><span class="annot"><span class="annottext">(SQLExp -&gt; (FieldName, SQLExp))
-&gt; m SQLExp -&gt; m (FieldName, SQLExp)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AnnFieldG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398834"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1111"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFExpression"><span class="hs-identifier hs-type">AFExpression</span></a></span><span> </span><span id="local-6989586621688398832"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398832"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398832"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1112"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFNodeId"><span class="hs-identifier hs-type">AFNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">XRelay ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398830"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688398830"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621688398829"><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398829"><span class="hs-identifier hs-var">pKeys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; PrimaryKeyColumns ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688398828"><span class="hs-identifier hs-var">mkNodeId</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398830"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398829"><span class="hs-identifier hs-var">pKeys</span></a></span><span>
</span><span id="line-1113"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFColumn"><span class="hs-identifier hs-type">AFColumn</span></a></span><span> </span><span id="local-6989586621688398826"><span class="annot"><span class="annottext">AnnColumnField ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398826"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AnnColumnField ('Postgres pgKind) SQLExp -&gt; m SQLExp
</span><a href="#local-6989586621688398825"><span class="hs-identifier hs-var">toSQLCol</span></a></span><span> </span><span class="annot"><span class="annottext">AnnColumnField ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398826"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1114"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFObjectRelation"><span class="hs-identifier hs-type">AFObjectRelation</span></a></span><span> </span><span id="local-6989586621688398823"><span class="annot"><span class="annottext">ObjectRelationSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398823"><span class="hs-identifier hs-var">objSel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp) -&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ObjectRelationSource, HashMap Alias SQLExp, a) -&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteObjectRelation"><span class="hs-identifier hs-var">withWriteObjectRelation</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
 -&gt; m SQLExp)
-&gt; m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1115"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnRelationSelectG"><span class="hs-identifier hs-type">AnnRelationSelectG</span></a></span><span> </span><span id="local-6989586621688398822"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398822"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span id="local-6989586621688398821"><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
</span><a href="#local-6989586621688398821"><span class="hs-identifier hs-var">relMapping</span></a></span></span><span> </span><span id="local-6989586621688398820"><span class="annot"><span class="annottext">AnnObjectSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398820"><span class="hs-identifier hs-var">annObjSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398823"><span class="hs-identifier hs-var">objSel</span></a></span><span>
</span><span id="line-1116"></span><span>              </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnObjectSelectG"><span class="hs-identifier hs-type">AnnObjectSelectG</span></a></span><span> </span><span id="local-6989586621688398818"><span class="annot"><span class="annottext">[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688398818"><span class="hs-identifier hs-var">objAnnFields</span></a></span></span><span> </span><span id="local-6989586621688398817"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621688398817"><span class="hs-identifier hs-var">tableFrom</span></a></span></span><span> </span><span id="local-6989586621688398816"><span class="annot"><span class="annottext">AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398816"><span class="hs-identifier hs-var">tableFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnObjectSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398820"><span class="hs-identifier hs-var">annObjSel</span></a></span><span>
</span><span id="line-1117"></span><span>              </span><span id="local-6989586621688398815"><span class="annot"><span class="annottext">objRelSourcePrefix :: Identifier
</span><a href="#local-6989586621688398815"><span class="hs-identifier hs-var hs-var">objRelSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; RelName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkObjectRelationTableAlias"><span class="hs-identifier hs-var">mkObjectRelationTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398822"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-1118"></span><span>              </span><span id="local-6989586621688398814"><span class="annot"><span class="annottext">sourcePrefixes :: SourcePrefixes
</span><a href="#local-6989586621688398814"><span class="hs-identifier hs-var hs-var">sourcePrefixes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SourcePrefixes
</span><a href="#local-6989586621688398813"><span class="hs-identifier hs-var">mkSourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398815"><span class="hs-identifier hs-var">objRelSourcePrefix</span></a></span><span>
</span><span id="line-1119"></span><span>          </span><span id="local-6989586621688398812"><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688398812"><span class="hs-identifier hs-var">annFieldsExtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-var">processAnnFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398814"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
[(FieldName, AnnFieldG ('Postgres pgKind) Void SQLExp)]
</span><a href="#local-6989586621688398818"><span class="hs-identifier hs-var">objAnnFields</span></a></span><span>
</span><span id="line-1120"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398810"><span class="annot"><span class="annottext">selectSource :: ObjectSelectSource
</span><a href="#local-6989586621688398810"><span class="hs-identifier hs-var hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1121"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; FromItem -&gt; BoolExp -&gt; ObjectSelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectSelectSource"><span class="hs-identifier hs-var">ObjectSelectSource</span></a></span><span>
</span><span id="line-1122"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398814"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Maybe Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISimple"><span class="hs-identifier hs-var">S.FISimple</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398817"><span class="hs-identifier hs-var">tableFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621688398817"><span class="hs-identifier hs-var">tableFrom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398816"><span class="hs-identifier hs-var">tableFilter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>              </span><span id="local-6989586621688398809"><span class="annot"><span class="annottext">objRelSource :: ObjectRelationSource
</span><a href="#local-6989586621688398809"><span class="hs-identifier hs-var hs-var">objRelSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RelName
-&gt; HashMap PGCol PGCol
-&gt; ObjectSelectSource
-&gt; ObjectRelationSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-var">ObjectRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688398822"><span class="hs-identifier hs-var">relName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Column ('Postgres pgKind)) (Column ('Postgres pgKind))
HashMap PGCol PGCol
</span><a href="#local-6989586621688398821"><span class="hs-identifier hs-var">relMapping</span></a></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621688398810"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1126"></span><span>          </span><span class="annot"><span class="annottext">(ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
-&gt; m (ObjectRelationSource, HashMap Alias SQLExp, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1127"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688398809"><span class="hs-identifier hs-var">objRelSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1128"></span><span>              </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688398812"><span class="hs-identifier hs-var">annFieldsExtr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1129"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398815"><span class="hs-identifier hs-var">objRelSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1130"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFArrayRelation"><span class="hs-identifier hs-type">AFArrayRelation</span></a></span><span> </span><span id="local-6989586621688398808"><span class="annot"><span class="annottext">ArraySelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398808"><span class="hs-identifier hs-var">arrSel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398807"><span class="annot"><span class="annottext">arrRelSourcePrefix :: Identifier
</span><a href="#local-6989586621688398807"><span class="hs-identifier hs-var hs-var">arrRelSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; FieldName
-&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationSourcePrefix"><span class="hs-identifier hs-var">mkArrayRelationSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398839"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398838"><span class="hs-identifier hs-var">similarArrFields</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1133"></span><span>              </span><span id="local-6989586621688398806"><span class="annot"><span class="annottext">arrRelAlias :: Alias
</span><a href="#local-6989586621688398806"><span class="hs-identifier hs-var hs-var">arrRelAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; HashMap FieldName [FieldName] -&gt; FieldName -&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkArrayRelationAlias"><span class="hs-identifier hs-var">mkArrayRelationAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398839"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398838"><span class="hs-identifier hs-var">similarArrFields</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1134"></span><span>          </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName -&gt; Alias -&gt; ArraySelect ('Postgres pgKind) -&gt; m ()
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName -&gt; Alias -&gt; ArraySelect ('Postgres pgKind) -&gt; m ()
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processArrayRelation"><span class="hs-identifier hs-var">processArrayRelation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SourcePrefixes
</span><a href="#local-6989586621688398813"><span class="hs-identifier hs-var">mkSourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398807"><span class="hs-identifier hs-var">arrRelSourcePrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398806"><span class="hs-identifier hs-var">arrRelAlias</span></a></span><span> </span><span class="annot"><span class="annottext">ArraySelect ('Postgres pgKind)
ArraySelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398808"><span class="hs-identifier hs-var">arrSel</span></a></span><span>
</span><span id="line-1135"></span><span>          </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398807"><span class="hs-identifier hs-var">arrRelSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1136"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFComputedField"><span class="hs-identifier hs-type">AFComputedField</span></a></span><span> </span><span class="annot"><span class="annottext">XComputedField ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFSScalar"><span class="hs-identifier hs-type">CFSScalar</span></a></span><span> </span><span id="local-6989586621688398803"><span class="annot"><span class="annottext">ComputedFieldScalarSelect ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398803"><span class="hs-identifier hs-var">scalar</span></a></span></span><span> </span><span id="local-6989586621688398802"><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398802"><span class="hs-identifier hs-var">caseBoolExpMaybe</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1137"></span><span>          </span><span id="local-6989586621688398801"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398801"><span class="hs-identifier hs-var">computedFieldSQLExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ComputedFieldScalarSelect ('Postgres pgKind) SQLExp -&gt; m SQLExp
</span><a href="#local-6989586621688398800"><span class="hs-identifier hs-var">fromScalarComputedField</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldScalarSelect ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398803"><span class="hs-identifier hs-var">scalar</span></a></span><span>
</span><span id="line-1138"></span><span>          </span><span class="hs-comment">-- The computed field is conditionally outputed depending</span><span>
</span><span id="line-1139"></span><span>          </span><span class="hs-comment">-- on the presence of `caseBoolExpMaybe` and the value it</span><span>
</span><span id="line-1140"></span><span>          </span><span class="hs-comment">-- evaluates to. `caseBoolExpMaybe` will be set only in the</span><span>
</span><span id="line-1141"></span><span>          </span><span class="hs-comment">-- case of an inherited role.</span><span>
</span><span id="line-1142"></span><span>          </span><span class="hs-comment">-- See [SQL generation for inherited role]</span><span>
</span><span id="line-1143"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398802"><span class="hs-identifier hs-var">caseBoolExpMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1144"></span><span>            </span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398801"><span class="hs-identifier hs-var">computedFieldSQLExp</span></a></span><span>
</span><span id="line-1145"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688398799"><span class="annot"><span class="annottext">AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398799"><span class="hs-identifier hs-var">caseBoolExp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1146"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398798"><span class="annot"><span class="annottext">boolExp :: BoolExp
</span><a href="#local-6989586621688398798"><span class="hs-identifier hs-var hs-var">boolExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1147"></span><span>                    </span><span class="annot"><span class="annottext">BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#simplifyBoolExp"><span class="hs-identifier hs-var">S.simplifyBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1148"></span><span>                      </span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398796"><span class="hs-identifier hs-var">baseTableIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp)
-&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1149"></span><span>                        </span><span class="annot"><span class="annottext">AnnColumnCaseBoolExpField ('Postgres pgKind) SQLExp
-&gt; AnnBoolExpFld ('Postgres pgKind) SQLExp
forall (b :: BackendType) a.
AnnColumnCaseBoolExpField b a -&gt; AnnBoolExpFld b a
</span><a href="Hasura.RQL.IR.BoolExp.html#_accColCaseBoolExpField"><span class="hs-identifier hs-var hs-var">_accColCaseBoolExpField</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnColumnCaseBoolExpField ('Postgres pgKind) SQLExp
 -&gt; AnnBoolExpFld ('Postgres pgKind) SQLExp)
-&gt; AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
-&gt; AnnBoolExp ('Postgres pgKind) SQLExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398799"><span class="hs-identifier hs-var">caseBoolExp</span></a></span><span>
</span><span id="line-1150"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SECond"><span class="hs-identifier hs-var">S.SECond</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398798"><span class="hs-identifier hs-var">boolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398801"><span class="hs-identifier hs-var">computedFieldSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SENull"><span class="hs-identifier hs-var">S.SENull</span></a></span><span>
</span><span id="line-1151"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AFComputedField"><span class="hs-identifier hs-type">AFComputedField</span></a></span><span> </span><span class="annot"><span class="annottext">XComputedField ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#CFSTable"><span class="hs-identifier hs-type">CFSTable</span></a></span><span> </span><span id="local-6989586621688398791"><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688398791"><span class="hs-identifier hs-var">selectTy</span></a></span></span><span> </span><span id="local-6989586621688398790"><span class="annot"><span class="annottext">AnnSimpleSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398790"><span class="hs-identifier hs-var">sel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
   SQLExp)
-&gt; m SQLExp
forall (m :: * -&gt; *) a.
MonadWriter JoinTree m =&gt;
m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp, a)
-&gt; m a
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withWriteComputedFieldTableSet"><span class="hs-identifier hs-var">withWriteComputedFieldTableSet</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
    SQLExp)
 -&gt; m SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
      SQLExp)
-&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398789"><span class="annot"><span class="annottext">computedFieldSourcePrefix :: Identifier
</span><a href="#local-6989586621688398789"><span class="hs-identifier hs-var hs-var">computedFieldSourcePrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1153"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkComputedFieldTableAlias"><span class="hs-identifier hs-var">mkComputedFieldTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1154"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621688398788"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398788"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398787"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398787"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1155"></span><span>            </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnSimpleSelect"><span class="hs-identifier hs-var">processAnnSimpleSelect</span></a></span><span>
</span><span id="line-1156"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SourcePrefixes
</span><a href="#local-6989586621688398813"><span class="hs-identifier hs-var">mkSourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398789"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>              </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1158"></span><span>              </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span>
</span><span id="line-1159"></span><span>              </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
AnnSimpleSelectG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398790"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1160"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398786"><span class="annot"><span class="annottext">computedFieldTableSetSource :: ComputedFieldTableSetSource
</span><a href="#local-6989586621688398786"><span class="hs-identifier hs-var hs-var">computedFieldTableSetSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; SelectSource -&gt; ComputedFieldTableSetSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-var">ComputedFieldTableSetSource</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398788"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1161"></span><span>              </span><span id="local-6989586621688398785"><span class="annot"><span class="annottext">extractor :: Extractor
</span><a href="#local-6989586621688398785"><span class="hs-identifier hs-var hs-var">extractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1162"></span><span>                </span><span class="annot"><span class="annottext">JsonAggSelect
-&gt; Alias
-&gt; PermissionLimitSubQuery
-&gt; Maybe OrderByExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asJsonAggExtr"><span class="hs-identifier hs-var">asJsonAggExtr</span></a></span><span> </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688398791"><span class="hs-identifier hs-var">selectTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldName -&gt; Alias
forall a. IsIdentifier a =&gt; a -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#toAlias"><span class="hs-identifier hs-var">S.toAlias</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe OrderByExp -&gt; Extractor) -&gt; Maybe OrderByExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1163"></span><span>                  </span><span class="annot"><span class="annottext">SelectSource -&gt; Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#orderByForJsonAgg"><span class="hs-identifier hs-var">orderByForJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398788"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1164"></span><span>          </span><span class="annot"><span class="annottext">(ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
 SQLExp)
-&gt; m (ComputedFieldTableSetSource, Extractor, HashMap Alias SQLExp,
      SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1165"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688398786"><span class="hs-identifier hs-var">computedFieldTableSetSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1166"></span><span>              </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398785"><span class="hs-identifier hs-var">extractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1167"></span><span>              </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398787"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1168"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; FieldName -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398789"><span class="hs-identifier hs-var">computedFieldSourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398835"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1169"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span>  </span><span class="annot"><span class="annottext">(Alias, SQLExp) -&gt; m (Alias, SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Alias, SQLExp) -&gt; m (Alias, SQLExp))
-&gt; (Alias, SQLExp) -&gt; m (Alias, SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; [(FieldName, SQLExp)] -&gt; (Alias, SQLExp)
forall (pgKind :: PostgresKind).
PostgresAnnotatedFieldJSON pgKind =&gt;
FieldName -&gt; [(FieldName, SQLExp)] -&gt; (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#annRowToJson"><span class="hs-identifier hs-var">annRowToJson</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398839"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldName, SQLExp)]
</span><a href="#local-6989586621688398836"><span class="hs-identifier hs-var">fieldExps</span></a></span><span>
</span><span id="line-1172"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1173"></span><span>    </span><span id="local-6989586621688398813"><span class="annot"><span class="annottext">mkSourcePrefixes :: Identifier -&gt; SourcePrefixes
</span><a href="#local-6989586621688398813"><span class="hs-identifier hs-var hs-var">mkSourcePrefixes</span></a></span></span><span> </span><span id="local-6989586621688398784"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398784"><span class="hs-identifier hs-var">newPrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SourcePrefixes
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-var">SourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398784"><span class="hs-identifier hs-var">newPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span>    </span><span id="local-6989586621688398796"><span class="annot"><span class="annottext">baseTableIdentifier :: Identifier
</span><a href="#local-6989586621688398796"><span class="hs-identifier hs-var hs-var">baseTableIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span>    </span><span class="annot"><a href="#local-6989586621688398825"><span class="hs-identifier hs-type">toSQLCol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnColumnField"><span class="hs-identifier hs-type">AnnColumnField</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1178"></span><span>    </span><span id="local-6989586621688398825"><span class="annot"><span class="annottext">toSQLCol :: AnnColumnField ('Postgres pgKind) SQLExp -&gt; m SQLExp
</span><a href="#local-6989586621688398825"><span class="hs-identifier hs-var hs-var">toSQLCol</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnColumnField"><span class="hs-identifier hs-type">AnnColumnField</span></a></span><span> </span><span id="local-6989586621688398781"><span class="annot"><span class="annottext">Column ('Postgres pgKind)
</span><a href="#local-6989586621688398781"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span id="local-6989586621688398780"><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688398780"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621688398779"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621688398779"><span class="hs-identifier hs-var">asText</span></a></span></span><span> </span><span id="local-6989586621688398778"><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398778"><span class="hs-identifier hs-var">colOpM</span></a></span></span><span> </span><span id="local-6989586621688398777"><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398777"><span class="hs-identifier hs-var">caseBoolExpMaybe</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1179"></span><span>      </span><span id="local-6989586621688398776"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398776"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m StringifyNumbers
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1180"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398774"><span class="annot"><span class="annottext">sqlExpression :: SQLExp
</span><a href="#local-6989586621688398774"><span class="hs-identifier hs-var hs-var">sqlExpression</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1181"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind)) -&gt; SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398773"><span class="hs-identifier hs-var">withColumnOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398778"><span class="hs-identifier hs-var">colOpM</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1182"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398796"><span class="hs-identifier hs-var">baseTableIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688398781"><span class="hs-identifier hs-var">col</span></a></span><span>
</span><span id="line-1183"></span><span>          </span><span id="local-6989586621688398772"><span class="annot"><span class="annottext">finalSQLExpression :: SQLExp
</span><a href="#local-6989586621688398772"><span class="hs-identifier hs-var hs-var">finalSQLExpression</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1184"></span><span>            </span><span class="hs-comment">-- Check out [SQL generation for inherited role]</span><span>
</span><span id="line-1185"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398777"><span class="hs-identifier hs-var">caseBoolExpMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1186"></span><span>              </span><span class="annot"><span class="annottext">Maybe (AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398774"><span class="hs-identifier hs-var">sqlExpression</span></a></span><span>
</span><span id="line-1187"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688398771"><span class="annot"><span class="annottext">AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398771"><span class="hs-identifier hs-var">caseBoolExp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1188"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398770"><span class="annot"><span class="annottext">boolExp :: BoolExp
</span><a href="#local-6989586621688398770"><span class="hs-identifier hs-var hs-var">boolExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1189"></span><span>                      </span><span class="annot"><span class="annottext">BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#simplifyBoolExp"><span class="hs-identifier hs-var">S.simplifyBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1190"></span><span>                        </span><span class="annot"><span class="annottext">Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall (pgKind :: PostgresKind).
Backend ('Postgres pgKind) =&gt;
Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Maybe TypeAnn -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualifiedIdentifier"><span class="hs-identifier hs-var">S.QualifiedIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398796"><span class="hs-identifier hs-var">baseTableIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypeAnn
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp)
-&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1191"></span><span>                          </span><span class="annot"><span class="annottext">AnnColumnCaseBoolExpField ('Postgres pgKind) SQLExp
-&gt; AnnBoolExpFld ('Postgres pgKind) SQLExp
forall (b :: BackendType) a.
AnnColumnCaseBoolExpField b a -&gt; AnnBoolExpFld b a
</span><a href="Hasura.RQL.IR.BoolExp.html#_accColCaseBoolExpField"><span class="hs-identifier hs-var hs-var">_accColCaseBoolExpField</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnColumnCaseBoolExpField ('Postgres pgKind) SQLExp
 -&gt; AnnBoolExpFld ('Postgres pgKind) SQLExp)
-&gt; AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
-&gt; AnnBoolExp ('Postgres pgKind) SQLExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AnnColumnCaseBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398771"><span class="hs-identifier hs-var">caseBoolExp</span></a></span><span>
</span><span id="line-1192"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SECond"><span class="hs-identifier hs-var">S.SECond</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398770"><span class="hs-identifier hs-var">boolExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398774"><span class="hs-identifier hs-var">sqlExpression</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SENull"><span class="hs-identifier hs-var">S.SENull</span></a></span><span>
</span><span id="line-1193"></span><span>      </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
forall (pgKind :: PostgresKind).
StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier hs-var">toJSONableExp</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398776"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnType ('Postgres pgKind)
</span><a href="#local-6989586621688398780"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621688398779"><span class="hs-identifier hs-var">asText</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398772"><span class="hs-identifier hs-var">finalSQLExpression</span></a></span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span>    </span><span class="annot"><a href="#local-6989586621688398800"><span class="hs-identifier hs-type">fromScalarComputedField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ComputedFieldScalarSelect"><span class="hs-identifier hs-type">ComputedFieldScalarSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688399715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1196"></span><span>    </span><span id="local-6989586621688398800"><span class="annot"><span class="annottext">fromScalarComputedField :: ComputedFieldScalarSelect ('Postgres pgKind) SQLExp -&gt; m SQLExp
</span><a href="#local-6989586621688398800"><span class="hs-identifier hs-var hs-var">fromScalarComputedField</span></a></span></span><span> </span><span id="local-6989586621688398769"><span class="annot"><span class="annottext">ComputedFieldScalarSelect ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398769"><span class="hs-identifier hs-var">computedFieldScalar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1197"></span><span>      </span><span id="local-6989586621688398768"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398768"><span class="hs-identifier hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m StringifyNumbers
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1198"></span><span>      </span><span class="annot"><span class="annottext">SQLExp -&gt; m SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; m SQLExp) -&gt; SQLExp -&gt; m SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1199"></span><span>        </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; ColumnType ('Postgres Any) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
forall (pgKind :: PostgresKind).
StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier hs-var">toJSONableExp</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398768"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScalarType ('Postgres Any) -&gt; ColumnType ('Postgres Any)
forall (b :: BackendType). ScalarType b -&gt; ColumnType b
</span><a href="Hasura.RQL.Types.Column.html#ColumnScalar"><span class="hs-identifier hs-var">ColumnScalar</span></a></span><span> </span><span class="annot"><span class="annottext">ScalarType ('Postgres pgKind)
ScalarType ('Postgres Any)
</span><a href="#local-6989586621688398766"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1200"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind)) -&gt; SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398773"><span class="hs-identifier hs-var">withColumnOp</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398765"><span class="hs-identifier hs-var">colOpM</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1201"></span><span>            </span><span class="annot"><span class="annottext">FunctionExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFunction"><span class="hs-identifier hs-var">S.SEFunction</span></a></span><span> </span><span class="annot"><span class="annottext">(FunctionExp -&gt; SQLExp) -&gt; FunctionExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedFunction
-&gt; FunctionArgs -&gt; Maybe FunctionAlias -&gt; FunctionExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FunctionExp"><span class="hs-identifier hs-var">S.FunctionExp</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
QualifiedFunction
</span><a href="#local-6989586621688398764"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; FunctionArgsExpTableRow SQLExp -&gt; FunctionArgs
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#fromTableRowArgs"><span class="hs-identifier hs-var">fromTableRowArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionArgsExpTableRow SQLExp
</span><a href="#local-6989586621688398763"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FunctionAlias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1202"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1203"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ComputedFieldScalarSelect"><span class="hs-identifier hs-type">ComputedFieldScalarSelect</span></a></span><span> </span><span id="local-6989586621688398764"><span class="annot"><span class="annottext">FunctionName ('Postgres pgKind)
</span><a href="#local-6989586621688398764"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621688398763"><span class="annot"><span class="annottext">FunctionArgsExpTableRow SQLExp
</span><a href="#local-6989586621688398763"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621688398766"><span class="annot"><span class="annottext">ScalarType ('Postgres pgKind)
</span><a href="#local-6989586621688398766"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621688398765"><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398765"><span class="hs-identifier hs-var">colOpM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldScalarSelect ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398769"><span class="hs-identifier hs-var">computedFieldScalar</span></a></span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span>    </span><span class="annot"><a href="#local-6989586621688398773"><span class="hs-identifier hs-type">withColumnOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ColumnOp"><span class="hs-identifier hs-type">ColumnOp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1206"></span><span>    </span><span id="local-6989586621688398773"><span class="annot"><span class="annottext">withColumnOp :: Maybe (ColumnOp ('Postgres pgKind)) -&gt; SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398773"><span class="hs-identifier hs-var hs-var">withColumnOp</span></a></span></span><span> </span><span id="local-6989586621688398761"><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398761"><span class="hs-identifier hs-var">colOpM</span></a></span></span><span> </span><span id="local-6989586621688398760"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398760"><span class="hs-identifier hs-var">sqlExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><a href="#local-6989586621688398761"><span class="hs-identifier hs-var">colOpM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1207"></span><span>      </span><span class="annot"><span class="annottext">Maybe (ColumnOp ('Postgres pgKind))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398760"><span class="hs-identifier hs-var">sqlExp</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ColumnOp"><span class="hs-identifier hs-type">ColumnOp</span></a></span><span> </span><span id="local-6989586621688398758"><span class="annot"><span class="annottext">SQLOperator ('Postgres pgKind)
</span><a href="#local-6989586621688398758"><span class="hs-identifier hs-var">opText</span></a></span></span><span> </span><span id="local-6989586621688398757"><span class="annot"><span class="annottext">SQLExpression ('Postgres pgKind)
</span><a href="#local-6989586621688398757"><span class="hs-identifier hs-var">cExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLOp -&gt; SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSQLOpExp"><span class="hs-identifier hs-var">S.mkSQLOpExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLOperator ('Postgres pgKind)
SQLOp
</span><a href="#local-6989586621688398758"><span class="hs-identifier hs-var">opText</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398760"><span class="hs-identifier hs-var">sqlExp</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExpression ('Postgres pgKind)
SQLExp
</span><a href="#local-6989586621688398757"><span class="hs-identifier hs-var">cExp</span></a></span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>    </span><span class="annot"><a href="#local-6989586621688398828"><span class="hs-identifier hs-type">mkNodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Column.html#PrimaryKeyColumns"><span class="hs-identifier hs-type">PrimaryKeyColumns</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399714"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1211"></span><span>    </span><span id="local-6989586621688398828"><span class="annot"><span class="annottext">mkNodeId :: QualifiedTable -&gt; PrimaryKeyColumns ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688398828"><span class="hs-identifier hs-var hs-var">mkNodeId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedObject"><span class="hs-identifier hs-type">QualifiedObject</span></a></span><span> </span><span id="local-6989586621688398754"><span class="annot"><span class="annottext">SchemaName
</span><a href="#local-6989586621688398754"><span class="hs-identifier hs-var">tableSchema</span></a></span></span><span> </span><span id="local-6989586621688398753"><span class="annot"><span class="annottext">TableName
</span><a href="#local-6989586621688398753"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621688398752"><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398752"><span class="hs-identifier hs-var">pkeyColumns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1212"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398751"><span class="annot"><span class="annottext">columnInfoToSQLExp :: ColumnInfo ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688398751"><span class="hs-identifier hs-var hs-var">columnInfoToSQLExp</span></a></span></span><span> </span><span id="local-6989586621688398750"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398750"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1213"></span><span>            </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
forall (pgKind :: PostgresKind).
StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier hs-var">toJSONableExp</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.RQL.Types.Common.html#LeaveNumbersAlone"><span class="hs-identifier hs-var">LeaveNumbersAlone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; ColumnType ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; ColumnType b
</span><a href="Hasura.RQL.Types.Column.html#ciType"><span class="hs-identifier hs-var hs-var">ciType</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398750"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1214"></span><span>              </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398840"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; PGCol -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398750"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-1215"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- See Note [Relay Node id].</span><span>
</span><span id="line-1216"></span><span>          </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-var">encodeBase64</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1217"></span><span>            </span><span class="annot"><span class="annottext">(SQLExp -&gt; TypeAnn -&gt; SQLExp) -&gt; TypeAnn -&gt; SQLExp -&gt; SQLExp
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; TypeAnn -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SETyAnn"><span class="hs-identifier hs-var">S.SETyAnn</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1218"></span><span>              </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildArray"><span class="hs-identifier hs-var">S.applyJsonBuildArray</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1219"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SQLExp) -&gt; Int -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NodeIdVersion -&gt; Int
</span><a href="Hasura.GraphQL.Schema.Common.html#nodeIdVersionInt"><span class="hs-identifier hs-var">nodeIdVersionInt</span></a></span><span> </span><span class="annot"><span class="annottext">NodeIdVersion
</span><a href="Hasura.GraphQL.Schema.Common.html#currentNodeIdVersion"><span class="hs-identifier hs-var">currentNodeIdVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1220"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaName -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getSchemaTxt"><span class="hs-identifier hs-var hs-var">getSchemaTxt</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaName
</span><a href="#local-6989586621688398754"><span class="hs-identifier hs-var">tableSchema</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1221"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName -&gt; Text
forall a. ToTxt a =&gt; a -&gt; Text
</span><a href="Data.Text.Extended.html#toTxt"><span class="hs-identifier hs-var">toTxt</span></a></span><span> </span><span class="annot"><span class="annottext">TableName
</span><a href="#local-6989586621688398753"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1223"></span><span>                  </span><span class="annot"><span class="annottext">[SQLExp] -&gt; [SQLExp] -&gt; [SQLExp]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo ('Postgres pgKind) -&gt; SQLExp)
-&gt; [ColumnInfo ('Postgres pgKind)] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; SQLExp
</span><a href="#local-6989586621688398751"><span class="hs-identifier hs-var">columnInfoToSQLExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398752"><span class="hs-identifier hs-var">pkeyColumns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#injectJoinCond"><span class="hs-identifier hs-type">injectJoinCond</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-comment">-- | Join condition</span><span>
</span><span id="line-1227"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1228"></span><span>  </span><span class="hs-comment">-- | Where condition</span><span>
</span><span id="line-1229"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1230"></span><span>  </span><span class="hs-comment">-- | New where frag</span><span>
</span><span id="line-1231"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-type">S.WhereFrag</span></a></span><span>
</span><span id="line-1232"></span><span id="injectJoinCond"><span class="annot"><span class="annottext">injectJoinCond :: BoolExp -&gt; BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#injectJoinCond"><span class="hs-identifier hs-var hs-var">injectJoinCond</span></a></span></span><span> </span><span id="local-6989586621688398744"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398744"><span class="hs-identifier hs-var">joinCond</span></a></span></span><span> </span><span id="local-6989586621688398743"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398743"><span class="hs-identifier hs-var">whereCond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1233"></span><span>  </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; WhereFrag) -&gt; BoolExp -&gt; WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#simplifyBoolExp"><span class="hs-identifier hs-var">S.simplifyBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BinOp -&gt; BoolExp -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEBin"><span class="hs-identifier hs-var">S.BEBin</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#AndOp"><span class="hs-identifier hs-var">S.AndOp</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398744"><span class="hs-identifier hs-var">joinCond</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398743"><span class="hs-identifier hs-var">whereCond</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkJoinCond"><span class="hs-identifier hs-type">mkJoinCond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span>
</span><span id="line-1236"></span><span id="mkJoinCond"><span class="annot"><span class="annottext">mkJoinCond :: Alias -&gt; HashMap PGCol PGCol -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkJoinCond"><span class="hs-identifier hs-var hs-var">mkJoinCond</span></a></span></span><span> </span><span id="local-6989586621688398738"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398738"><span class="hs-identifier hs-var">baseTablepfx</span></a></span></span><span> </span><span id="local-6989586621688398737"><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398737"><span class="hs-identifier hs-var">colMapn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1237"></span><span>  </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; [BoolExp] -&gt; BoolExp
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinOp -&gt; BoolExp -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEBin"><span class="hs-identifier hs-var">S.BEBin</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#AndOp"><span class="hs-identifier hs-var">S.AndOp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([BoolExp] -&gt; BoolExp) -&gt; [BoolExp] -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><span class="annottext">(((PGCol, PGCol) -&gt; BoolExp) -&gt; [(PGCol, PGCol)] -&gt; [BoolExp])
-&gt; [(PGCol, PGCol)] -&gt; ((PGCol, PGCol) -&gt; BoolExp) -&gt; [BoolExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((PGCol, PGCol) -&gt; BoolExp) -&gt; [(PGCol, PGCol)] -&gt; [BoolExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap PGCol PGCol -&gt; [(PGCol, PGCol)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398737"><span class="hs-identifier hs-var">colMapn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((PGCol, PGCol) -&gt; BoolExp) -&gt; [BoolExp])
-&gt; ((PGCol, PGCol) -&gt; BoolExp) -&gt; [BoolExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688398733"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398733"><span class="hs-identifier hs-var">lCol</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398732"><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398732"><span class="hs-identifier hs-var">rCol</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1239"></span><span>      </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; PGCol -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398738"><span class="hs-identifier hs-var">baseTablepfx</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398733"><span class="hs-identifier hs-var">lCol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGCol -&gt; SQLExp
forall a. IsIdentifier a =&gt; a -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSIdenExp"><span class="hs-identifier hs-var">S.mkSIdenExp</span></a></span><span> </span><span class="annot"><span class="annottext">PGCol
</span><a href="#local-6989586621688398732"><span class="hs-identifier hs-var">rCol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-type">generateSQLSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1242"></span><span>  </span><span class="hs-comment">-- | Pre join condition</span><span>
</span><span id="line-1243"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1244"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1245"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-type">SelectNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1246"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1247"></span><span id="generateSQLSelect"><span class="annot"><span class="annottext">generateSQLSelect :: BoolExp -&gt; SelectSource -&gt; SelectNode -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-var hs-var">generateSQLSelect</span></a></span></span><span> </span><span id="local-6989586621688398727"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398727"><span class="hs-identifier hs-var">joinCondition</span></a></span></span><span> </span><span id="local-6989586621688398726"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398726"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span> </span><span id="local-6989586621688398725"><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398725"><span class="hs-identifier hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1248"></span><span>  </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1249"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398724"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398723"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398723"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398723"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398724"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398724"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; [(Alias, SQLExp)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398722"><span class="hs-identifier hs-var">extractors</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1250"></span><span>      </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398721"><span class="hs-identifier hs-var">joinedFrom</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1251"></span><span>      </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398720"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1252"></span><span>      </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LimitExp) -&gt; Maybe Int -&gt; Maybe LimitExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SelectSlicing -&gt; Maybe Int
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssLimit"><span class="hs-identifier hs-var hs-var">_ssLimit</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398718"><span class="hs-identifier hs-var">nodeSlicing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1253"></span><span>      </span><span class="annot"><span class="annottext">selOffset :: Maybe OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOffset"><span class="hs-identifier hs-var">S.selOffset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OffsetExp"><span class="hs-identifier hs-var">S.OffsetExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; OffsetExp) -&gt; (Int64 -&gt; SQLExp) -&gt; Int64 -&gt; OffsetExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#int64ToSQLExp"><span class="hs-identifier hs-var">S.int64ToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; OffsetExp) -&gt; Maybe Int64 -&gt; Maybe OffsetExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SelectSlicing -&gt; Maybe Int64
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssOffset"><span class="hs-identifier hs-var hs-var">_ssOffset</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398718"><span class="hs-identifier hs-var">nodeSlicing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1254"></span><span>      </span><span class="annot"><span class="annottext">selDistinct :: Maybe DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selDistinct"><span class="hs-identifier hs-var">S.selDistinct</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398712"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span><span>
</span><span id="line-1255"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1256"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1257"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span> </span><span id="local-6989586621688398711"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398711"><span class="hs-identifier hs-var">sourcePrefix</span></a></span></span><span> </span><span id="local-6989586621688398710"><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398710"><span class="hs-identifier hs-var">fromItem</span></a></span></span><span> </span><span id="local-6989586621688398709"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398709"><span class="hs-identifier hs-var">whereExp</span></a></span></span><span> </span><span id="local-6989586621688398708"><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="#local-6989586621688398708"><span class="hs-identifier hs-var">sortAndSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398726"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1258"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-type">SelectNode</span></a></span><span> </span><span id="local-6989586621688398722"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398722"><span class="hs-identifier hs-var">extractors</span></a></span></span><span> </span><span id="local-6989586621688398707"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398707"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398725"><span class="hs-identifier hs-var">selectNode</span></a></span><span>
</span><span id="line-1259"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span id="local-6989586621688398705"><span class="annot"><span class="annottext">HashMap ObjectRelationSource SelectNode
</span><a href="#local-6989586621688398705"><span class="hs-identifier hs-var">objectRelations</span></a></span></span><span> </span><span id="local-6989586621688398704"><span class="annot"><span class="annottext">HashMap ArrayRelationSource MultiRowSelectNode
</span><a href="#local-6989586621688398704"><span class="hs-identifier hs-var">arrayRelations</span></a></span></span><span> </span><span id="local-6989586621688398703"><span class="annot"><span class="annottext">HashMap ArrayConnectionSource MultiRowSelectNode
</span><a href="#local-6989586621688398703"><span class="hs-identifier hs-var">arrayConnections</span></a></span></span><span> </span><span id="local-6989586621688398702"><span class="annot"><span class="annottext">HashMap ComputedFieldTableSetSource MultiRowSelectNode
</span><a href="#local-6989586621688398702"><span class="hs-identifier hs-var">computedFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398707"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-1260"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ApplySortingAndSlicing"><span class="hs-identifier hs-type">ApplySortingAndSlicing</span></a></span><span>
</span><span id="line-1261"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688398700"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398700"><span class="hs-identifier hs-var">baseOrderBy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398699"><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398699"><span class="hs-identifier hs-var">baseSlicing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398698"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398698"><span class="hs-identifier hs-var">baseDistinctOn</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621688398720"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398720"><span class="hs-identifier hs-var">nodeOrderBy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398718"><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398718"><span class="hs-identifier hs-var">nodeSlicing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398712"><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398712"><span class="hs-identifier hs-var">nodeDistinctOn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SortingAndSlicing -&gt; ApplySortingAndSlicing
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#applySortingAndSlicing"><span class="hs-identifier hs-var">applySortingAndSlicing</span></a></span><span> </span><span class="annot"><span class="annottext">SortingAndSlicing
</span><a href="#local-6989586621688398708"><span class="hs-identifier hs-var">sortAndSlice</span></a></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span>    </span><span class="hs-comment">-- this is the table which is aliased as &quot;sourcePrefix.base&quot;</span><span>
</span><span id="line-1265"></span><span>    </span><span id="local-6989586621688398696"><span class="annot"><span class="annottext">baseSelect :: Select
</span><a href="#local-6989586621688398696"><span class="hs-identifier hs-var hs-var">baseSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1266"></span><span>      </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Qual -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEStar"><span class="hs-identifier hs-var">S.SEStar</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Qual
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1268"></span><span>          </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398710"><span class="hs-identifier hs-var">fromItem</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1269"></span><span>          </span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#injectJoinCond"><span class="hs-identifier hs-var">injectJoinCond</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398727"><span class="hs-identifier hs-var">joinCondition</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398709"><span class="hs-identifier hs-var">whereExp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1270"></span><span>          </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398700"><span class="hs-identifier hs-var">baseOrderBy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1271"></span><span>          </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LimitExp) -&gt; Maybe Int -&gt; Maybe LimitExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SelectSlicing -&gt; Maybe Int
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssLimit"><span class="hs-identifier hs-var hs-var">_ssLimit</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398699"><span class="hs-identifier hs-var">baseSlicing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1272"></span><span>          </span><span class="annot"><span class="annottext">selOffset :: Maybe OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOffset"><span class="hs-identifier hs-var">S.selOffset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; OffsetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OffsetExp"><span class="hs-identifier hs-var">S.OffsetExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; OffsetExp) -&gt; (Int64 -&gt; SQLExp) -&gt; Int64 -&gt; OffsetExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#int64ToSQLExp"><span class="hs-identifier hs-var">S.int64ToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; OffsetExp) -&gt; Maybe Int64 -&gt; Maybe OffsetExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SelectSlicing -&gt; Maybe Int64
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssOffset"><span class="hs-identifier hs-var hs-var">_ssOffset</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSlicing
</span><a href="#local-6989586621688398699"><span class="hs-identifier hs-var">baseSlicing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1273"></span><span>          </span><span class="annot"><span class="annottext">selDistinct :: Maybe DistinctExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selDistinct"><span class="hs-identifier hs-var">S.selDistinct</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DistinctExpr
</span><a href="#local-6989586621688398698"><span class="hs-identifier hs-var">baseDistinctOn</span></a></span><span>
</span><span id="line-1274"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1275"></span><span>    </span><span id="local-6989586621688398693"><span class="annot"><span class="annottext">baseSelectAlias :: Alias
</span><a href="#local-6989586621688398693"><span class="hs-identifier hs-var hs-var">baseSelectAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398711"><span class="hs-identifier hs-var">sourcePrefix</span></a></span><span>
</span><span id="line-1276"></span><span>    </span><span id="local-6989586621688398692"><span class="annot"><span class="annottext">baseFromItem :: FromItem
</span><a href="#local-6989586621688398692"><span class="hs-identifier hs-var hs-var">baseFromItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398696"><span class="hs-identifier hs-var">baseSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398693"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span>    </span><span class="hs-comment">-- function to create a joined from item from two from items</span><span>
</span><span id="line-1279"></span><span>    </span><span id="local-6989586621688398691"><span class="annot"><span class="annottext">leftOuterJoin :: FromItem -&gt; FromItem -&gt; FromItem
</span><a href="#local-6989586621688398691"><span class="hs-identifier hs-var hs-var">leftOuterJoin</span></a></span></span><span> </span><span id="local-6989586621688398690"><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398690"><span class="hs-identifier hs-var">current</span></a></span></span><span> </span><span id="local-6989586621688398689"><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398689"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1280"></span><span>      </span><span class="annot"><span class="annottext">JoinExpr -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIJoin"><span class="hs-identifier hs-var">S.FIJoin</span></a></span><span> </span><span class="annot"><span class="annottext">(JoinExpr -&gt; FromItem) -&gt; JoinExpr -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1281"></span><span>        </span><span class="annot"><span class="annottext">FromItem -&gt; JoinType -&gt; FromItem -&gt; JoinCond -&gt; JoinExpr
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#JoinExpr"><span class="hs-identifier hs-var">S.JoinExpr</span></a></span><span> </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398690"><span class="hs-identifier hs-var">current</span></a></span><span> </span><span class="annot"><span class="annottext">JoinType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LeftOuter"><span class="hs-identifier hs-var">S.LeftOuter</span></a></span><span> </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398689"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">(JoinCond -&gt; JoinExpr) -&gt; JoinCond -&gt; JoinExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1282"></span><span>          </span><span class="annot"><span class="annottext">BoolExp -&gt; JoinCond
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#JoinOn"><span class="hs-identifier hs-var">S.JoinOn</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; JoinCond) -&gt; BoolExp -&gt; JoinCond
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span>    </span><span class="hs-comment">-- this is the from eexp for the final select</span><span>
</span><span id="line-1285"></span><span>    </span><span class="annot"><a href="#local-6989586621688398721"><span class="hs-identifier hs-type">joinedFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span><span>
</span><span id="line-1286"></span><span>    </span><span id="local-6989586621688398721"><span class="annot"><span class="annottext">joinedFrom :: FromItem
</span><a href="#local-6989586621688398721"><span class="hs-identifier hs-var hs-var">joinedFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1287"></span><span>      </span><span class="annot"><span class="annottext">(FromItem -&gt; FromItem -&gt; FromItem)
-&gt; FromItem -&gt; [FromItem] -&gt; FromItem
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">FromItem -&gt; FromItem -&gt; FromItem
</span><a href="#local-6989586621688398691"><span class="hs-identifier hs-var">leftOuterJoin</span></a></span><span> </span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398692"><span class="hs-identifier hs-var">baseFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">([FromItem] -&gt; FromItem) -&gt; [FromItem] -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1288"></span><span>        </span><span class="annot"><span class="annottext">((ObjectRelationSource, SelectNode) -&gt; FromItem)
-&gt; [(ObjectRelationSource, SelectNode)] -&gt; [FromItem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ObjectRelationSource, SelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398684"><span class="hs-identifier hs-var">objectRelationToFromItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap ObjectRelationSource SelectNode
-&gt; [(ObjectRelationSource, SelectNode)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap ObjectRelationSource SelectNode
</span><a href="#local-6989586621688398705"><span class="hs-identifier hs-var">objectRelations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span>          </span><span class="annot"><span class="annottext">[FromItem] -&gt; [FromItem] -&gt; [FromItem]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((ArrayRelationSource, MultiRowSelectNode) -&gt; FromItem)
-&gt; [(ArrayRelationSource, MultiRowSelectNode)] -&gt; [FromItem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ArrayRelationSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398683"><span class="hs-identifier hs-var">arrayRelationToFromItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap ArrayRelationSource MultiRowSelectNode
-&gt; [(ArrayRelationSource, MultiRowSelectNode)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap ArrayRelationSource MultiRowSelectNode
</span><a href="#local-6989586621688398704"><span class="hs-identifier hs-var">arrayRelations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>          </span><span class="annot"><span class="annottext">[FromItem] -&gt; [FromItem] -&gt; [FromItem]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((ArrayConnectionSource, MultiRowSelectNode) -&gt; FromItem)
-&gt; [(ArrayConnectionSource, MultiRowSelectNode)] -&gt; [FromItem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ArrayConnectionSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398682"><span class="hs-identifier hs-var">arrayConnectionToFromItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap ArrayConnectionSource MultiRowSelectNode
-&gt; [(ArrayConnectionSource, MultiRowSelectNode)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap ArrayConnectionSource MultiRowSelectNode
</span><a href="#local-6989586621688398703"><span class="hs-identifier hs-var">arrayConnections</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span>          </span><span class="annot"><span class="annottext">[FromItem] -&gt; [FromItem] -&gt; [FromItem]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((ComputedFieldTableSetSource, MultiRowSelectNode) -&gt; FromItem)
-&gt; [(ComputedFieldTableSetSource, MultiRowSelectNode)]
-&gt; [FromItem]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(ComputedFieldTableSetSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398681"><span class="hs-identifier hs-var">computedFieldToFromItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap ComputedFieldTableSetSource MultiRowSelectNode
-&gt; [(ComputedFieldTableSetSource, MultiRowSelectNode)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap ComputedFieldTableSetSource MultiRowSelectNode
</span><a href="#local-6989586621688398702"><span class="hs-identifier hs-var">computedFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span>    </span><span class="annot"><a href="#local-6989586621688398684"><span class="hs-identifier hs-type">objectRelationToFromItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1294"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-type">ObjectRelationSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-type">SelectNode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span><span>
</span><span id="line-1295"></span><span>    </span><span id="local-6989586621688398684"><span class="annot"><span class="annottext">objectRelationToFromItem :: (ObjectRelationSource, SelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398684"><span class="hs-identifier hs-var hs-var">objectRelationToFromItem</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398680"><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688398680"><span class="hs-identifier hs-var">objectRelationSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398679"><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398679"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ObjectRelationSource"><span class="hs-identifier hs-type">ObjectRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398678"><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398678"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688398677"><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621688398677"><span class="hs-identifier hs-var">objectSelectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjectRelationSource
</span><a href="#local-6989586621688398680"><span class="hs-identifier hs-var">objectRelationSource</span></a></span><span>
</span><span id="line-1297"></span><span>          </span><span id="local-6989586621688398676"><span class="annot"><span class="annottext">alias :: Alias
</span><a href="#local-6989586621688398676"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ossPrefix"><span class="hs-identifier hs-var hs-var">_ossPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621688398677"><span class="hs-identifier hs-var">objectSelectSource</span></a></span><span>
</span><span id="line-1298"></span><span>          </span><span id="local-6989586621688398674"><span class="annot"><span class="annottext">source :: SelectSource
</span><a href="#local-6989586621688398674"><span class="hs-identifier hs-var hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#objectSelectSourceToSelectSource"><span class="hs-identifier hs-var">objectSelectSourceToSelectSource</span></a></span><span> </span><span class="annot"><span class="annottext">ObjectSelectSource
</span><a href="#local-6989586621688398677"><span class="hs-identifier hs-var">objectSelectSource</span></a></span><span>
</span><span id="line-1299"></span><span>          </span><span id="local-6989586621688398672"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398672"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SelectSource -&gt; SelectNode -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-var">generateSQLSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkJoinCond"><span class="hs-identifier hs-var">mkJoinCond</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398693"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398678"><span class="hs-identifier hs-var">colMapping</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398674"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398679"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1300"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkLateralFromItem"><span class="hs-identifier hs-var">S.mkLateralFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398672"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398676"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-1301"></span><span>
</span><span id="line-1302"></span><span>    </span><span class="annot"><a href="#local-6989586621688398683"><span class="hs-identifier hs-type">arrayRelationToFromItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1303"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-type">ArrayRelationSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span><span>
</span><span id="line-1304"></span><span>    </span><span id="local-6989586621688398683"><span class="annot"><span class="annottext">arrayRelationToFromItem :: (ArrayRelationSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398683"><span class="hs-identifier hs-var hs-var">arrayRelationToFromItem</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398670"><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688398670"><span class="hs-identifier hs-var">arrayRelationSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398669"><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398669"><span class="hs-identifier hs-var">arraySelectNode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayRelationSource"><span class="hs-identifier hs-type">ArrayRelationSource</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398668"><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398668"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688398667"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398667"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrayRelationSource
</span><a href="#local-6989586621688398670"><span class="hs-identifier hs-var">arrayRelationSource</span></a></span><span>
</span><span id="line-1306"></span><span>          </span><span id="local-6989586621688398666"><span class="annot"><span class="annottext">alias :: Alias
</span><a href="#local-6989586621688398666"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssPrefix"><span class="hs-identifier hs-var hs-var">_ssPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398667"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1307"></span><span>          </span><span id="local-6989586621688398664"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398664"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1308"></span><span>            </span><span class="annot"><span class="annottext">SelectSource -&gt; MultiRowSelectNode -&gt; BoolExp -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelectFromArrayNode"><span class="hs-identifier hs-var">generateSQLSelectFromArrayNode</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398667"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398669"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; Select) -&gt; BoolExp -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1309"></span><span>              </span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkJoinCond"><span class="hs-identifier hs-var">mkJoinCond</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398693"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398668"><span class="hs-identifier hs-var">colMapping</span></a></span><span>
</span><span id="line-1310"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkLateralFromItem"><span class="hs-identifier hs-var">S.mkLateralFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398664"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398666"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span>    </span><span class="annot"><a href="#local-6989586621688398682"><span class="hs-identifier hs-type">arrayConnectionToFromItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1313"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-type">ArrayConnectionSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span><span>
</span><span id="line-1314"></span><span>    </span><span id="local-6989586621688398682"><span class="annot"><span class="annottext">arrayConnectionToFromItem :: (ArrayConnectionSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398682"><span class="hs-identifier hs-var hs-var">arrayConnectionToFromItem</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398662"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398662"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398661"><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398661"><span class="hs-identifier hs-var">arraySelectNode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1315"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398660"><span class="annot"><span class="annottext">selectWith :: SelectWithG Select
</span><a href="#local-6989586621688398660"><span class="hs-identifier hs-var hs-var">selectWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alias
-&gt; ArrayConnectionSource
-&gt; MultiRowSelectNode
-&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionToSelectWith"><span class="hs-identifier hs-var">connectionToSelectWith</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398693"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398662"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398661"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span>
</span><span id="line-1316"></span><span>          </span><span id="local-6989586621688398658"><span class="annot"><span class="annottext">alias :: Alias
</span><a href="#local-6989586621688398658"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssPrefix"><span class="hs-identifier hs-var hs-var">_ssPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectSource -&gt; Identifier) -&gt; SelectSource -&gt; Identifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource -&gt; SelectSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_acsSource"><span class="hs-identifier hs-var hs-var">_acsSource</span></a></span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398662"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span><span>
</span><span id="line-1317"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Lateral -&gt; SelectWithG Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FISelectWith"><span class="hs-identifier hs-var">S.FISelectWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Lateral
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Lateral"><span class="hs-identifier hs-var">S.Lateral</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectWithG Select
</span><a href="#local-6989586621688398660"><span class="hs-identifier hs-var">selectWith</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398658"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span>    </span><span class="annot"><a href="#local-6989586621688398681"><span class="hs-identifier hs-type">computedFieldToFromItem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1320"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-type">ComputedFieldTableSetSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#FromItem"><span class="hs-identifier hs-type">S.FromItem</span></a></span><span>
</span><span id="line-1321"></span><span>    </span><span id="local-6989586621688398681"><span class="annot"><span class="annottext">computedFieldToFromItem :: (ComputedFieldTableSetSource, MultiRowSelectNode) -&gt; FromItem
</span><a href="#local-6989586621688398681"><span class="hs-identifier hs-var hs-var">computedFieldToFromItem</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398654"><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688398654"><span class="hs-identifier hs-var">computedFieldTableSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398653"><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398653"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1322"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ComputedFieldTableSetSource"><span class="hs-identifier hs-type">ComputedFieldTableSetSource</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398652"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398652"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ComputedFieldTableSetSource
</span><a href="#local-6989586621688398654"><span class="hs-identifier hs-var">computedFieldTableSource</span></a></span><span>
</span><span id="line-1323"></span><span>          </span><span id="local-6989586621688398651"><span class="annot"><span class="annottext">internalSelect :: Select
</span><a href="#local-6989586621688398651"><span class="hs-identifier hs-var hs-var">internalSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SelectSource -&gt; SelectNode -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-var">generateSQLSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398652"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectNode -&gt; Select) -&gt; SelectNode -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_mrsnSelectNode"><span class="hs-identifier hs-var hs-var">_mrsnSelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398653"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1324"></span><span>          </span><span id="local-6989586621688398649"><span class="annot"><span class="annottext">alias :: Alias
</span><a href="#local-6989586621688398649"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssPrefix"><span class="hs-identifier hs-var hs-var">_ssPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398652"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-1325"></span><span>          </span><span id="local-6989586621688398648"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398648"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1326"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1327"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode -&gt; [Extractor]
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_mrsnTopExtractors"><span class="hs-identifier hs-var hs-var">_mrsnTopExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398653"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1328"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398651"><span class="hs-identifier hs-var">internalSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398649"><span class="hs-identifier hs-var">alias</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1329"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1330"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkLateralFromItem"><span class="hs-identifier hs-var">S.mkLateralFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398648"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398649"><span class="hs-identifier hs-var">alias</span></a></span><span>
</span><span id="line-1331"></span><span>
</span><span id="line-1332"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelectFromArrayNode"><span class="hs-identifier hs-type">generateSQLSelectFromArrayNode</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1333"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1334"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1335"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1336"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1337"></span><span id="generateSQLSelectFromArrayNode"><span class="annot"><span class="annottext">generateSQLSelectFromArrayNode :: SelectSource -&gt; MultiRowSelectNode -&gt; BoolExp -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelectFromArrayNode"><span class="hs-identifier hs-var hs-var">generateSQLSelectFromArrayNode</span></a></span></span><span> </span><span id="local-6989586621688398646"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398646"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span> </span><span id="local-6989586621688398645"><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398645"><span class="hs-identifier hs-var">arraySelectNode</span></a></span></span><span> </span><span id="local-6989586621688398644"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398644"><span class="hs-identifier hs-var">joinCondition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1338"></span><span>  </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1339"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688398643"><span class="hs-identifier hs-var">topExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1340"></span><span>      </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398642"><span class="hs-identifier hs-var">selectFrom</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1341"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1343"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span> </span><span id="local-6989586621688398643"><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688398643"><span class="hs-identifier hs-var">topExtractors</span></a></span></span><span> </span><span id="local-6989586621688398641"><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398641"><span class="hs-identifier hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398645"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span>
</span><span id="line-1344"></span><span>    </span><span id="local-6989586621688398642"><span class="annot"><span class="annottext">selectFrom :: FromItem
</span><a href="#local-6989586621688398642"><span class="hs-identifier hs-var hs-var">selectFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1345"></span><span>      </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span>
</span><span id="line-1346"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoolExp -&gt; SelectSource -&gt; SelectNode -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-var">generateSQLSelect</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398644"><span class="hs-identifier hs-var">joinCondition</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398646"><span class="hs-identifier hs-var">selectSource</span></a></span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398641"><span class="hs-identifier hs-var">selectNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1347"></span><span>        </span><span class="annot"><span class="annottext">(Alias -&gt; FromItem) -&gt; Alias -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssPrefix"><span class="hs-identifier hs-var hs-var">_ssPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398646"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateSelect"><span class="hs-identifier hs-type">mkAggregateSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1350"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399955"><span class="annot"><a href="#local-6989586621688399955"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1351"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399955"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1352"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399955"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-1353"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1354"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnAggregateSelect"><span class="hs-identifier hs-type">AnnAggregateSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399955"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1355"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1356"></span><span id="mkAggregateSelect"><span class="annot"><span class="annottext">mkAggregateSelect :: AnnAggregateSelect ('Postgres pgKind) -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAggregateSelect"><span class="hs-identifier hs-var hs-var">mkAggregateSelect</span></a></span></span><span> </span><span id="local-6989586621688398640"><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
</span><a href="#local-6989586621688398640"><span class="hs-identifier hs-var">annAggSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1357"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621688398639"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398639"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398638"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398638"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398637"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398637"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398636"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398636"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1358"></span><span>        </span><span class="annot"><span class="annottext">Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; ((SelectSource, HashMap Alias SQLExp, Extractor), JoinTree)
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
 -&gt; ((SelectSource, HashMap Alias SQLExp, Extractor), JoinTree))
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; ((SelectSource, HashMap Alias SQLExp, Extractor), JoinTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1359"></span><span>          </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (SelectSource, HashMap Alias SQLExp, Extractor)
 -&gt; StringifyNumbers
 -&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor))
-&gt; StringifyNumbers
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  StringifyNumbers
  (WriterT JoinTree Identity)
  (SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; StringifyNumbers
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398633"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (SelectSource, HashMap Alias SQLExp, Extractor)
 -&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor))
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp, Extractor)
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp, Extractor)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1360"></span><span>            </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; AnnAggregateSelect ('Postgres pgKind)
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp, Extractor)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; AnnAggregateSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp, Extractor)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnAggregateSelect"><span class="hs-identifier hs-var">processAnnAggregateSelect</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398632"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398631"><span class="hs-identifier hs-var">rootFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
</span><a href="#local-6989586621688398640"><span class="hs-identifier hs-var">annAggSel</span></a></span><span>
</span><span id="line-1361"></span><span>      </span><span id="local-6989586621688398630"><span class="annot"><span class="annottext">selectNode :: SelectNode
</span><a href="#local-6989586621688398630"><span class="hs-identifier hs-var hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398638"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398636"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-1362"></span><span>      </span><span id="local-6989586621688398629"><span class="annot"><span class="annottext">arrayNode :: MultiRowSelectNode
</span><a href="#local-6989586621688398629"><span class="hs-identifier hs-var hs-var">arrayNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398637"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398630"><span class="hs-identifier hs-var">selectNode</span></a></span><span>
</span><span id="line-1363"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Select
</span><a href="Hasura.Backends.Postgres.SQL.IdentifierUniqueness.html#prefixNumToAliases"><span class="hs-identifier hs-var">prefixNumToAliases</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Select) -&gt; Select -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1364"></span><span>        </span><span class="annot"><span class="annottext">SelectSource -&gt; MultiRowSelectNode -&gt; BoolExp -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelectFromArrayNode"><span class="hs-identifier hs-var">generateSQLSelectFromArrayNode</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398639"><span class="hs-identifier hs-var">selectSource</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398629"><span class="hs-identifier hs-var">arrayNode</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; Select) -&gt; BoolExp -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1365"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1366"></span><span>    </span><span id="local-6989586621688398633"><span class="annot"><span class="annottext">strfyNum :: StringifyNumbers
</span><a href="#local-6989586621688398633"><span class="hs-identifier hs-var hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind)
  (TableAggregateFieldG ('Postgres pgKind) Void)
  SQLExp
-&gt; StringifyNumbers
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; StringifyNumbers
</span><a href="Hasura.RQL.IR.Select.html#_asnStrfyNum"><span class="hs-identifier hs-var hs-var">_asnStrfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">AnnAggregateSelect ('Postgres pgKind)
AnnSelectG
  ('Postgres pgKind)
  (TableAggregateFieldG ('Postgres pgKind) Void)
  SQLExp
</span><a href="#local-6989586621688398640"><span class="hs-identifier hs-var">annAggSel</span></a></span><span>
</span><span id="line-1367"></span><span>    </span><span id="local-6989586621688398631"><span class="annot"><span class="annottext">rootFieldName :: FieldName
</span><a href="#local-6989586621688398631"><span class="hs-identifier hs-var hs-var">rootFieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;root&quot;</span></span><span>
</span><span id="line-1368"></span><span>    </span><span id="local-6989586621688398626"><span class="annot"><span class="annottext">rootIdentifier :: Identifier
</span><a href="#local-6989586621688398626"><span class="hs-identifier hs-var hs-var">rootIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398631"><span class="hs-identifier hs-var">rootFieldName</span></a></span><span>
</span><span id="line-1369"></span><span>    </span><span id="local-6989586621688398632"><span class="annot"><span class="annottext">sourcePrefixes :: SourcePrefixes
</span><a href="#local-6989586621688398632"><span class="hs-identifier hs-var hs-var">sourcePrefixes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SourcePrefixes
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-var">SourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398626"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398626"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span>
</span><span id="line-1370"></span><span>
</span><span id="line-1371"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSQLSelect"><span class="hs-identifier hs-type">mkSQLSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1372"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399966"><span class="annot"><a href="#local-6989586621688399966"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1373"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399966"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1374"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399966"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-1375"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1376"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#JsonAggSelect"><span class="hs-identifier hs-type">JsonAggSelect</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1377"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSimpleSelect"><span class="hs-identifier hs-type">AnnSimpleSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399966"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1378"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1379"></span><span id="mkSQLSelect"><span class="annot"><span class="annottext">mkSQLSelect :: JsonAggSelect -&gt; AnnSimpleSelect ('Postgres pgKind) -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSQLSelect"><span class="hs-identifier hs-var hs-var">mkSQLSelect</span></a></span></span><span> </span><span id="local-6989586621688398625"><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688398625"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span></span><span> </span><span id="local-6989586621688398624"><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
</span><a href="#local-6989586621688398624"><span class="hs-identifier hs-var">annSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1380"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398623"><span class="annot"><span class="annottext">permLimitSubQuery :: PermissionLimitSubQuery
</span><a href="#local-6989586621688398623"><span class="hs-identifier hs-var hs-var">permLimitSubQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span>
</span><span id="line-1381"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621688398622"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398622"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398621"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398621"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398620"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398620"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1382"></span><span>        </span><span class="annot"><span class="annottext">Writer JoinTree (SelectSource, HashMap Alias SQLExp)
-&gt; ((SelectSource, HashMap Alias SQLExp), JoinTree)
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer JoinTree (SelectSource, HashMap Alias SQLExp)
 -&gt; ((SelectSource, HashMap Alias SQLExp), JoinTree))
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp)
-&gt; ((SelectSource, HashMap Alias SQLExp), JoinTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1383"></span><span>          </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (SelectSource, HashMap Alias SQLExp)
 -&gt; StringifyNumbers
 -&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp))
-&gt; StringifyNumbers
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp)
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  StringifyNumbers
  (WriterT JoinTree Identity)
  (SelectSource, HashMap Alias SQLExp)
-&gt; StringifyNumbers
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398619"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (SelectSource, HashMap Alias SQLExp)
 -&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp))
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp)
-&gt; Writer JoinTree (SelectSource, HashMap Alias SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1384"></span><span>            </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (SelectSource, HashMap Alias SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; PermissionLimitSubQuery
-&gt; AnnSimpleSelect ('Postgres pgKind)
-&gt; m (SelectSource, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnSimpleSelect"><span class="hs-identifier hs-var">processAnnSimpleSelect</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398618"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398617"><span class="hs-identifier hs-var">rootFldName</span></a></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688398623"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
</span><a href="#local-6989586621688398624"><span class="hs-identifier hs-var">annSel</span></a></span><span>
</span><span id="line-1385"></span><span>      </span><span id="local-6989586621688398616"><span class="annot"><span class="annottext">selectNode :: SelectNode
</span><a href="#local-6989586621688398616"><span class="hs-identifier hs-var hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398621"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398620"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-1386"></span><span>      </span><span id="local-6989586621688398615"><span class="annot"><span class="annottext">topExtractor :: Extractor
</span><a href="#local-6989586621688398615"><span class="hs-identifier hs-var hs-var">topExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1387"></span><span>        </span><span class="annot"><span class="annottext">JsonAggSelect
-&gt; Alias
-&gt; PermissionLimitSubQuery
-&gt; Maybe OrderByExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#asJsonAggExtr"><span class="hs-identifier hs-var">asJsonAggExtr</span></a></span><span> </span><span class="annot"><span class="annottext">JsonAggSelect
</span><a href="#local-6989586621688398625"><span class="hs-identifier hs-var">jsonAggSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398614"><span class="hs-identifier hs-var">rootFldAls</span></a></span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688398623"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe OrderByExp -&gt; Extractor) -&gt; Maybe OrderByExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1388"></span><span>          </span><span class="annot"><span class="annottext">SelectSource -&gt; Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#orderByForJsonAgg"><span class="hs-identifier hs-var">orderByForJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398622"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1389"></span><span>      </span><span id="local-6989586621688398613"><span class="annot"><span class="annottext">arrayNode :: MultiRowSelectNode
</span><a href="#local-6989586621688398613"><span class="hs-identifier hs-var hs-var">arrayNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398615"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398616"><span class="hs-identifier hs-var">selectNode</span></a></span><span>
</span><span id="line-1390"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select -&gt; Select
</span><a href="Hasura.Backends.Postgres.SQL.IdentifierUniqueness.html#prefixNumToAliases"><span class="hs-identifier hs-var">prefixNumToAliases</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; Select) -&gt; Select -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1391"></span><span>        </span><span class="annot"><span class="annottext">SelectSource -&gt; MultiRowSelectNode -&gt; BoolExp -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelectFromArrayNode"><span class="hs-identifier hs-var">generateSQLSelectFromArrayNode</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398622"><span class="hs-identifier hs-var">selectSource</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398613"><span class="hs-identifier hs-var">arrayNode</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; Select) -&gt; BoolExp -&gt; Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1392"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1393"></span><span>    </span><span id="local-6989586621688398619"><span class="annot"><span class="annottext">strfyNum :: StringifyNumbers
</span><a href="#local-6989586621688398619"><span class="hs-identifier hs-var hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
-&gt; StringifyNumbers
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; StringifyNumbers
</span><a href="Hasura.RQL.IR.Select.html#_asnStrfyNum"><span class="hs-identifier hs-var hs-var">_asnStrfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">AnnSimpleSelect ('Postgres pgKind)
AnnSelectG
  ('Postgres pgKind) (AnnFieldG ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688398624"><span class="hs-identifier hs-var">annSel</span></a></span><span>
</span><span id="line-1394"></span><span>    </span><span id="local-6989586621688398612"><span class="annot"><span class="annottext">rootFldIdentifier :: Identifier
</span><a href="#local-6989586621688398612"><span class="hs-identifier hs-var hs-var">rootFldIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398617"><span class="hs-identifier hs-var">rootFldName</span></a></span><span>
</span><span id="line-1395"></span><span>    </span><span id="local-6989586621688398618"><span class="annot"><span class="annottext">sourcePrefixes :: SourcePrefixes
</span><a href="#local-6989586621688398618"><span class="hs-identifier hs-var hs-var">sourcePrefixes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SourcePrefixes
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-var">SourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398612"><span class="hs-identifier hs-var">rootFldIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398612"><span class="hs-identifier hs-var">rootFldIdentifier</span></a></span><span>
</span><span id="line-1396"></span><span>    </span><span id="local-6989586621688398617"><span class="annot"><span class="annottext">rootFldName :: FieldName
</span><a href="#local-6989586621688398617"><span class="hs-identifier hs-var hs-var">rootFldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;root&quot;</span></span><span>
</span><span id="line-1397"></span><span>    </span><span id="local-6989586621688398614"><span class="annot"><span class="annottext">rootFldAls :: Alias
</span><a href="#local-6989586621688398614"><span class="hs-identifier hs-var hs-var">rootFldAls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398617"><span class="hs-identifier hs-var">rootFldName</span></a></span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkConnectionSelect"><span class="hs-identifier hs-type">mkConnectionSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1400"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399951"><span class="annot"><a href="#local-6989586621688399951"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1401"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399951"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1402"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399951"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-1403"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1404"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSelect"><span class="hs-identifier hs-type">ConnectionSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399951"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1405"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SelectWithG"><span class="hs-identifier hs-type">S.SelectWithG</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1406"></span><span id="mkConnectionSelect"><span class="annot"><span class="annottext">mkConnectionSelect :: ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkConnectionSelect"><span class="hs-identifier hs-var hs-var">mkConnectionSelect</span></a></span></span><span> </span><span id="local-6989586621688398611"><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398611"><span class="hs-identifier hs-var">connectionSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1407"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621688398610"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398610"><span class="hs-identifier hs-var">connectionSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398609"><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398609"><span class="hs-identifier hs-var">topExtractor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398608"><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398608"><span class="hs-identifier hs-var">nodeExtractors</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398607"><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398607"><span class="hs-identifier hs-var">joinTree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1408"></span><span>        </span><span class="annot"><span class="annottext">Writer
  JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; ((ArrayConnectionSource, Extractor, HashMap Alias SQLExp),
    JoinTree)
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer
   JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
 -&gt; ((ArrayConnectionSource, Extractor, HashMap Alias SQLExp),
     JoinTree))
-&gt; Writer
     JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; ((ArrayConnectionSource, Extractor, HashMap Alias SQLExp),
    JoinTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1409"></span><span>          </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
 -&gt; StringifyNumbers
 -&gt; Writer
      JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
-&gt; StringifyNumbers
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; Writer
     JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  StringifyNumbers
  (WriterT JoinTree Identity)
  (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; StringifyNumbers
-&gt; Writer
     JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621688398606"><span class="hs-identifier hs-var">strfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   StringifyNumbers
   (WriterT JoinTree Identity)
   (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
 -&gt; Writer
      JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp))
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; Writer
     JoinTree (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1410"></span><span>            </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; Alias
-&gt; HashMap PGCol PGCol
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; ReaderT
     StringifyNumbers
     (WriterT JoinTree Identity)
     (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; Alias
-&gt; HashMap PGCol PGCol
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processConnectionSelect"><span class="hs-identifier hs-var">processConnectionSelect</span></a></span><span>
</span><span id="line-1411"></span><span>              </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398605"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-1412"></span><span>              </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398604"><span class="hs-identifier hs-var">rootFieldName</span></a></span><span>
</span><span id="line-1413"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398603"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1414"></span><span>              </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1415"></span><span>              </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398611"><span class="hs-identifier hs-var">connectionSelect</span></a></span><span>
</span><span id="line-1416"></span><span>      </span><span id="local-6989586621688398602"><span class="annot"><span class="annottext">selectNode :: MultiRowSelectNode
</span><a href="#local-6989586621688398602"><span class="hs-identifier hs-var hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1417"></span><span>        </span><span class="annot"><span class="annottext">[Extractor] -&gt; SelectNode -&gt; MultiRowSelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-var">MultiRowSelectNode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398609"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(SelectNode -&gt; MultiRowSelectNode)
-&gt; SelectNode -&gt; MultiRowSelectNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1418"></span><span>          </span><span class="annot"><span class="annottext">HashMap Alias SQLExp -&gt; JoinTree -&gt; SelectNode
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectNode"><span class="hs-identifier hs-var">SelectNode</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398608"><span class="hs-identifier hs-var">nodeExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">JoinTree
</span><a href="#local-6989586621688398607"><span class="hs-identifier hs-var">joinTree</span></a></span><span>
</span><span id="line-1419"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SelectWithG Select -&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.SQL.IdentifierUniqueness.html#prefixNumToAliasesSelectWith"><span class="hs-identifier hs-var">prefixNumToAliasesSelectWith</span></a></span><span> </span><span class="annot"><span class="annottext">(SelectWithG Select -&gt; SelectWithG Select)
-&gt; SelectWithG Select -&gt; SelectWithG Select
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1420"></span><span>        </span><span class="annot"><span class="annottext">Alias
-&gt; ArrayConnectionSource
-&gt; MultiRowSelectNode
-&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionToSelectWith"><span class="hs-identifier hs-var">connectionToSelectWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398603"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398610"><span class="hs-identifier hs-var">connectionSource</span></a></span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398602"><span class="hs-identifier hs-var">selectNode</span></a></span><span>
</span><span id="line-1421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1422"></span><span>    </span><span id="local-6989586621688398606"><span class="annot"><span class="annottext">strfyNum :: StringifyNumbers
</span><a href="#local-6989586621688398606"><span class="hs-identifier hs-var hs-var">strfyNum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
-&gt; StringifyNumbers
forall (b :: BackendType) (f :: * -&gt; *) v.
AnnSelectG b f v -&gt; StringifyNumbers
</span><a href="Hasura.RQL.IR.Select.html#_asnStrfyNum"><span class="hs-identifier hs-var hs-var">_asnStrfyNum</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnSelectG
   ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
 -&gt; StringifyNumbers)
-&gt; AnnSelectG
     ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
-&gt; StringifyNumbers
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; AnnSelectG
     ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
forall (b :: BackendType) r v.
ConnectionSelect b r v -&gt; AnnSelectG b (ConnectionField b r) v
</span><a href="Hasura.RQL.IR.Select.html#_csSelect"><span class="hs-identifier hs-var hs-var">_csSelect</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398611"><span class="hs-identifier hs-var">connectionSelect</span></a></span><span>
</span><span id="line-1423"></span><span>    </span><span id="local-6989586621688398604"><span class="annot"><span class="annottext">rootFieldName :: FieldName
</span><a href="#local-6989586621688398604"><span class="hs-identifier hs-var hs-var">rootFieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;root&quot;</span></span><span>
</span><span id="line-1424"></span><span>    </span><span id="local-6989586621688398603"><span class="annot"><span class="annottext">rootIdentifier :: Identifier
</span><a href="#local-6989586621688398603"><span class="hs-identifier hs-var hs-var">rootIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398604"><span class="hs-identifier hs-var">rootFieldName</span></a></span><span>
</span><span id="line-1425"></span><span>    </span><span id="local-6989586621688398605"><span class="annot"><span class="annottext">sourcePrefixes :: SourcePrefixes
</span><a href="#local-6989586621688398605"><span class="hs-identifier hs-var hs-var">sourcePrefixes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Identifier -&gt; SourcePrefixes
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-var">SourcePrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398603"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398603"><span class="hs-identifier hs-var">rootIdentifier</span></a></span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="hs-comment">-- | First element extractor expression from given record set</span><span>
</span><span id="line-1428"></span><span class="hs-comment">-- For example:- To get first &quot;id&quot; column from given row set,</span><span>
</span><span id="line-1429"></span><span class="hs-comment">-- the function generates the SQL expression AS `(array_agg(&quot;id&quot;))[1]`</span><span>
</span><span id="line-1430"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkFirstElementExp"><span class="hs-identifier hs-type">mkFirstElementExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1431"></span><span id="mkFirstElementExp"><span class="annot"><span class="annottext">mkFirstElementExp :: SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkFirstElementExp"><span class="hs-identifier hs-var hs-var">mkFirstElementExp</span></a></span></span><span> </span><span id="local-6989586621688398599"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398599"><span class="hs-identifier hs-var">expIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1432"></span><span>  </span><span class="hs-comment">-- For Example</span><span>
</span><span id="line-1433"></span><span>  </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEArrayIndex"><span class="hs-identifier hs-var">S.SEArrayIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;array_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398599"><span class="hs-identifier hs-var">expIdentifier</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>
</span><span id="line-1435"></span><span class="hs-comment">-- | Last element extractor expression from given record set.</span><span>
</span><span id="line-1436"></span><span class="hs-comment">-- For example:- To get first &quot;id&quot; column from given row set,</span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- the function generates the SQL expression AS `(array_agg(&quot;id&quot;))[array_length(array_agg(&quot;id&quot;), 1)]`</span><span>
</span><span id="line-1438"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#mkLastElementExp"><span class="hs-identifier hs-type">mkLastElementExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1439"></span><span id="mkLastElementExp"><span class="annot"><span class="annottext">mkLastElementExp :: SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkLastElementExp"><span class="hs-identifier hs-var hs-var">mkLastElementExp</span></a></span></span><span> </span><span id="local-6989586621688398596"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398596"><span class="hs-identifier hs-var">expIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398595"><span class="annot"><span class="annottext">arrayExp :: SQLExp
</span><a href="#local-6989586621688398595"><span class="hs-identifier hs-var hs-var">arrayExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;array_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398596"><span class="hs-identifier hs-var">expIdentifier</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1441"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEArrayIndex"><span class="hs-identifier hs-var">S.SEArrayIndex</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398595"><span class="hs-identifier hs-var">arrayExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1442"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;array_length&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398595"><span class="hs-identifier hs-var">arrayExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1443"></span><span>
</span><span id="line-1444"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-type">cursorIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1445"></span><span id="cursorIdentifier"><span class="annot"><span class="annottext">cursorIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-var hs-var">cursorIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__cursor&quot;</span></span><span>
</span><span id="line-1446"></span><span>
</span><span id="line-1447"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#startCursorIdentifier"><span class="hs-identifier hs-type">startCursorIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1448"></span><span id="startCursorIdentifier"><span class="annot"><span class="annottext">startCursorIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#startCursorIdentifier"><span class="hs-identifier hs-var hs-var">startCursorIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__start_cursor&quot;</span></span><span>
</span><span id="line-1449"></span><span>
</span><span id="line-1450"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#endCursorIdentifier"><span class="hs-identifier hs-type">endCursorIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1451"></span><span id="endCursorIdentifier"><span class="annot"><span class="annottext">endCursorIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#endCursorIdentifier"><span class="hs-identifier hs-var hs-var">endCursorIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__end_cursor&quot;</span></span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#hasPreviousPageIdentifier"><span class="hs-identifier hs-type">hasPreviousPageIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1454"></span><span id="hasPreviousPageIdentifier"><span class="annot"><span class="annottext">hasPreviousPageIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasPreviousPageIdentifier"><span class="hs-identifier hs-var hs-var">hasPreviousPageIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__has_previous_page&quot;</span></span><span>
</span><span id="line-1455"></span><span>
</span><span id="line-1456"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#hasNextPageIdentifier"><span class="hs-identifier hs-type">hasNextPageIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1457"></span><span id="hasNextPageIdentifier"><span class="annot"><span class="annottext">hasNextPageIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasNextPageIdentifier"><span class="hs-identifier hs-var hs-var">hasNextPageIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__has_next_page&quot;</span></span><span>
</span><span id="line-1458"></span><span>
</span><span id="line-1459"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#pageInfoSelectAliasIdentifier"><span class="hs-identifier hs-type">pageInfoSelectAliasIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1460"></span><span id="pageInfoSelectAliasIdentifier"><span class="annot"><span class="annottext">pageInfoSelectAliasIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#pageInfoSelectAliasIdentifier"><span class="hs-identifier hs-var hs-var">pageInfoSelectAliasIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__page_info&quot;</span></span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-type">cursorsSelectAliasIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a></span><span>
</span><span id="line-1463"></span><span id="cursorsSelectAliasIdentifier"><span class="annot"><span class="annottext">cursorsSelectAliasIdentifier :: Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var hs-var">cursorsSelectAliasIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__cursors_select&quot;</span></span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-type">encodeBase64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1466"></span><span id="encodeBase64"><span class="annot"><span class="annottext">encodeBase64 :: SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-var hs-var">encodeBase64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1467"></span><span>  </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398587"><span class="hs-identifier hs-var">removeNewline</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; (SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398586"><span class="hs-identifier hs-var">bytesToBase64Text</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; (SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398585"><span class="hs-identifier hs-var">convertToBytes</span></a></span><span>
</span><span id="line-1468"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1469"></span><span>    </span><span id="local-6989586621688398585"><span class="annot"><span class="annottext">convertToBytes :: SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398585"><span class="hs-identifier hs-var hs-var">convertToBytes</span></a></span></span><span> </span><span id="local-6989586621688398584"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398584"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1470"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;convert_to&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398584"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;UTF8&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1471"></span><span>    </span><span id="local-6989586621688398586"><span class="annot"><span class="annottext">bytesToBase64Text :: SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398586"><span class="hs-identifier hs-var hs-var">bytesToBase64Text</span></a></span></span><span> </span><span id="local-6989586621688398583"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398583"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1472"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;encode&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398583"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;base64&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1473"></span><span>    </span><span id="local-6989586621688398587"><span class="annot"><span class="annottext">removeNewline :: SQLExp -&gt; SQLExp
</span><a href="#local-6989586621688398587"><span class="hs-identifier hs-var hs-var">removeNewline</span></a></span></span><span> </span><span id="local-6989586621688398582"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398582"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1474"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;regexp_replace&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398582"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;g&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1475"></span><span>
</span><span id="line-1476"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#processConnectionSelect"><span class="hs-identifier hs-type">processConnectionSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1477"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399674"><span class="annot"><a href="#local-6989586621688399674"><span class="hs-identifier hs-type">pgKind</span></a></span></span><span> </span><span id="local-6989586621688399675"><span class="annot"><a href="#local-6989586621688399675"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1478"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399675"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1479"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399675"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399674"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1481"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#PostgresAnnotatedFieldJSON"><span class="hs-identifier hs-type">PostgresAnnotatedFieldJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399674"><span class="hs-identifier hs-type">pgKind</span></a></span><span>
</span><span id="line-1482"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1483"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SourcePrefixes"><span class="hs-identifier hs-type">SourcePrefixes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1484"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1485"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1486"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#PGCol"><span class="hs-identifier hs-type">PGCol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1487"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSelect"><span class="hs-identifier hs-type">ConnectionSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.SQL.Backend.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399674"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1488"></span><span>  </span><span class="annot"><a href="#local-6989586621688399675"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1489"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-type">ArrayConnectionSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1490"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1491"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1492"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span id="processConnectionSelect"><span class="annot"><span class="annottext">processConnectionSelect :: SourcePrefixes
-&gt; FieldName
-&gt; Alias
-&gt; HashMap PGCol PGCol
-&gt; ConnectionSelect ('Postgres pgKind) Void SQLExp
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processConnectionSelect"><span class="hs-identifier hs-var hs-var">processConnectionSelect</span></a></span></span><span> </span><span id="local-6989586621688398581"><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398581"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span></span><span> </span><span id="local-6989586621688398580"><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span></span><span> </span><span id="local-6989586621688398579"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398579"><span class="hs-identifier hs-var">relAlias</span></a></span></span><span> </span><span id="local-6989586621688398578"><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398578"><span class="hs-identifier hs-var">colMapping</span></a></span></span><span> </span><span id="local-6989586621688398577"><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398577"><span class="hs-identifier hs-var">connectionSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1494"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688398576"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398576"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398575"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398575"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398574"><span class="annot"><span class="annottext">Maybe SQLExp
</span><a href="#local-6989586621688398574"><span class="hs-identifier hs-var">maybeOrderByCursor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1495"></span><span>    </span><span class="annot"><span class="annottext">SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind)) =&gt;
SourcePrefixes
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; SelectFrom ('Postgres pgKind)
-&gt; PermissionLimitSubQuery
-&gt; TablePerm ('Postgres pgKind)
-&gt; SelectArgs ('Postgres pgKind)
-&gt; m (SelectSource, [(Alias, SQLExp)], Maybe SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processSelectParams"><span class="hs-identifier hs-var">processSelectParams</span></a></span><span>
</span><span id="line-1496"></span><span>      </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398581"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-1497"></span><span>      </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-1498"></span><span>      </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398573"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span>
</span><span id="line-1499"></span><span>      </span><span class="annot"><span class="annottext">SelectFrom ('Postgres pgKind)
SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398572"><span class="hs-identifier hs-var">selectFrom</span></a></span><span>
</span><span id="line-1500"></span><span>      </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="#local-6989586621688398571"><span class="hs-identifier hs-var">permLimitSubQuery</span></a></span><span>
</span><span id="line-1501"></span><span>      </span><span class="annot"><span class="annottext">TablePerm ('Postgres pgKind)
TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398570"><span class="hs-identifier hs-var">tablePermissions</span></a></span><span>
</span><span id="line-1502"></span><span>      </span><span class="annot"><span class="annottext">SelectArgs ('Postgres pgKind)
SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398569"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398568"><span class="annot"><span class="annottext">mkCursorExtractor :: SQLExp -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398568"><span class="hs-identifier hs-var hs-var">mkCursorExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-var">cursorIdentifier</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; (Alias, SQLExp))
-&gt; (SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; (Alias, SQLExp)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLExp -&gt; TypeAnn -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SETyAnn"><span class="hs-operator hs-var">`S.SETyAnn`</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span>      </span><span id="local-6989586621688398567"><span class="annot"><span class="annottext">cursorExtractors :: [(Alias, SQLExp)]
</span><a href="#local-6989586621688398567"><span class="hs-identifier hs-var hs-var">cursorExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe SQLExp
</span><a href="#local-6989586621688398574"><span class="hs-identifier hs-var">maybeOrderByCursor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1506"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688398566"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398566"><span class="hs-identifier hs-var">orderByCursor</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398568"><span class="hs-identifier hs-var">mkCursorExtractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398566"><span class="hs-identifier hs-var">orderByCursor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1507"></span><span>        </span><span class="annot"><span class="annottext">Maybe SQLExp
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1508"></span><span>          </span><span class="hs-comment">-- Extract primary key columns from base select along with cursor expression.</span><span>
</span><span id="line-1509"></span><span>          </span><span class="hs-comment">-- Those columns are required to perform connection split via a WHERE clause.</span><span>
</span><span id="line-1510"></span><span>          </span><span class="annot"><span class="annottext">SQLExp -&gt; (Alias, SQLExp)
</span><a href="#local-6989586621688398568"><span class="hs-identifier hs-var">mkCursorExtractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398565"><span class="hs-identifier hs-var">primaryKeyColumnsObjectExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias, SQLExp) -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398564"><span class="hs-identifier hs-var">primaryKeyColumnExtractors</span></a></span><span>
</span><span id="line-1511"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688398563"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398563"><span class="hs-identifier hs-var">topExtractorExp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398562"><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398562"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StateT [(Alias, SQLExp)] m SQLExp
 -&gt; [(Alias, SQLExp)] -&gt; m (SQLExp, [(Alias, SQLExp)]))
-&gt; [(Alias, SQLExp)]
-&gt; StateT [(Alias, SQLExp)] m SQLExp
-&gt; m (SQLExp, [(Alias, SQLExp)])
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT [(Alias, SQLExp)] m SQLExp
-&gt; [(Alias, SQLExp)] -&gt; m (SQLExp, [(Alias, SQLExp)])
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(StateT [(Alias, SQLExp)] m SQLExp
 -&gt; m (SQLExp, [(Alias, SQLExp)]))
-&gt; StateT [(Alias, SQLExp)] m SQLExp
-&gt; m (SQLExp, [(Alias, SQLExp)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; StateT [(Alias, SQLExp)] m SQLExp
forall (n :: * -&gt; *).
(MonadReader StringifyNumbers n, MonadWriter JoinTree n,
 MonadState [(Alias, SQLExp)] n) =&gt;
SelectSource -&gt; n SQLExp
</span><a href="#local-6989586621688398560"><span class="hs-identifier hs-var">processFields</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398576"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1512"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398559"><span class="annot"><span class="annottext">topExtractor :: Extractor
</span><a href="#local-6989586621688398559"><span class="hs-identifier hs-var hs-var">topExtractor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398563"><span class="hs-identifier hs-var">topExtractorExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398558"><span class="hs-identifier hs-var">fieldIdentifier</span></a></span><span>
</span><span id="line-1513"></span><span>      </span><span id="local-6989586621688398557"><span class="annot"><span class="annottext">allExtractors :: HashMap Alias SQLExp
</span><a href="#local-6989586621688398557"><span class="hs-identifier hs-var hs-var">allExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; HashMap Alias SQLExp)
-&gt; [(Alias, SQLExp)] -&gt; HashMap Alias SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398567"><span class="hs-identifier hs-var">cursorExtractors</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398562"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, SQLExp)]
</span><a href="#local-6989586621688398575"><span class="hs-identifier hs-var">orderByAndDistinctExtrs</span></a></span><span>
</span><span id="line-1514"></span><span>      </span><span id="local-6989586621688398556"><span class="annot"><span class="annottext">arrayConnectionSource :: ArrayConnectionSource
</span><a href="#local-6989586621688398556"><span class="hs-identifier hs-var hs-var">arrayConnectionSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1515"></span><span>        </span><span class="annot"><span class="annottext">Alias
-&gt; HashMap PGCol PGCol
-&gt; Maybe BoolExp
-&gt; Maybe ConnectionSlice
-&gt; SelectSource
-&gt; ArrayConnectionSource
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-var">ArrayConnectionSource</span></a></span><span>
</span><span id="line-1516"></span><span>          </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398579"><span class="hs-identifier hs-var">relAlias</span></a></span><span>
</span><span id="line-1517"></span><span>          </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398578"><span class="hs-identifier hs-var">colMapping</span></a></span><span>
</span><span id="line-1518"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp) -&gt; BoolExp
</span><a href="#local-6989586621688398554"><span class="hs-identifier hs-var">mkSplitBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp) -&gt; BoolExp)
-&gt; Maybe (NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp))
-&gt; Maybe BoolExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688398553"><span class="hs-identifier hs-var">maybeSplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1519"></span><span>          </span><span class="annot"><span class="annottext">Maybe ConnectionSlice
</span><a href="#local-6989586621688398552"><span class="hs-identifier hs-var">maybeSlice</span></a></span><span>
</span><span id="line-1520"></span><span>          </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398576"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1521"></span><span>  </span><span class="annot"><span class="annottext">(ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
-&gt; m (ArrayConnectionSource, Extractor, HashMap Alias SQLExp)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1522"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398556"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1523"></span><span>      </span><span class="annot"><span class="annottext">Extractor
</span><a href="#local-6989586621688398559"><span class="hs-identifier hs-var">topExtractor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1524"></span><span>      </span><span class="annot"><span class="annottext">HashMap Alias SQLExp
</span><a href="#local-6989586621688398557"><span class="hs-identifier hs-var">allExtractors</span></a></span><span>
</span><span id="line-1525"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1527"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSelect"><span class="hs-identifier hs-type">ConnectionSelect</span></a></span><span> </span><span class="annot"><span class="annottext">XRelay ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398550"><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398550"><span class="hs-identifier hs-var">primaryKeyColumns</span></a></span></span><span> </span><span id="local-6989586621688398553"><span class="annot"><span class="annottext">Maybe (NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp))
</span><a href="#local-6989586621688398553"><span class="hs-identifier hs-var">maybeSplit</span></a></span></span><span> </span><span id="local-6989586621688398552"><span class="annot"><span class="annottext">Maybe ConnectionSlice
</span><a href="#local-6989586621688398552"><span class="hs-identifier hs-var">maybeSlice</span></a></span></span><span> </span><span id="local-6989586621688398549"><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688398549"><span class="hs-identifier hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectionSelect ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398577"><span class="hs-identifier hs-var">connectionSelect</span></a></span><span>
</span><span id="line-1528"></span><span>    </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#AnnSelectG"><span class="hs-identifier hs-type">AnnSelectG</span></a></span><span> </span><span id="local-6989586621688398548"><span class="annot"><span class="annottext">Fields (ConnectionField ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688398548"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621688398572"><span class="annot"><span class="annottext">SelectFromG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398572"><span class="hs-identifier hs-var">selectFrom</span></a></span></span><span> </span><span id="local-6989586621688398570"><span class="annot"><span class="annottext">TablePermG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398570"><span class="hs-identifier hs-var">tablePermissions</span></a></span></span><span> </span><span id="local-6989586621688398569"><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398569"><span class="hs-identifier hs-var">tableArgs</span></a></span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnSelectG
  ('Postgres pgKind) (ConnectionField ('Postgres pgKind) Void) SQLExp
</span><a href="#local-6989586621688398549"><span class="hs-identifier hs-var">select</span></a></span><span>
</span><span id="line-1529"></span><span>    </span><span id="local-6989586621688398558"><span class="annot"><span class="annottext">fieldIdentifier :: Identifier
</span><a href="#local-6989586621688398558"><span class="hs-identifier hs-var hs-var">fieldIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span>
</span><span id="line-1530"></span><span>    </span><span id="local-6989586621688398547"><span class="annot"><span class="annottext">thisPrefix :: Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var hs-var">thisPrefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourcePrefixes -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_pfThis"><span class="hs-identifier hs-var hs-var">_pfThis</span></a></span><span> </span><span class="annot"><span class="annottext">SourcePrefixes
</span><a href="#local-6989586621688398581"><span class="hs-identifier hs-var">sourcePrefixes</span></a></span><span>
</span><span id="line-1531"></span><span>    </span><span id="local-6989586621688398571"><span class="annot"><span class="annottext">permLimitSubQuery :: PermissionLimitSubQuery
</span><a href="#local-6989586621688398571"><span class="hs-identifier hs-var hs-var">permLimitSubQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PermissionLimitSubQuery
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#PLSQNotRequired"><span class="hs-identifier hs-var">PLSQNotRequired</span></a></span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span>    </span><span id="local-6989586621688398565"><span class="annot"><span class="annottext">primaryKeyColumnsObjectExp :: SQLExp
</span><a href="#local-6989586621688398565"><span class="hs-identifier hs-var hs-var">primaryKeyColumnsObjectExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1534"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1535"></span><span>        </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind) -&gt; [SQLExp])
 -&gt; [ColumnInfo ('Postgres pgKind)] -&gt; [SQLExp])
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (ColumnInfo ('Postgres pgKind) -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo ('Postgres pgKind) -&gt; [SQLExp])
-&gt; [ColumnInfo ('Postgres pgKind)] -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398550"><span class="hs-identifier hs-var">primaryKeyColumns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind) -&gt; [SQLExp]) -&gt; [SQLExp])
-&gt; (ColumnInfo ('Postgres pgKind) -&gt; [SQLExp]) -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1536"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621688398546"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398546"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1537"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SQLExp) -&gt; Text -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PGCol -&gt; Text
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#getPGColTxt"><span class="hs-identifier hs-var hs-var">getPGColTxt</span></a></span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; Text) -&gt; PGCol -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398546"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1538"></span><span>              </span><span class="annot"><span class="annottext">StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
forall (pgKind :: PostgresKind).
StringifyNumbers
-&gt; ColumnType ('Postgres pgKind) -&gt; Bool -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Column.html#toJSONableExp"><span class="hs-identifier hs-var">toJSONableExp</span></a></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.RQL.Types.Common.html#LeaveNumbersAlone"><span class="hs-identifier hs-var">LeaveNumbersAlone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; ColumnType ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; ColumnType b
</span><a href="Hasura.RQL.Types.Column.html#ciType"><span class="hs-identifier hs-var hs-var">ciType</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398546"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1539"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PGCol -&gt; SQLExp) -&gt; PGCol -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398546"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-1540"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1541"></span><span>
</span><span id="line-1542"></span><span>    </span><span id="local-6989586621688398564"><span class="annot"><span class="annottext">primaryKeyColumnExtractors :: [(Alias, SQLExp)]
</span><a href="#local-6989586621688398564"><span class="hs-identifier hs-var hs-var">primaryKeyColumnExtractors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1543"></span><span>      </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind) -&gt; (Alias, SQLExp))
 -&gt; [ColumnInfo ('Postgres pgKind)] -&gt; [(Alias, SQLExp)])
-&gt; [ColumnInfo ('Postgres pgKind)]
-&gt; (ColumnInfo ('Postgres pgKind) -&gt; (Alias, SQLExp))
-&gt; [(Alias, SQLExp)]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(ColumnInfo ('Postgres pgKind) -&gt; (Alias, SQLExp))
-&gt; [ColumnInfo ('Postgres pgKind)] -&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
-&gt; [ColumnInfo ('Postgres pgKind)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">PrimaryKeyColumns ('Postgres pgKind)
</span><a href="#local-6989586621688398550"><span class="hs-identifier hs-var">primaryKeyColumns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ColumnInfo ('Postgres pgKind) -&gt; (Alias, SQLExp))
 -&gt; [(Alias, SQLExp)])
-&gt; (ColumnInfo ('Postgres pgKind) -&gt; (Alias, SQLExp))
-&gt; [(Alias, SQLExp)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1544"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621688398545"><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398545"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1545"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398544"><span class="annot"><span class="annottext">pgColumn :: Column ('Postgres pgKind)
</span><a href="#local-6989586621688398544"><span class="hs-identifier hs-var hs-var">pgColumn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind) -&gt; Column ('Postgres pgKind)
forall (b :: BackendType). ColumnInfo b -&gt; Column b
</span><a href="Hasura.RQL.Types.Column.html#ciColumn"><span class="hs-identifier hs-var hs-var">ciColumn</span></a></span><span> </span><span class="annot"><span class="annottext">ColumnInfo ('Postgres pgKind)
</span><a href="#local-6989586621688398545"><span class="hs-identifier hs-var">pgColumnInfo</span></a></span><span>
</span><span id="line-1546"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableColumnAlias"><span class="hs-identifier hs-var">mkBaseTableColumnAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688398544"><span class="hs-identifier hs-var">pgColumn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1547"></span><span>                </span><span class="annot"><span class="annottext">Identifier -&gt; PGCol -&gt; SQLExp
forall a b. (IsIdentifier a, IsIdentifier b) =&gt; a -&gt; b -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQIdenExp"><span class="hs-identifier hs-var">S.mkQIdenExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkBaseTableAlias"><span class="hs-identifier hs-var">mkBaseTableAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Column ('Postgres pgKind)
PGCol
</span><a href="#local-6989586621688398544"><span class="hs-identifier hs-var">pgColumn</span></a></span><span>
</span><span id="line-1548"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>    </span><span id="local-6989586621688398554"><span class="annot"><span class="annottext">mkSplitBoolExp :: NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp) -&gt; BoolExp
</span><a href="#local-6989586621688398554"><span class="hs-identifier hs-var hs-var">mkSplitBoolExp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688398543"><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398543"><span class="hs-identifier hs-var">firstSplit</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">NE.:|</span></span><span> </span><span id="local-6989586621688398542"><span class="annot"><span class="annottext">[ConnectionSplit ('Postgres pgKind) SQLExp]
</span><a href="#local-6989586621688398542"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1551"></span><span>      </span><span class="annot"><span class="annottext">BinOp -&gt; BoolExp -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEBin"><span class="hs-identifier hs-var">S.BEBin</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrOp"><span class="hs-identifier hs-var">S.OrOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp -&gt; BoolExp
</span><a href="#local-6989586621688398540"><span class="hs-identifier hs-var">mkSplitCompareExp</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398543"><span class="hs-identifier hs-var">firstSplit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
-&gt; [ConnectionSplit ('Postgres pgKind) SQLExp] -&gt; BoolExp
</span><a href="#local-6989586621688398539"><span class="hs-identifier hs-var">mkBoolExpFromRest</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398543"><span class="hs-identifier hs-var">firstSplit</span></a></span><span> </span><span class="annot"><span class="annottext">[ConnectionSplit ('Postgres pgKind) SQLExp]
</span><a href="#local-6989586621688398542"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1552"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1553"></span><span>        </span><span id="local-6989586621688398539"><span class="annot"><span class="annottext">mkBoolExpFromRest :: ConnectionSplit ('Postgres pgKind) SQLExp
-&gt; [ConnectionSplit ('Postgres pgKind) SQLExp] -&gt; BoolExp
</span><a href="#local-6989586621688398539"><span class="hs-identifier hs-var hs-var">mkBoolExpFromRest</span></a></span></span><span> </span><span id="local-6989586621688398538"><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398538"><span class="hs-identifier hs-var">previousSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1554"></span><span>          </span><span class="annot"><span class="annottext">BinOp -&gt; BoolExp -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BEBin"><span class="hs-identifier hs-var">S.BEBin</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#AndOp"><span class="hs-identifier hs-var">S.AndOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp -&gt; BoolExp
</span><a href="#local-6989586621688398537"><span class="hs-identifier hs-var">mkEqualityCompareExp</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398538"><span class="hs-identifier hs-var">previousSplit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp)
-&gt; ([ConnectionSplit ('Postgres pgKind) SQLExp] -&gt; BoolExp)
-&gt; [ConnectionSplit ('Postgres pgKind) SQLExp]
-&gt; BoolExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1555"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BELit"><span class="hs-identifier hs-var">S.BELit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1556"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621688398536"><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398536"><span class="hs-identifier hs-var">thisSplit</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621688398535"><span class="annot"><span class="annottext">[ConnectionSplit ('Postgres pgKind) SQLExp]
</span><a href="#local-6989586621688398535"><span class="hs-identifier hs-var">remainingSplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp) -&gt; BoolExp
</span><a href="#local-6989586621688398554"><span class="hs-identifier hs-var">mkSplitBoolExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398536"><span class="hs-identifier hs-var">thisSplit</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSplit ('Postgres pgKind) SQLExp
-&gt; [ConnectionSplit ('Postgres pgKind) SQLExp]
-&gt; NonEmpty (ConnectionSplit ('Postgres pgKind) SQLExp)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[ConnectionSplit ('Postgres pgKind) SQLExp]
</span><a href="#local-6989586621688398535"><span class="hs-identifier hs-var">remainingSplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>
</span><span id="line-1558"></span><span>        </span><span id="local-6989586621688398540"><span class="annot"><span class="annottext">mkSplitCompareExp :: ConnectionSplit ('Postgres pgKind) SQLExp -&gt; BoolExp
</span><a href="#local-6989586621688398540"><span class="hs-identifier hs-var hs-var">mkSplitCompareExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSplit"><span class="hs-identifier hs-type">ConnectionSplit</span></a></span><span> </span><span id="local-6989586621688398533"><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="#local-6989586621688398533"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621688398532"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398532"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.OrderBy.html#OrderByItemG"><span class="hs-identifier hs-type">OrderByItemG</span></a></span><span> </span><span id="local-6989586621688398531"><span class="annot"><span class="annottext">Maybe (BasicOrderType ('Postgres pgKind))
</span><a href="#local-6989586621688398531"><span class="hs-identifier hs-var">obTyM</span></a></span></span><span> </span><span id="local-6989586621688398530"><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398530"><span class="hs-identifier hs-var">obCol</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (NullsOrderType ('Postgres pgKind))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1559"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398529"><span class="annot"><span class="annottext">obAlias :: Alias
</span><a href="#local-6989586621688398529"><span class="hs-identifier hs-var hs-var">obAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; Alias
forall (pgKind :: PostgresKind) v.
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var">mkAnnOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398573"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedOrderByElement ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398530"><span class="hs-identifier hs-var">obCol</span></a></span><span>
</span><span id="line-1560"></span><span>              </span><span id="local-6989586621688398528"><span class="annot"><span class="annottext">obTy :: OrderType
</span><a href="#local-6989586621688398528"><span class="hs-identifier hs-var hs-var">obTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderType -&gt; Maybe OrderType -&gt; OrderType
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTAsc"><span class="hs-identifier hs-var">S.OTAsc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (BasicOrderType ('Postgres pgKind))
Maybe OrderType
</span><a href="#local-6989586621688398531"><span class="hs-identifier hs-var">obTyM</span></a></span><span>
</span><span id="line-1561"></span><span>              </span><span id="local-6989586621688398526"><span class="annot"><span class="annottext">compareOp :: CompareOp
</span><a href="#local-6989586621688398526"><span class="hs-identifier hs-var hs-var">compareOp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="#local-6989586621688398533"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="#local-6989586621688398528"><span class="hs-identifier hs-var">obTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1562"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="Hasura.RQL.IR.Select.html#CSKAfter"><span class="hs-identifier hs-var">CSKAfter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTAsc"><span class="hs-identifier hs-var">S.OTAsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SGT"><span class="hs-identifier hs-var">S.SGT</span></a></span><span>
</span><span id="line-1563"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="Hasura.RQL.IR.Select.html#CSKAfter"><span class="hs-identifier hs-var">CSKAfter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTDesc"><span class="hs-identifier hs-var">S.OTDesc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SLT"><span class="hs-identifier hs-var">S.SLT</span></a></span><span>
</span><span id="line-1564"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="Hasura.RQL.IR.Select.html#CSKBefore"><span class="hs-identifier hs-var">CSKBefore</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTAsc"><span class="hs-identifier hs-var">S.OTAsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SLT"><span class="hs-identifier hs-var">S.SLT</span></a></span><span>
</span><span id="line-1565"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><a href="Hasura.RQL.IR.Select.html#CSKBefore"><span class="hs-identifier hs-var">CSKBefore</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTDesc"><span class="hs-identifier hs-var">S.OTDesc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SGT"><span class="hs-identifier hs-var">S.SGT</span></a></span><span>
</span><span id="line-1566"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="#local-6989586621688398526"><span class="hs-identifier hs-var">compareOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398529"><span class="hs-identifier hs-var">obAlias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398532"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>        </span><span id="local-6989586621688398537"><span class="annot"><span class="annottext">mkEqualityCompareExp :: ConnectionSplit ('Postgres pgKind) SQLExp -&gt; BoolExp
</span><a href="#local-6989586621688398537"><span class="hs-identifier hs-var hs-var">mkEqualityCompareExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionSplit"><span class="hs-identifier hs-type">ConnectionSplit</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionSplitKind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398520"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398520"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621688398519"><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398519"><span class="hs-identifier hs-var">orderByItem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1569"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398518"><span class="annot"><span class="annottext">obAlias :: Alias
</span><a href="#local-6989586621688398518"><span class="hs-identifier hs-var hs-var">obAlias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1570"></span><span>                </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
-&gt; Alias
forall (pgKind :: PostgresKind) v.
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnotatedOrderByElement ('Postgres pgKind) v
-&gt; Alias
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkAnnOrderByAlias"><span class="hs-identifier hs-var">mkAnnOrderByAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398573"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Alias)
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1571"></span><span>                  </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
-&gt; AnnotatedOrderByElement ('Postgres pgKind) SQLExp
forall (b :: BackendType) a. OrderByItemG b a -&gt; a
</span><a href="Hasura.RQL.IR.OrderBy.html#obiColumn"><span class="hs-identifier hs-var hs-var">obiColumn</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItemG
  ('Postgres pgKind)
  (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621688398519"><span class="hs-identifier hs-var">orderByItem</span></a></span><span>
</span><span id="line-1572"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; SQLExp) -&gt; Identifier -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398518"><span class="hs-identifier hs-var">obAlias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398520"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span>    </span><span id="local-6989586621688398573"><span class="annot"><span class="annottext">similarArrayFields :: HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398573"><span class="hs-identifier hs-var hs-var">similarArrayFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall k v. (Eq k, Hashable k) =&gt; [HashMap k v] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.unions</span></span><span> </span><span class="annot"><span class="annottext">([HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1575"></span><span>      </span><span class="annot"><span class="annottext">((ConnectionField ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [ConnectionField ('Postgres pgKind) Void SQLExp]
 -&gt; [HashMap FieldName [FieldName]])
-&gt; [ConnectionField ('Postgres pgKind) Void SQLExp]
-&gt; (ConnectionField ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(ConnectionField ('Postgres pgKind) Void SQLExp
 -&gt; HashMap FieldName [FieldName])
-&gt; [ConnectionField ('Postgres pgKind) Void SQLExp]
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, ConnectionField ('Postgres pgKind) Void SQLExp)
 -&gt; ConnectionField ('Postgres pgKind) Void SQLExp)
-&gt; Fields (ConnectionField ('Postgres pgKind) Void SQLExp)
-&gt; [ConnectionField ('Postgres pgKind) Void SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, ConnectionField ('Postgres pgKind) Void SQLExp)
-&gt; ConnectionField ('Postgres pgKind) Void SQLExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">Fields (ConnectionField ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688398548"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ConnectionField ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [HashMap FieldName [FieldName]])
-&gt; (ConnectionField ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1576"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionTypename"><span class="hs-identifier hs-type">ConnectionTypename</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1577"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionPageInfo"><span class="hs-identifier hs-type">ConnectionPageInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1578"></span><span>        </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionEdges"><span class="hs-identifier hs-type">ConnectionEdges</span></a></span><span> </span><span id="local-6989586621688398514"><span class="annot"><span class="annottext">EdgeFields ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398514"><span class="hs-identifier hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall k v. (Eq k, Hashable k) =&gt; [HashMap k v] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.unions</span></span><span> </span><span class="annot"><span class="annottext">([HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]] -&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1579"></span><span>          </span><span class="annot"><span class="annottext">((EdgeField ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [EdgeField ('Postgres pgKind) Void SQLExp]
 -&gt; [HashMap FieldName [FieldName]])
-&gt; [EdgeField ('Postgres pgKind) Void SQLExp]
-&gt; (EdgeField ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(EdgeField ('Postgres pgKind) Void SQLExp
 -&gt; HashMap FieldName [FieldName])
-&gt; [EdgeField ('Postgres pgKind) Void SQLExp]
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((FieldName, EdgeField ('Postgres pgKind) Void SQLExp)
 -&gt; EdgeField ('Postgres pgKind) Void SQLExp)
-&gt; EdgeFields ('Postgres pgKind) Void SQLExp
-&gt; [EdgeField ('Postgres pgKind) Void SQLExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(FieldName, EdgeField ('Postgres pgKind) Void SQLExp)
-&gt; EdgeField ('Postgres pgKind) Void SQLExp
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">EdgeFields ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398514"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((EdgeField ('Postgres pgKind) Void SQLExp
  -&gt; HashMap FieldName [FieldName])
 -&gt; [HashMap FieldName [FieldName]])
-&gt; (EdgeField ('Postgres pgKind) Void SQLExp
    -&gt; HashMap FieldName [FieldName])
-&gt; [HashMap FieldName [FieldName]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1580"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#EdgeTypename"><span class="hs-identifier hs-type">EdgeTypename</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1581"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#EdgeCursor"><span class="hs-identifier hs-type">EdgeCursor</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1582"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#EdgeNode"><span class="hs-identifier hs-type">EdgeNode</span></a></span><span> </span><span id="local-6989586621688398510"><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398510"><span class="hs-identifier hs-var">annFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1583"></span><span>              </span><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
-&gt; Maybe
     (NonEmpty
        (OrderByItemG
           ('Postgres pgKind)
           (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)))
-&gt; HashMap FieldName [FieldName]
forall (pgKind :: PostgresKind) v.
(Backend ('Postgres pgKind), Eq v) =&gt;
AnnFieldsG ('Postgres pgKind) Void v
-&gt; Maybe (NonEmpty (AnnotatedOrderByItemG ('Postgres pgKind) v))
-&gt; HashMap FieldName [FieldName]
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkSimilarArrayFields"><span class="hs-identifier hs-var">mkSimilarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398510"><span class="hs-identifier hs-var">annFields</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe
   (NonEmpty
      (OrderByItemG
         ('Postgres pgKind)
         (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)))
 -&gt; HashMap FieldName [FieldName])
-&gt; Maybe
     (NonEmpty
        (OrderByItemG
           ('Postgres pgKind)
           (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)))
-&gt; HashMap FieldName [FieldName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
-&gt; Maybe
     (NonEmpty
        (OrderByItemG
           ('Postgres pgKind)
           (AnnotatedOrderByElement ('Postgres pgKind) SQLExp)))
forall (b :: BackendType) v.
SelectArgsG b v -&gt; Maybe (NonEmpty (AnnotatedOrderByItemG b v))
</span><a href="Hasura.RQL.IR.Select.html#_saOrderBy"><span class="hs-identifier hs-var hs-var">_saOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">SelectArgsG ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621688398569"><span class="hs-identifier hs-var">tableArgs</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>    </span><span id="local-6989586621688398509"><span class="annot"><span class="annottext">mkSimpleJsonAgg :: SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="#local-6989586621688398509"><span class="hs-identifier hs-var hs-var">mkSimpleJsonAgg</span></a></span></span><span> </span><span id="local-6989586621688398508"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398508"><span class="hs-identifier hs-var">rowExp</span></a></span></span><span> </span><span id="local-6989586621688398507"><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398507"><span class="hs-identifier hs-var">ob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1586"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398506"><span class="annot"><span class="annottext">jsonAggExp :: SQLExp
</span><a href="#local-6989586621688398506"><span class="hs-identifier hs-var hs-var">jsonAggExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json_agg&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398508"><span class="hs-identifier hs-var">rowExp</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
</span><a href="#local-6989586621688398507"><span class="hs-identifier hs-var">ob</span></a></span><span>
</span><span id="line-1587"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [SQLExp] -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEFnApp"><span class="hs-identifier hs-var">S.SEFnApp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;coalesce&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398506"><span class="hs-identifier hs-var">jsonAggExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe OrderByExp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span>    </span><span class="annot"><a href="#local-6989586621688398560"><span class="hs-identifier hs-type">processFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1590"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688399547"><span class="annot"><a href="#local-6989586621688399547"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1591"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#StringifyNumbers"><span class="hs-identifier hs-type">StringifyNumbers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399547"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1592"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#JoinTree"><span class="hs-identifier hs-type">JoinTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688399547"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1593"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621688399547"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-1594"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1595"></span><span>      </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#SelectSource"><span class="hs-identifier hs-type">SelectSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1596"></span><span>      </span><span class="annot"><a href="#local-6989586621688399547"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-1597"></span><span>    </span><span id="local-6989586621688398560"><span class="annot"><span class="annottext">processFields :: SelectSource -&gt; n SQLExp
</span><a href="#local-6989586621688398560"><span class="hs-identifier hs-var hs-var">processFields</span></a></span></span><span> </span><span id="local-6989586621688398505"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398505"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1598"></span><span>      </span><span class="annot"><span class="annottext">([[SQLExp]] -&gt; SQLExp) -&gt; n [[SQLExp]] -&gt; n SQLExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp)
-&gt; ([[SQLExp]] -&gt; [SQLExp]) -&gt; [[SQLExp]] -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[SQLExp]] -&gt; [SQLExp]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(n [[SQLExp]] -&gt; n SQLExp) -&gt; n [[SQLExp]] -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1599"></span><span>        </span><span class="annot"><span class="annottext">Fields (ConnectionField ('Postgres pgKind) Void SQLExp)
-&gt; ((FieldName, ConnectionField ('Postgres pgKind) Void SQLExp)
    -&gt; n [SQLExp])
-&gt; n [[SQLExp]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">Fields (ConnectionField ('Postgres pgKind) Void SQLExp)
</span><a href="#local-6989586621688398548"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, ConnectionField ('Postgres pgKind) Void SQLExp)
  -&gt; n [SQLExp])
 -&gt; n [[SQLExp]])
-&gt; ((FieldName, ConnectionField ('Postgres pgKind) Void SQLExp)
    -&gt; n [SQLExp])
-&gt; n [[SQLExp]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1600"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688398504"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398504"><span class="hs-identifier hs-var">fieldText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398503"><span class="annot"><span class="annottext">ConnectionField ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398503"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1601"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398504"><span class="hs-identifier hs-var">fieldText</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp] -&gt; [SQLExp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; [SQLExp])
-&gt; (SQLExp -&gt; [SQLExp]) -&gt; SQLExp -&gt; [SQLExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1602"></span><span>              </span><span class="annot"><span class="annottext">(SQLExp -&gt; [SQLExp]) -&gt; n SQLExp -&gt; n [SQLExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConnectionField ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398503"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1603"></span><span>                </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionTypename"><span class="hs-identifier hs-type">ConnectionTypename</span></a></span><span> </span><span id="local-6989586621688398502"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398502"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; n SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; n SQLExp) -&gt; SQLExp -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398502"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1604"></span><span>                </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionPageInfo"><span class="hs-identifier hs-type">ConnectionPageInfo</span></a></span><span> </span><span id="local-6989586621688398501"><span class="annot"><span class="annottext">PageInfoFields
</span><a href="#local-6989586621688398501"><span class="hs-identifier hs-var">pageInfoFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; n SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; n SQLExp) -&gt; SQLExp -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PageInfoFields -&gt; SQLExp
forall (t :: * -&gt; *).
Foldable t =&gt;
t (FieldName, PageInfoField) -&gt; SQLExp
</span><a href="#local-6989586621688398500"><span class="hs-identifier hs-var">processPageInfoFields</span></a></span><span> </span><span class="annot"><span class="annottext">PageInfoFields
</span><a href="#local-6989586621688398501"><span class="hs-identifier hs-var">pageInfoFields</span></a></span><span>
</span><span id="line-1605"></span><span>                </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#ConnectionEdges"><span class="hs-identifier hs-type">ConnectionEdges</span></a></span><span> </span><span id="local-6989586621688398499"><span class="annot"><span class="annottext">EdgeFields ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398499"><span class="hs-identifier hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1606"></span><span>                  </span><span class="annot"><span class="annottext">([[SQLExp]] -&gt; SQLExp) -&gt; n [[SQLExp]] -&gt; n SQLExp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp)
-&gt; Maybe OrderByExp -&gt; SQLExp -&gt; SQLExp
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderByExp -&gt; SQLExp
</span><a href="#local-6989586621688398509"><span class="hs-identifier hs-var">mkSimpleJsonAgg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SelectSource -&gt; Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#orderByForJsonAgg"><span class="hs-identifier hs-var">orderByForJsonAgg</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398505"><span class="hs-identifier hs-var">selectSource</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp)
-&gt; ([[SQLExp]] -&gt; SQLExp) -&gt; [[SQLExp]] -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp)
-&gt; ([[SQLExp]] -&gt; [SQLExp]) -&gt; [[SQLExp]] -&gt; SQLExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[SQLExp]] -&gt; [SQLExp]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(n [[SQLExp]] -&gt; n SQLExp) -&gt; n [[SQLExp]] -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1607"></span><span>                    </span><span class="annot"><span class="annottext">EdgeFields ('Postgres pgKind) Void SQLExp
-&gt; ((FieldName, EdgeField ('Postgres pgKind) Void SQLExp)
    -&gt; n [SQLExp])
-&gt; n [[SQLExp]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">EdgeFields ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398499"><span class="hs-identifier hs-var">edges</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, EdgeField ('Postgres pgKind) Void SQLExp)
  -&gt; n [SQLExp])
 -&gt; n [[SQLExp]])
-&gt; ((FieldName, EdgeField ('Postgres pgKind) Void SQLExp)
    -&gt; n [SQLExp])
-&gt; n [[SQLExp]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1608"></span><span>                      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688398498"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398498"><span class="hs-identifier hs-var">edgeText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398497"><span class="annot"><span class="annottext">EdgeField ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398497"><span class="hs-identifier hs-var">edge</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1609"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398498"><span class="hs-identifier hs-var">edgeText</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp] -&gt; [SQLExp]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; [SQLExp])
-&gt; (SQLExp -&gt; [SQLExp]) -&gt; SQLExp -&gt; [SQLExp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1610"></span><span>                          </span><span class="annot"><span class="annottext">(SQLExp -&gt; [SQLExp]) -&gt; n SQLExp -&gt; n [SQLExp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EdgeField ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398497"><span class="hs-identifier hs-var">edge</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1611"></span><span>                            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#EdgeTypename"><span class="hs-identifier hs-type">EdgeTypename</span></a></span><span> </span><span id="local-6989586621688398496"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398496"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; n SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; n SQLExp) -&gt; SQLExp -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398496"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1612"></span><span>                            </span><span class="annot"><span class="annottext">EdgeField ('Postgres pgKind) Void SQLExp
</span><a href="Hasura.RQL.IR.Select.html#EdgeCursor"><span class="hs-identifier hs-var">EdgeCursor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; n SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; n SQLExp) -&gt; SQLExp -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-var">encodeBase64</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-var">cursorIdentifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>                            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#EdgeNode"><span class="hs-identifier hs-type">EdgeNode</span></a></span><span> </span><span id="local-6989586621688398495"><span class="annot"><span class="annottext">AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398495"><span class="hs-identifier hs-var">annFields</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1614"></span><span>                              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398494"><span class="annot"><span class="annottext">edgeFieldName :: FieldName
</span><a href="#local-6989586621688398494"><span class="hs-identifier hs-var hs-var">edgeFieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1615"></span><span>                                    </span><span class="annot"><span class="annottext">Text -&gt; FieldName
</span><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-var">FieldName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FieldName) -&gt; Text -&gt; FieldName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1616"></span><span>                                      </span><span class="annot"><span class="annottext">FieldName -&gt; Text
</span><a href="Hasura.RQL.Types.Common.html#getFieldNameTxt"><span class="hs-identifier hs-var hs-var">getFieldNameTxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398580"><span class="hs-identifier hs-var">fieldAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398504"><span class="hs-identifier hs-var">fieldText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398498"><span class="hs-identifier hs-var">edgeText</span></a></span><span>
</span><span id="line-1617"></span><span>                                  </span><span id="local-6989586621688398493"><span class="annot"><span class="annottext">edgeFieldIdentifier :: Identifier
</span><a href="#local-6989586621688398493"><span class="hs-identifier hs-var hs-var">edgeFieldIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldName -&gt; Identifier
forall a. IsIdentifier a =&gt; a -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#toIdentifier"><span class="hs-identifier hs-var">toIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398494"><span class="hs-identifier hs-var">edgeFieldName</span></a></span><span>
</span><span id="line-1618"></span><span>                              </span><span id="local-6989586621688398492"><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688398492"><span class="hs-identifier hs-var">annFieldsExtrExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; n (Alias, SQLExp)
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(MonadReader StringifyNumbers m, MonadWriter JoinTree m,
 Backend ('Postgres pgKind), PostgresAnnotatedFieldJSON pgKind) =&gt;
Identifier
-&gt; FieldName
-&gt; HashMap FieldName [FieldName]
-&gt; AnnFields ('Postgres pgKind)
-&gt; m (Alias, SQLExp)
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#processAnnFields"><span class="hs-identifier hs-var">processAnnFields</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398547"><span class="hs-identifier hs-var">thisPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">FieldName
</span><a href="#local-6989586621688398494"><span class="hs-identifier hs-var">edgeFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap FieldName [FieldName]
</span><a href="#local-6989586621688398573"><span class="hs-identifier hs-var">similarArrayFields</span></a></span><span> </span><span class="annot"><span class="annottext">AnnFields ('Postgres pgKind)
AnnFieldsG ('Postgres pgKind) Void SQLExp
</span><a href="#local-6989586621688398495"><span class="hs-identifier hs-var">annFields</span></a></span><span>
</span><span id="line-1619"></span><span>                              </span><span class="annot"><span class="annottext">([(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]) -&gt; n ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Alias, SQLExp)] -&gt; [(Alias, SQLExp)] -&gt; [(Alias, SQLExp)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Alias, SQLExp)
</span><a href="#local-6989586621688398492"><span class="hs-identifier hs-var">annFieldsExtrExp</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1620"></span><span>                              </span><span class="annot"><span class="annottext">SQLExp -&gt; n SQLExp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; n SQLExp) -&gt; SQLExp -&gt; n SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398493"><span class="hs-identifier hs-var">edgeFieldIdentifier</span></a></span><span>
</span><span id="line-1621"></span><span>
</span><span id="line-1622"></span><span>    </span><span id="local-6989586621688398500"><span class="annot"><span class="annottext">processPageInfoFields :: t (FieldName, PageInfoField) -&gt; SQLExp
</span><a href="#local-6989586621688398500"><span class="hs-identifier hs-var hs-var">processPageInfoFields</span></a></span></span><span> </span><span id="local-6989586621688398490"><span class="annot"><span class="annottext">t (FieldName, PageInfoField)
</span><a href="#local-6989586621688398490"><span class="hs-identifier hs-var">infoFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1623"></span><span>      </span><span class="annot"><span class="annottext">[SQLExp] -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#applyJsonBuildObj"><span class="hs-identifier hs-var">S.applyJsonBuildObj</span></a></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; SQLExp) -&gt; [SQLExp] -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1624"></span><span>        </span><span class="annot"><span class="annottext">(((FieldName, PageInfoField) -&gt; [SQLExp])
 -&gt; t (FieldName, PageInfoField) -&gt; [SQLExp])
-&gt; t (FieldName, PageInfoField)
-&gt; ((FieldName, PageInfoField) -&gt; [SQLExp])
-&gt; [SQLExp]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((FieldName, PageInfoField) -&gt; [SQLExp])
-&gt; t (FieldName, PageInfoField) -&gt; [SQLExp]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">t (FieldName, PageInfoField)
</span><a href="#local-6989586621688398490"><span class="hs-identifier hs-var">infoFields</span></a></span><span> </span><span class="annot"><span class="annottext">(((FieldName, PageInfoField) -&gt; [SQLExp]) -&gt; [SQLExp])
-&gt; ((FieldName, PageInfoField) -&gt; [SQLExp]) -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1625"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Common.html#FieldName"><span class="hs-identifier hs-type">FieldName</span></a></span><span> </span><span id="local-6989586621688398489"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398489"><span class="hs-identifier hs-var">fieldText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688398488"><span class="annot"><span class="annottext">PageInfoField
</span><a href="#local-6989586621688398488"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398489"><span class="hs-identifier hs-var">fieldText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; [SQLExp]) -&gt; [SQLExp] -&gt; [SQLExp]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; [SQLExp]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PageInfoField
</span><a href="#local-6989586621688398488"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1626"></span><span>            </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#PageInfoTypename"><span class="hs-identifier hs-type">PageInfoTypename</span></a></span><span> </span><span id="local-6989586621688398486"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398486"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SELit"><span class="hs-identifier hs-var">S.SELit</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688398486"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1627"></span><span>            </span><span class="annot"><span class="annottext">PageInfoField
</span><a href="Hasura.RQL.IR.Select.html#PageInfoHasNextPage"><span class="hs-identifier hs-var">PageInfoHasNextPage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1628"></span><span>              </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#boolTypeAnn"><span class="hs-identifier hs-var">S.boolTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1629"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; Identifier -&gt; SQLExp
</span><a href="#local-6989586621688398483"><span class="hs-identifier hs-var">mkSingleFieldSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasNextPageIdentifier"><span class="hs-identifier hs-var">hasNextPageIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#pageInfoSelectAliasIdentifier"><span class="hs-identifier hs-var">pageInfoSelectAliasIdentifier</span></a></span><span>
</span><span id="line-1630"></span><span>            </span><span class="annot"><span class="annottext">PageInfoField
</span><a href="Hasura.RQL.IR.Select.html#PageInfoHasPreviousPage"><span class="hs-identifier hs-var">PageInfoHasPreviousPage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1631"></span><span>              </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#boolTypeAnn"><span class="hs-identifier hs-var">S.boolTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1632"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; Identifier -&gt; SQLExp
</span><a href="#local-6989586621688398483"><span class="hs-identifier hs-var">mkSingleFieldSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasPreviousPageIdentifier"><span class="hs-identifier hs-var">hasPreviousPageIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#pageInfoSelectAliasIdentifier"><span class="hs-identifier hs-var">pageInfoSelectAliasIdentifier</span></a></span><span>
</span><span id="line-1633"></span><span>            </span><span class="annot"><span class="annottext">PageInfoField
</span><a href="Hasura.RQL.IR.Select.html#PageInfoStartCursor"><span class="hs-identifier hs-var">PageInfoStartCursor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1634"></span><span>              </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1635"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-var">encodeBase64</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Identifier -&gt; SQLExp
</span><a href="#local-6989586621688398483"><span class="hs-identifier hs-var">mkSingleFieldSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#startCursorIdentifier"><span class="hs-identifier hs-var">startCursorIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var">cursorsSelectAliasIdentifier</span></a></span><span>
</span><span id="line-1636"></span><span>            </span><span class="annot"><span class="annottext">PageInfoField
</span><a href="Hasura.RQL.IR.Select.html#PageInfoEndCursor"><span class="hs-identifier hs-var">PageInfoEndCursor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1637"></span><span>              </span><span class="annot"><span class="annottext">TypeAnn -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#withForceAggregation"><span class="hs-identifier hs-var">withForceAggregation</span></a></span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#textTypeAnn"><span class="hs-identifier hs-var">S.textTypeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1638"></span><span>                </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#encodeBase64"><span class="hs-identifier hs-var">encodeBase64</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Identifier -&gt; SQLExp
</span><a href="#local-6989586621688398483"><span class="hs-identifier hs-var">mkSingleFieldSelect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#endCursorIdentifier"><span class="hs-identifier hs-var">endCursorIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var">cursorsSelectAliasIdentifier</span></a></span><span>
</span><span id="line-1639"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1640"></span><span>        </span><span id="local-6989586621688398483"><span class="annot"><span class="annottext">mkSingleFieldSelect :: SQLExp -&gt; Identifier -&gt; SQLExp
</span><a href="#local-6989586621688398483"><span class="hs-identifier hs-var hs-var">mkSingleFieldSelect</span></a></span></span><span> </span><span id="local-6989586621688398479"><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398479"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621688398478"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398478"><span class="hs-identifier hs-var">fromIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1641"></span><span>          </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span>
</span><span id="line-1642"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1643"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398479"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1644"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398478"><span class="hs-identifier hs-var">fromIdentifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1645"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionToSelectWith"><span class="hs-identifier hs-type">connectionToSelectWith</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1648"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-type">S.Alias</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1649"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-type">ArrayConnectionSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1650"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1651"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SelectWithG"><span class="hs-identifier hs-type">S.SelectWithG</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Select"><span class="hs-identifier hs-type">S.Select</span></a></span><span>
</span><span id="line-1652"></span><span id="connectionToSelectWith"><span class="annot"><span class="annottext">connectionToSelectWith :: Alias
-&gt; ArrayConnectionSource
-&gt; MultiRowSelectNode
-&gt; SelectWithG Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#connectionToSelectWith"><span class="hs-identifier hs-var hs-var">connectionToSelectWith</span></a></span></span><span> </span><span id="local-6989586621688398477"><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398477"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span></span><span> </span><span id="local-6989586621688398476"><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398476"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span></span><span> </span><span id="local-6989586621688398475"><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398475"><span class="hs-identifier hs-var">arraySelectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1653"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398474"><span class="annot"><span class="annottext">extractionSelect :: Select
</span><a href="#local-6989586621688398474"><span class="hs-identifier hs-var hs-var">extractionSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1654"></span><span>        </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1655"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688398473"><span class="hs-identifier hs-var">topExtractors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1656"></span><span>            </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398472"><span class="hs-identifier hs-var">finalSelectIdentifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1657"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1658"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Alias, Select)] -&gt; Select -&gt; SelectWithG Select
forall v. [(Alias, v)] -&gt; Select -&gt; SelectWithG v
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SelectWith"><span class="hs-identifier hs-var">S.SelectWith</span></a></span><span> </span><span class="annot"><span class="annottext">[(Alias, Select)]
</span><a href="#local-6989586621688398470"><span class="hs-identifier hs-var">fromBaseSelections</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398474"><span class="hs-identifier hs-var">extractionSelect</span></a></span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1660"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#ArrayConnectionSource"><span class="hs-identifier hs-type">ArrayConnectionSource</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688398469"><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398469"><span class="hs-identifier hs-var">columnMapping</span></a></span></span><span> </span><span id="local-6989586621688398468"><span class="annot"><span class="annottext">Maybe BoolExp
</span><a href="#local-6989586621688398468"><span class="hs-identifier hs-var">maybeSplit</span></a></span></span><span> </span><span id="local-6989586621688398467"><span class="annot"><span class="annottext">Maybe ConnectionSlice
</span><a href="#local-6989586621688398467"><span class="hs-identifier hs-var">maybeSlice</span></a></span></span><span> </span><span id="local-6989586621688398466"><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398466"><span class="hs-identifier hs-var">selectSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1661"></span><span>      </span><span class="annot"><span class="annottext">ArrayConnectionSource
</span><a href="#local-6989586621688398476"><span class="hs-identifier hs-var">arrayConnectionSource</span></a></span><span>
</span><span id="line-1662"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Types.html#MultiRowSelectNode"><span class="hs-identifier hs-type">MultiRowSelectNode</span></a></span><span> </span><span id="local-6989586621688398473"><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688398473"><span class="hs-identifier hs-var">topExtractors</span></a></span></span><span> </span><span id="local-6989586621688398465"><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398465"><span class="hs-identifier hs-var">selectNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiRowSelectNode
</span><a href="#local-6989586621688398475"><span class="hs-identifier hs-var">arraySelectNode</span></a></span><span>
</span><span id="line-1663"></span><span>    </span><span id="local-6989586621688398464"><span class="annot"><span class="annottext">baseSelectIdentifier :: Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var hs-var">baseSelectIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__base_select&quot;</span></span><span>
</span><span id="line-1664"></span><span>    </span><span id="local-6989586621688398463"><span class="annot"><span class="annottext">splitSelectIdentifier :: Identifier
</span><a href="#local-6989586621688398463"><span class="hs-identifier hs-var hs-var">splitSelectIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__split_select&quot;</span></span><span>
</span><span id="line-1665"></span><span>    </span><span id="local-6989586621688398462"><span class="annot"><span class="annottext">sliceSelectIdentifier :: Identifier
</span><a href="#local-6989586621688398462"><span class="hs-identifier hs-var hs-var">sliceSelectIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__slice_select&quot;</span></span><span>
</span><span id="line-1666"></span><span>    </span><span id="local-6989586621688398472"><span class="annot"><span class="annottext">finalSelectIdentifier :: Identifier
</span><a href="#local-6989586621688398472"><span class="hs-identifier hs-var hs-var">finalSelectIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__final_select&quot;</span></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span>    </span><span id="local-6989586621688398461"><span class="annot"><span class="annottext">rowNumberIdentifier :: Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var hs-var">rowNumberIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__row_number&quot;</span></span><span>
</span><span id="line-1669"></span><span>    </span><span id="local-6989586621688398460"><span class="annot"><span class="annottext">rowNumberExp :: SQLExp
</span><a href="#local-6989586621688398460"><span class="hs-identifier hs-var hs-var">rowNumberExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEUnsafe"><span class="hs-identifier hs-var">S.SEUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(row_number() over (partition by 1))&quot;</span></span><span>
</span><span id="line-1670"></span><span>    </span><span id="local-6989586621688398459"><span class="annot"><span class="annottext">startRowNumberIdentifier :: Identifier
</span><a href="#local-6989586621688398459"><span class="hs-identifier hs-var hs-var">startRowNumberIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__start_row_number&quot;</span></span><span>
</span><span id="line-1671"></span><span>    </span><span id="local-6989586621688398458"><span class="annot"><span class="annottext">endRowNumberIdentifier :: Identifier
</span><a href="#local-6989586621688398458"><span class="hs-identifier hs-var hs-var">endRowNumberIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__end_row_number&quot;</span></span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span>    </span><span id="local-6989586621688398457"><span class="annot"><span class="annottext">startCursorExp :: SQLExp
</span><a href="#local-6989586621688398457"><span class="hs-identifier hs-var hs-var">startCursorExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkFirstElementExp"><span class="hs-identifier hs-var">mkFirstElementExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-var">cursorIdentifier</span></a></span><span>
</span><span id="line-1674"></span><span>    </span><span id="local-6989586621688398456"><span class="annot"><span class="annottext">endCursorExp :: SQLExp
</span><a href="#local-6989586621688398456"><span class="hs-identifier hs-var hs-var">endCursorExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkLastElementExp"><span class="hs-identifier hs-var">mkLastElementExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorIdentifier"><span class="hs-identifier hs-var">cursorIdentifier</span></a></span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span>    </span><span id="local-6989586621688398455"><span class="annot"><span class="annottext">startRowNumberExp :: SQLExp
</span><a href="#local-6989586621688398455"><span class="hs-identifier hs-var hs-var">startRowNumberExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkFirstElementExp"><span class="hs-identifier hs-var">mkFirstElementExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span>
</span><span id="line-1677"></span><span>    </span><span id="local-6989586621688398454"><span class="annot"><span class="annottext">endRowNumberExp :: SQLExp
</span><a href="#local-6989586621688398454"><span class="hs-identifier hs-var hs-var">endRowNumberExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkLastElementExp"><span class="hs-identifier hs-var">mkLastElementExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; SQLExp) -&gt; SQLExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span>    </span><span id="local-6989586621688398470"><span class="annot"><span class="annottext">fromBaseSelections :: [(Alias, Select)]
</span><a href="#local-6989586621688398470"><span class="hs-identifier hs-var hs-var">fromBaseSelections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1680"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398453"><span class="annot"><span class="annottext">joinCond :: BoolExp
</span><a href="#local-6989586621688398453"><span class="hs-identifier hs-var hs-var">joinCond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Alias -&gt; HashMap PGCol PGCol -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#mkJoinCond"><span class="hs-identifier hs-var">mkJoinCond</span></a></span><span> </span><span class="annot"><span class="annottext">Alias
</span><a href="#local-6989586621688398477"><span class="hs-identifier hs-var">baseSelectAlias</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap PGCol PGCol
</span><a href="#local-6989586621688398469"><span class="hs-identifier hs-var">columnMapping</span></a></span><span>
</span><span id="line-1681"></span><span>          </span><span id="local-6989586621688398452"><span class="annot"><span class="annottext">baseSelectFrom :: FromItem
</span><a href="#local-6989586621688398452"><span class="hs-identifier hs-var hs-var">baseSelectFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1682"></span><span>            </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span>
</span><span id="line-1683"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoolExp -&gt; SelectSource -&gt; SelectNode -&gt; Select
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#generateSQLSelect"><span class="hs-identifier hs-var">generateSQLSelect</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398453"><span class="hs-identifier hs-var">joinCond</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398466"><span class="hs-identifier hs-var">selectSource</span></a></span><span> </span><span class="annot"><span class="annottext">SelectNode
</span><a href="#local-6989586621688398465"><span class="hs-identifier hs-var">selectNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>              </span><span class="annot"><span class="annottext">(Alias -&gt; FromItem) -&gt; Alias -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">(Identifier -&gt; Alias) -&gt; Identifier -&gt; Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SelectSource -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Types.html#_ssPrefix"><span class="hs-identifier hs-var hs-var">_ssPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">SelectSource
</span><a href="#local-6989586621688398466"><span class="hs-identifier hs-var">selectSource</span></a></span><span>
</span><span id="line-1685"></span><span>          </span><span id="local-6989586621688398451"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398451"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1686"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1687"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1688"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1689"></span><span>                    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398460"><span class="hs-identifier hs-var">rowNumberExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span>
</span><span id="line-1690"></span><span>                  </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1691"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398452"><span class="hs-identifier hs-var">baseSelectFrom</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1692"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1693"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var">baseSelectIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398451"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)] -&gt; [(Alias, Select)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, Select)]
</span><a href="#local-6989586621688398449"><span class="hs-identifier hs-var">fromSplitSelection</span></a></span><span>
</span><span id="line-1694"></span><span>
</span><span id="line-1695"></span><span>    </span><span id="local-6989586621688398448"><span class="annot"><span class="annottext">mkStarSelect :: Identifier -&gt; Select
</span><a href="#local-6989586621688398448"><span class="hs-identifier hs-var hs-var">mkStarSelect</span></a></span></span><span> </span><span id="local-6989586621688398447"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398447"><span class="hs-identifier hs-var">fromIdentifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1696"></span><span>      </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1697"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1698"></span><span>          </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398447"><span class="hs-identifier hs-var">fromIdentifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1699"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1700"></span><span>
</span><span id="line-1701"></span><span>    </span><span id="local-6989586621688398449"><span class="annot"><span class="annottext">fromSplitSelection :: [(Alias, Select)]
</span><a href="#local-6989586621688398449"><span class="hs-identifier hs-var hs-var">fromSplitSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe BoolExp
</span><a href="#local-6989586621688398468"><span class="hs-identifier hs-var">maybeSplit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1702"></span><span>      </span><span class="annot"><span class="annottext">Maybe BoolExp
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398446"><span class="hs-identifier hs-var">fromSliceSelection</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var">baseSelectIdentifier</span></a></span><span>
</span><span id="line-1703"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688398445"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398445"><span class="hs-identifier hs-var">splitBool</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1704"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398444"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398444"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1705"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Select
</span><a href="#local-6989586621688398448"><span class="hs-identifier hs-var">mkStarSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var">baseSelectIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">selWhere :: Maybe WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selWhere"><span class="hs-identifier hs-var">S.selWhere</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereFrag -&gt; Maybe WhereFrag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(WhereFrag -&gt; Maybe WhereFrag) -&gt; WhereFrag -&gt; Maybe WhereFrag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; WhereFrag
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-var">S.WhereFrag</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621688398445"><span class="hs-identifier hs-var">splitBool</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1706"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398463"><span class="hs-identifier hs-var">splitSelectIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398444"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)] -&gt; [(Alias, Select)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398446"><span class="hs-identifier hs-var">fromSliceSelection</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398463"><span class="hs-identifier hs-var">splitSelectIdentifier</span></a></span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span>    </span><span id="local-6989586621688398446"><span class="annot"><span class="annottext">fromSliceSelection :: Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398446"><span class="hs-identifier hs-var hs-var">fromSliceSelection</span></a></span></span><span> </span><span id="local-6989586621688398443"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398443"><span class="hs-identifier hs-var">prevSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ConnectionSlice
</span><a href="#local-6989586621688398467"><span class="hs-identifier hs-var">maybeSlice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1709"></span><span>      </span><span class="annot"><span class="annottext">Maybe ConnectionSlice
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398442"><span class="hs-identifier hs-var">fromFinalSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398443"><span class="hs-identifier hs-var">prevSelect</span></a></span><span>
</span><span id="line-1710"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688398441"><span class="annot"><span class="annottext">ConnectionSlice
</span><a href="#local-6989586621688398441"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1711"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398440"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398440"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConnectionSlice
</span><a href="#local-6989586621688398441"><span class="hs-identifier hs-var">slice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1712"></span><span>              </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SliceFirst"><span class="hs-identifier hs-type">SliceFirst</span></a></span><span> </span><span id="local-6989586621688398438"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688398438"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1713"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Select
</span><a href="#local-6989586621688398448"><span class="hs-identifier hs-var">mkStarSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398443"><span class="hs-identifier hs-var">prevSelect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1714"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LimitExp -&gt; Maybe LimitExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LimitExp -&gt; Maybe LimitExp)
-&gt; (Int -&gt; LimitExp) -&gt; Int -&gt; Maybe LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688398438"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-1715"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1716"></span><span>              </span><span class="annot"><a href="Hasura.RQL.IR.Select.html#SliceLast"><span class="hs-identifier hs-type">SliceLast</span></a></span><span> </span><span id="local-6989586621688398436"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688398436"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1717"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398435"><span class="annot"><span class="annottext">mkRowNumberOrderBy :: OrderType -&gt; OrderByExp
</span><a href="#local-6989586621688398435"><span class="hs-identifier hs-var hs-var">mkRowNumberOrderBy</span></a></span></span><span> </span><span id="local-6989586621688398434"><span class="annot"><span class="annottext">OrderType
</span><a href="#local-6989586621688398434"><span class="hs-identifier hs-var">obType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1718"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398433"><span class="annot"><span class="annottext">orderByItem :: OrderByItem
</span><a href="#local-6989586621688398433"><span class="hs-identifier hs-var hs-var">orderByItem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1719"></span><span>                            </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe OrderType -&gt; Maybe NullsOrder -&gt; OrderByItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByItem"><span class="hs-identifier hs-var">S.OrderByItem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrderType -&gt; Maybe OrderType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="#local-6989586621688398434"><span class="hs-identifier hs-var">obType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe NullsOrder
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1720"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NonEmpty OrderByItem -&gt; OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OrderByExp"><span class="hs-identifier hs-var">S.OrderByExp</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty OrderByItem -&gt; OrderByExp)
-&gt; NonEmpty OrderByItem -&gt; OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderByItem
</span><a href="#local-6989586621688398433"><span class="hs-identifier hs-var">orderByItem</span></a></span><span> </span><span class="annot"><span class="annottext">OrderByItem -&gt; [OrderByItem] -&gt; NonEmpty OrderByItem
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1721"></span><span>
</span><span id="line-1722"></span><span>                    </span><span id="local-6989586621688398432"><span class="annot"><span class="annottext">sliceLastSelect :: Select
</span><a href="#local-6989586621688398432"><span class="hs-identifier hs-var hs-var">sliceLastSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1723"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Select
</span><a href="#local-6989586621688398448"><span class="hs-identifier hs-var">mkStarSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398443"><span class="hs-identifier hs-var">prevSelect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1724"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selLimit :: Maybe LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selLimit"><span class="hs-identifier hs-var">S.selLimit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LimitExp -&gt; Maybe LimitExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(LimitExp -&gt; Maybe LimitExp)
-&gt; (Int -&gt; LimitExp) -&gt; Int -&gt; Maybe LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; LimitExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#LimitExp"><span class="hs-identifier hs-var">S.LimitExp</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; LimitExp) -&gt; (Int -&gt; SQLExp) -&gt; Int -&gt; LimitExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#intToSQLExp"><span class="hs-identifier hs-var">S.intToSQLExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621688398436"><span class="hs-identifier hs-var">limit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1725"></span><span>                          </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp -&gt; Maybe OrderByExp) -&gt; OrderByExp -&gt; Maybe OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderType -&gt; OrderByExp
</span><a href="#local-6989586621688398435"><span class="hs-identifier hs-var">mkRowNumberOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTDesc"><span class="hs-identifier hs-var">S.OTDesc</span></a></span><span>
</span><span id="line-1726"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-1727"></span><span>                    </span><span id="local-6989586621688398431"><span class="annot"><span class="annottext">sliceLastSelectFrom :: FromItem
</span><a href="#local-6989586621688398431"><span class="hs-identifier hs-var hs-var">sliceLastSelectFrom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1728"></span><span>                      </span><span class="annot"><span class="annottext">Select -&gt; Alias -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelFromItem"><span class="hs-identifier hs-var">S.mkSelFromItem</span></a></span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398432"><span class="hs-identifier hs-var">sliceLastSelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; FromItem) -&gt; Alias -&gt; FromItem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398462"><span class="hs-identifier hs-var">sliceSelectIdentifier</span></a></span><span>
</span><span id="line-1729"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1730"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1731"></span><span>                        </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FromItem
</span><a href="#local-6989586621688398431"><span class="hs-identifier hs-var">sliceLastSelectFrom</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1732"></span><span>                        </span><span class="annot"><span class="annottext">selOrderBy :: Maybe OrderByExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selOrderBy"><span class="hs-identifier hs-var">S.selOrderBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrderByExp -&gt; Maybe OrderByExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(OrderByExp -&gt; Maybe OrderByExp) -&gt; OrderByExp -&gt; Maybe OrderByExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OrderType -&gt; OrderByExp
</span><a href="#local-6989586621688398435"><span class="hs-identifier hs-var">mkRowNumberOrderBy</span></a></span><span> </span><span class="annot"><span class="annottext">OrderType
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#OTAsc"><span class="hs-identifier hs-var">S.OTAsc</span></a></span><span>
</span><span id="line-1733"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-1734"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398462"><span class="hs-identifier hs-var">sliceSelectIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398440"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)] -&gt; [(Alias, Select)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398442"><span class="hs-identifier hs-var">fromFinalSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398462"><span class="hs-identifier hs-var">sliceSelectIdentifier</span></a></span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span>    </span><span id="local-6989586621688398442"><span class="annot"><span class="annottext">fromFinalSelect :: Identifier -&gt; [(Alias, Select)]
</span><a href="#local-6989586621688398442"><span class="hs-identifier hs-var hs-var">fromFinalSelect</span></a></span></span><span> </span><span id="local-6989586621688398430"><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398430"><span class="hs-identifier hs-var">prevSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1737"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398429"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398429"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Select
</span><a href="#local-6989586621688398448"><span class="hs-identifier hs-var">mkStarSelect</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398430"><span class="hs-identifier hs-var">prevSelect</span></a></span><span>
</span><span id="line-1738"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398472"><span class="hs-identifier hs-var">finalSelectIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398429"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)] -&gt; [(Alias, Select)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, Select)]
</span><a href="#local-6989586621688398428"><span class="hs-identifier hs-var">fromCursorSelection</span></a></span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>    </span><span id="local-6989586621688398428"><span class="annot"><span class="annottext">fromCursorSelection :: [(Alias, Select)]
</span><a href="#local-6989586621688398428"><span class="hs-identifier hs-var hs-var">fromCursorSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1741"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398427"><span class="annot"><span class="annottext">extrs :: [Extractor]
</span><a href="#local-6989586621688398427"><span class="hs-identifier hs-var hs-var">extrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1742"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398457"><span class="hs-identifier hs-var">startCursorExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#startCursorIdentifier"><span class="hs-identifier hs-var">startCursorIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1743"></span><span>              </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398456"><span class="hs-identifier hs-var">endCursorExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#endCursorIdentifier"><span class="hs-identifier hs-var">endCursorIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1744"></span><span>              </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398455"><span class="hs-identifier hs-var">startRowNumberExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398459"><span class="hs-identifier hs-var">startRowNumberIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1745"></span><span>              </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398454"><span class="hs-identifier hs-var">endRowNumberExp</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398458"><span class="hs-identifier hs-var">endRowNumberIdentifier</span></a></span><span>
</span><span id="line-1746"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1747"></span><span>          </span><span id="local-6989586621688398426"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398426"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1748"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1749"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Extractor]
</span><a href="#local-6989586621688398427"><span class="hs-identifier hs-var">extrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1750"></span><span>                </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398472"><span class="hs-identifier hs-var">finalSelectIdentifier</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1751"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1752"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var">cursorsSelectAliasIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398426"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)] -&gt; [(Alias, Select)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Alias, Select)]
</span><a href="#local-6989586621688398425"><span class="hs-identifier hs-var">fromPageInfoSelection</span></a></span><span>
</span><span id="line-1753"></span><span>
</span><span id="line-1754"></span><span>    </span><span id="local-6989586621688398425"><span class="annot"><span class="annottext">fromPageInfoSelection :: [(Alias, Select)]
</span><a href="#local-6989586621688398425"><span class="hs-identifier hs-var hs-var">fromPageInfoSelection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1755"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688398424"><span class="annot"><span class="annottext">hasPrevPage :: SQLExp
</span><a href="#local-6989586621688398424"><span class="hs-identifier hs-var hs-var">hasPrevPage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1756"></span><span>            </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEBool"><span class="hs-identifier hs-var">S.SEBool</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; SQLExp) -&gt; BoolExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1757"></span><span>              </span><span class="annot"><span class="annottext">FromItem -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkExists"><span class="hs-identifier hs-var">S.mkExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var">baseSelectIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1758"></span><span>                </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SLT"><span class="hs-identifier hs-var">S.SLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; BoolExp) -&gt; SQLExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1759"></span><span>                  </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; SQLExp) -&gt; Select -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1760"></span><span>                    </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1761"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var">cursorsSelectAliasIdentifier</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1762"></span><span>                        </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398459"><span class="hs-identifier hs-var">startRowNumberIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-1763"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-1764"></span><span>          </span><span id="local-6989586621688398421"><span class="annot"><span class="annottext">hasNextPage :: SQLExp
</span><a href="#local-6989586621688398421"><span class="hs-identifier hs-var hs-var">hasNextPage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1765"></span><span>            </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEBool"><span class="hs-identifier hs-var">S.SEBool</span></a></span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; SQLExp) -&gt; BoolExp -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1766"></span><span>              </span><span class="annot"><span class="annottext">FromItem -&gt; BoolExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkExists"><span class="hs-identifier hs-var">S.mkExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398464"><span class="hs-identifier hs-var">baseSelectIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BoolExp -&gt; BoolExp) -&gt; BoolExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1767"></span><span>                </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span> </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SGT"><span class="hs-identifier hs-var">S.SGT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398461"><span class="hs-identifier hs-var">rowNumberIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; BoolExp) -&gt; SQLExp -&gt; BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1768"></span><span>                  </span><span class="annot"><span class="annottext">Select -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SESelect"><span class="hs-identifier hs-var">S.SESelect</span></a></span><span> </span><span class="annot"><span class="annottext">(Select -&gt; SQLExp) -&gt; Select -&gt; SQLExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1769"></span><span>                    </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1770"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selFrom :: Maybe FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selFrom"><span class="hs-identifier hs-var">S.selFrom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromExp -&gt; Maybe FromExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(FromExp -&gt; Maybe FromExp) -&gt; FromExp -&gt; Maybe FromExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[FromItem] -&gt; FromExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FromExp"><span class="hs-identifier hs-var">S.FromExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Identifier -&gt; FromItem
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#FIIdentifier"><span class="hs-identifier hs-var">S.FIIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#cursorsSelectAliasIdentifier"><span class="hs-identifier hs-var">cursorsSelectAliasIdentifier</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1771"></span><span>                        </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEIdentifier"><span class="hs-identifier hs-var">S.SEIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="#local-6989586621688398458"><span class="hs-identifier hs-var">endRowNumberIdentifier</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Alias
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-1772"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-1773"></span><span>
</span><span id="line-1774"></span><span>          </span><span id="local-6989586621688398420"><span class="annot"><span class="annottext">select :: Select
</span><a href="#local-6989586621688398420"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1775"></span><span>            </span><span class="annot"><span class="annottext">Select
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkSelect"><span class="hs-identifier hs-var">S.mkSelect</span></a></span><span>
</span><span id="line-1776"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">selExtr :: [Extractor]
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selExtr"><span class="hs-identifier hs-var">S.selExtr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1777"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398424"><span class="hs-identifier hs-var">hasPrevPage</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasPreviousPageIdentifier"><span class="hs-identifier hs-var">hasPreviousPageIdentifier</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1778"></span><span>                    </span><span class="annot"><span class="annottext">SQLExp -&gt; Maybe Alias -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-var">S.Extractor</span></a></span><span> </span><span class="annot"><span class="annottext">SQLExp
</span><a href="#local-6989586621688398421"><span class="hs-identifier hs-var">hasNextPage</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Alias -&gt; Extractor) -&gt; Maybe Alias -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Alias -&gt; Maybe Alias
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Alias -&gt; Maybe Alias) -&gt; Alias -&gt; Maybe Alias
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#hasNextPageIdentifier"><span class="hs-identifier hs-var">hasNextPageIdentifier</span></a></span><span>
</span><span id="line-1779"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-1780"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1781"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Alias, Select) -&gt; [(Alias, Select)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Identifier -&gt; Alias
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#Alias"><span class="hs-identifier hs-var">S.Alias</span></a></span><span> </span><span class="annot"><span class="annottext">Identifier
</span><a href="Hasura.Backends.Postgres.Translate.Select.html#pageInfoSelectAliasIdentifier"><span class="hs-identifier hs-var">pageInfoSelectAliasIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select
</span><a href="#local-6989586621688398420"><span class="hs-identifier hs-var">select</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1782"></span></pre></body></html>